{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/user/list/handle/userDetails.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/user/list/handle/userDetails.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n    import { detailsApi, infoApi, visitList, spreadList } from '@/api/user';\n    import userForm from './userForm';\n    import userInfo from './userInfo';\n\n    export default {\n        name: 'userDetails',\n        components: {\n            userForm,\n            userInfo\n        },\n        props: ['levelList', 'labelList', 'groupList', 'fromType'],\n        data () {\n            return {\n                theme2: 'light',\n                list: [\n                    { val: 'info', label: '用户信息' },\n                    { val: 'order', label: '消费记录' },\n                    { val: 'integral', label: '积分明细' },\n                    { val: 'sign', label: '签到记录' },\n                    { val: 'coupon', label: '持有优惠券' },\n                    { val: 'balance_change', label: '余额变动' },\n                    { val: 'spread', label: '好友关系' },\n                    { val: 'visit', label: '浏览足迹' },\n                    { val: 'spread_change', label: '推荐人变更记录' }\n                ],\n                modals: false,\n                spinShow: false,\n                detailsData: [],\n                userId: 0,\n                loading: false,\n                userFrom: {\n                    type: 'info',\n                    page: 1, // 当前页\n                    limit: 12 // 每页显示条数\n                },\n                total: 0,\n                columns: [],\n                userLists: [],\n                psInfo: {},\n                workMemberInfo:{},\n                workClientInfo:{},\n                activeName: 'info',\n                isEdit: false,\n                groupOptions: [],\n                labelOptions: []\n            }\n        },\n        watch: {\n            activeName (value) {\n\t\t\t\t\t\t\t  this.userFrom.page = 1;\n                if (value == 'info') return;\n                this.isEdit = false;\n                 this.changeType(value);\n                // if (value == 'visit') {\n                //     this.changeType(value);\n                // } else if (value == 'spread_change') {\n                //    this.changeType(value);\n                // } else {\n                //     this.changeType(value);\n                // }\n            },\n            modals (value) {\n                if (value) {\n                    this.isEdit = false;\n                }\n            }\n        },\n        created () {\n        },\n        methods: {\n            changeMenu (value) {\n                if (value === '99') {\n                    this.getDetails(this.userId);\n                    this.$parent.getList();\n                    this.isEdit = false;\n                    return;\n                }\n                this.$parent.changeMenu(this.psInfo, value);\n            },\n            // 完成\n            finish () {\n                this.$refs.userForm[0].detailsPut();\n            },\n            // 推荐人变更记录\n            getSpreadList () {\n                this.loading = true;\n                spreadList({\n                    id: this.userId,\n                    datas: {\n                        page: this.userFrom.page,\n                        limit: this.userFrom.limit\n                    }\n                }).then(async res => {\n                    if (res.status === 200) {\n                        let data = res.data;\n                        this.userLists = data.list;\n                        this.total = data.count;\n                        this.columns = [\n                            {\n                                title: '推荐人ID',\n                                key: 'spread_uid',\n                                minWidth: 120\n                            },\n                            {\n                                title: '推荐人',\n                                key: 'nickname',\n                                minWidth: 120,\n                                render: (h, params) => {\n                                    return h('div', [\n                                        h('img', {\n                                            style: {\n                                                borderRadius: '50%',\n                                                marginRight: '10px',\n                                                verticalAlign: 'middle'\n                                            },\n                                            attrs: {\n                                                with: 38,\n                                                height: 38\n                                            },\n                                            directives: [\n                                                {\n                                                    name: 'lazy',\n                                                    value: params.row.avatar\n                                                },\n                                                {\n                                                    name: 'viewer'\n                                                }\n                                            ]\n                                        }),\n                                        h('span', {\n                                            style: {\n                                                verticalAlign: 'middle'\n                                            }\n                                        }, params.row.nickname)\n                                    ]);\n                                }\n                            },\n                            {\n                                title: '变更方式',\n                                key: 'type',\n                                minWidth: 120\n                            },\n                            {\n                                title: '变更时间',\n                                key: 'spread_time',\n                                minWidth: 120\n                            }\n                        ];\n                        this.loading = false;\n                    } else {\n                        this.loading = false;\n                        this.$Message.error(res.msg);\n                    }\n                }).catch(res => {\n                    this.loading = false;\n                    this.$Message.error(res.msg);\n                });\n            },\n            // 浏览足迹\n            getVisitList () {\n                this.loading = true;\n                visitList({\n                    id: this.userId,\n                    datas: {\n                        page: this.userFrom.page,\n                        limit: this.userFrom.limit\n                    }\n                }).then(async res => {\n                    if (res.status === 200) {\n                        let data = res.data;\n                        this.userLists = data.list;\n                        this.total = data.count;\n                        this.columns = [\n                            {\n                                title: '商品信息',\n                                slot: 'product',\n                                minWidth: 400\n                            },\n                            {\n                                title: '价格',\n                                key: 'product_price',\n                                minWidth: 120,\n                                render: (h, params) => {\n                                    return h('div', `¥${params.row.product_price}`);\n                                }\n                            },\n                            {\n                                title: '浏览时间',\n                                key: 'add_time',\n                                minWidth: 120\n                            }\n                        ];\n                        this.loading = false;\n                    } else {\n                        this.loading = false;\n                        this.$Message.error(res.msg);\n                    }\n                }).catch(res => {\n                    this.loading = false;\n                    this.$Message.error(res.msg);\n                });\n            },\n            // 会员详情\n            getDetails (id) {\n                this.userId = id;\n                this.spinShow = true;\n                detailsApi(id).then(async res => {\n                    if (res.status === 200) {\n                        let data = res.data\n                        this.detailsData = data.headerList;\n                        if(this.fromType !== 'order'){\n                            let groupItem = this.groupList.find(item => item.id == data.ps_info.group_id);\n                            if (groupItem) {\n                                data.ps_info.group_name = groupItem.group_name;\n                            }\n                        }\n                        this.psInfo = data.ps_info;\n                        this.workMemberInfo = data.workMemberInfo;\n                        this.workClientInfo = data.workClientInfo;\n                        this.spinShow = false;\n                    } else {\n                        this.spinShow = false;\n                        this.$Message.error(res.msg);\n                    }\n                }).catch(res => {\n                    this.spinShow = false;\n                    this.$Message.error(res.msg);\n                })\n            },\n            pageChange (index) {\n                this.userFrom.page = index\n                   this.changeType(this.userFrom.type);\n                // switch (this.activeName) {\n                //     case 'visit':\n                //        this.changeType(this.userFrom.type);\n                //         break;\n                //     case 'spread_change':\n                //        this.changeType(this.userFrom.type);\n                //         break;\n                //     default:\n                //         this.changeType(this.userFrom.type);\n                //         break;\n                // }\n            },\n            // tab选项\n            changeType (name) {\n                this.loading = true;\n                this.userFrom.type = name;\n                this.activeName = name;\n                let data = {\n                    id: this.userId,\n                    datas: this.userFrom\n                }\n                infoApi(data).then(async res => {\n                    if (res.status === 200) {\n                        let data = res.data\n                        this.userLists = data.list;\n                        this.total = data.count;\n                        switch (this.userFrom.type) {\n                        case 'order':\n                            this.columns = [\n                                {\n                                    title: '订单ID',\n                                    key: 'order_id',\n                                    minWidth: 160\n                                },\n                                {\n                                    title: '收货人',\n                                    key: 'real_name',\n                                    minWidth: 100\n                                },\n                                {\n                                    title: '商品数量',\n                                    key: 'total_num',\n                                    minWidth: 90\n                                },\n                                {\n                                    title: '商品总价',\n                                    key: 'total_price',\n                                    minWidth: 110\n                                },\n                                {\n                                    title: '实付金额',\n                                    key: 'pay_price',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '交易完成时间',\n                                    key: 'pay_time',\n                                    minWidth: 120\n                                }\n                            ]\n                            break;\n                        case 'integral':\n                            this.columns = [\n                                {\n                                    title: '来源/用途',\n                                    key: 'title',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '积分变化',\n                                    key: 'number',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '变化前积分',\n                                    key: 'balance',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '日期',\n                                    key: 'add_time',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '备注',\n                                    key: 'mark',\n                                    minWidth: 120\n                                }\n                            ]\n                            break;\n                        case 'sign':\n                            this.columns = [\n                                // {\n                                //     title: '动作',\n                                //     key: 'title',\n                                //     minWidth: 120\n                                // },\n                                {\n                                    title: '获得积分',\n                                    key: 'number',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '签到时间',\n                                    key: 'add_time',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '备注',\n                                    key: 'mark',\n                                    minWidth: 120\n                                }\n                            ]\n                            break;\n                        case 'coupon':\n                            this.columns = [\n                                {\n                                    title: '优惠券名称',\n                                    key: 'coupon_title',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '面值',\n                                    slot: 'coupon_price',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '有效期(天)',\n                                    key: 'coupon_time',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '兑换时间',\n                                    key: '_add_time',\n                                    minWidth: 120\n                                }\n                            ]\n                            break;\n                        case 'balance_change':\n                            this.columns = [\n                                {\n                                    title: '动作',\n                                    key: 'title',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '变动金额',\n                                    key: 'number',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '变动后',\n                                    key: 'balance',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '创建时间',\n                                    key: 'add_time',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '备注',\n                                    key: 'mark',\n                                    minWidth: 120\n                                }\n                            ]\n                            break;\n                              case 'visit':\n                this.columns = [\n                  {\n                    title: '商品信息',\n                    slot: 'product',\n                    minWidth: 400,\n                  },\n                  {\n                    title: '价格',\n                    key: 'product_price',\n                    minWidth: 120,\n                    render: (h, params) => {\n                      return h('div', `¥${params.row.product_price}`)\n                    },\n                  },\n                  {\n                    title: '浏览时间',\n                    key: 'add_time',\n                    minWidth: 120,\n                  },\n                ]\n                break\n              case 'spread_change':\n                this.columns = [\n                  {\n                    title: '推荐人ID',\n                    key: 'spread_uid',\n                    minWidth: 120,\n                  },\n                  {\n                    title: '推荐人',\n                    key: 'nickname',\n                    minWidth: 120,\n                    render: (h, params) => {\n                      return h('div', [\n                        h('img', {\n                          style: {\n                            borderRadius: '50%',\n                            marginRight: '10px',\n                            verticalAlign: 'middle',\n                          },\n                          attrs: {\n                            with: 38,\n                            height: 38,\n                          },\n                          directives: [\n                            {\n                              name: 'lazy',\n                              value: params.row.avatar,\n                            },\n                            {\n                              name: 'viewer',\n                            },\n                          ],\n                        }),\n                        h(\n                          'span',\n                          {\n                            style: {\n                              verticalAlign: 'middle',\n                            },\n                          },\n                          params.row.nickname\n                        ),\n                      ])\n                    },\n                  },\n                  {\n                    title: '变更方式',\n                    key: 'type',\n                    minWidth: 120,\n                  },\n                  {\n                    title: '变更时间',\n                    key: 'spread_time',\n                    minWidth: 120,\n                  },\n                ]\n                break;\n                        default:\n                            this.columns = [\n                                {\n                                    title: 'ID',\n                                    key: 'uid',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '昵称',\n                                    key: 'nickname',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '等级',\n                                    key: 'type',\n                                    minWidth: 120\n                                },\n                                {\n                                    title: '加入时间',\n                                    key: 'add_time',\n                                    minWidth: 120\n                                }\n                            ]\n                        }\n                        this.loading = false;\n                    } else {\n                        this.loading = false;\n                        this.$Message.error(res.msg);\n                    }\n                }).catch(res => {\n                    this.loading = false;\n                    this.$Message.error(res.msg);\n                })\n            }\n        }\n    }\n",null]}