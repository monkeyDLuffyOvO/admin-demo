{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/app/wechat/menus/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/app/wechat/menus/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n\twechatMenuApi,\n\tMenuApi\n} from '@/api/app';\nexport default {\n\tname: 'wechatMenus',\n\tdata() {\n\t\treturn {\n\t\t\tmodal2: false,\n\t\t\tformValidate: {\n\t\t\t\tname: '',\n\t\t\t\ttype: 'click',\n\t\t\t\tappid: '',\n\t\t\t\turl: '',\n\t\t\t\tkey: '',\n\t\t\t\tpagepath: '',\n\t\t\t\tid: 0\n\t\t\t},\n\t\t\truleValidate: {\n\t\t\t\tname: [{\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tmessage: '请填写菜单名称',\n\t\t\t\t\t\ttrigger: 'blur'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t\tmax: 8,\n\t\t\t\t\t\tmessage: '长度在 1 到 8 个字符',\n\t\t\t\t\t\ttrigger: 'blur'\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tkey: [{\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请填写关键字',\n\t\t\t\t\ttrigger: 'blur'\n\t\t\t\t}],\n\t\t\t\tappid: [{\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请填写appid',\n\t\t\t\t\ttrigger: 'blur'\n\t\t\t\t}],\n\t\t\t\tpagepath: [{\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请填写小程序跳转路径',\n\t\t\t\t\ttrigger: 'blur'\n\t\t\t\t}],\n\t\t\t\turl: [{\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请填写小程序跳转路径',\n\t\t\t\t\ttrigger: 'blur'\n\t\t\t\t}],\n\t\t\t\ttype: [{\n\t\t\t\t\trequired: true,\n\t\t\t\t\tmessage: '请选择规则状态',\n\t\t\t\t\ttrigger: 'change'\n\t\t\t\t}]\n\t\t\t},\n\t\t\tparentMenuId: null,\n\t\t\tlist: [],\n\t\t\tcheckedMenuId: null,\n\t\t\tisTrue: false\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.getMenus();\n\t\tif (this.list.length) {\n\t\t\tthis.formValidate = this.list[this.activeClass];\n\t\t} else {\n\t\t\treturn this.formValidate\n\t\t}\n\t},\n\tmethods: {\n\t\t// 添加一级字段函数\n\t\tdefaultMenusData() {\n\t\t\treturn {\n\t\t\t\ttype: 'click',\n\t\t\t\tname: '',\n\t\t\t\tsub_button: []\n\t\t\t};\n\t\t},\n\t\t// 添加二级字段函数\n\t\tdefaultChildData() {\n\t\t\treturn {\n\t\t\t\ttype: 'click',\n\t\t\t\tname: ''\n\t\t\t};\n\t\t},\n\t\t// 获取 菜单\n\t\tgetMenus() {\n\t\t\twechatMenuApi().then(async res => {\n\t\t\t\tlet data = res.data\n\t\t\t\tthis.list = data.menus;\n\t\t\t}).catch(res => {\n\t\t\t\tthis.$Message.error(res.msg);\n\t\t\t})\n\t\t},\n\t\t// 点击保存提交\n\t\tsubmenus(name) {\n\t\t\tif (this.isTrue && !this.checkedMenuId && this.checkedMenuId !== 0) {\n\t\t\t\tthis.putData();\n\t\t\t} else {\n\t\t\t\tthis.$refs[name].validate((valid) => {\n\t\t\t\t\tif (valid) {\n\t\t\t\t\t\tthis.putData();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!this.check()) return false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t// 新增data\n\t\tputData() {\n\t\t\tlet data = {\n\t\t\t\tbutton: this.list\n\t\t\t}\n\t\t\tMenuApi(data).then(async res => {\n\t\t\t\tthis.$Message.success(res.msg);\n\t\t\t\tthis.checkedMenuId = null;\n\t\t\t\tthis.formValidate = {};\n\t\t\t\tthis.isTrue = false;\n\t\t\t}).catch(res => {\n\t\t\t\tthis.$Message.error(res.msg);\n\t\t\t})\n\t\t},\n\t\t// 点击元素\n\t\tgettem(item, index, pid) {\n\t\t\tthis.checkedMenuId = index;\n\t\t\tthis.formValidate = item;\n\t\t\tthis.parentMenuId = pid;\n\t\t\tthis.isTrue = true;\n\t\t},\n\t\t// 增加二级\n\t\tadd(item, index) {\n\t\t\tif (!this.check()) return false;\n\t\t\tif (item.sub_button.length < 5) {\n\t\t\t\tlet data = this.defaultChildData();\n\t\t\t\tlet id = item.sub_button.length;\n\t\t\t\titem.sub_button.push(data);\n\t\t\t\tthis.formValidate = data;\n\t\t\t\tthis.checkedMenuId = id;\n\t\t\t\tthis.parentMenuId = index;\n\t\t\t\tthis.isTrue = true;\n\t\t\t}\n\t\t},\n\t\t// 增加一级\n\t\taddtext() {\n\t\t\tif (!this.check()) return false;\n\t\t\tlet data = this.defaultMenusData();\n\t\t\tlet id = this.list.length;\n\t\t\tthis.list.push(data);\n\t\t\tthis.formValidate = data;\n\t\t\tthis.checkedMenuId = id;\n\t\t\tthis.parentMenuId = null;\n\t\t\tthis.isTrue = true;\n\t\t},\n\t\t// 判断函数\n\t\tcheck: function() {\n\t\t\tlet reg = /[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\\.?/;\n\t\t\tif (this.checkedMenuId === null) return true;\n\t\t\tif (!this.isTrue) return true;\n\t\t\tif (!this.formValidate.name) {\n\t\t\t\tthis.$Message.warning('请输入按钮名称!');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.formValidate.type === 'click' && !this.formValidate.key) {\n\t\t\t\tthis.$Message.warning('请输入关键字!');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.formValidate.type === 'view' && !(reg.test(this.formValidate.url))) {\n\t\t\t\tthis.$Message.warning('请输入正确的跳转地址!');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this.formValidate.type === 'miniprogram' &&\n\t\t\t\t(!this.formValidate.appid ||\n\t\t\t\t\t!this.formValidate.pagepath ||\n\t\t\t\t\t!this.formValidate.url)) {\n\t\t\t\tthis.$Message.warning('请填写完整小程序配置!');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t// 删除\n\t\tdeltMenus() {\n\t\t\tif (this.isTrue) {\n\t\t\t\tthis.modal2 = true;\n\t\t\t} else {\n\t\t\t\tthis.$Message.warning('请选择菜单!');\n\t\t\t}\n\t\t},\n\t\t// 确认删除\n\t\tdel() {\n\t\t\tthis.parentMenuId === null ? this.list.splice(this.checkedMenuId, 1) : this.list[this.parentMenuId]\n\t\t\t\t.sub_button.splice(this.checkedMenuId, 1);\n\t\t\tthis.parentMenuId = null;\n\t\t\tthis.formValidate = {\n\t\t\t\tname: '',\n\t\t\t\ttype: 'click',\n\t\t\t\tappid: '',\n\t\t\t\turl: '',\n\t\t\t\tkey: '',\n\t\t\t\tpagepath: '',\n\t\t\t\tid: 0\n\t\t\t};\n\t\t\tthis.isTrue = true;\n\t\t\tthis.modal2 = false;\n\t\t\tthis.checkedMenuId = null;\n\t\t\tthis.$refs['formValidate'].resetFields();\n\t\t}\n\t}\n}\n",null]}