{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/setting/storeService/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/setting/storeService/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\";\nimport util from \"@/libs/util\";\nimport {\n  kefuListApi,\n  kefucreateApi,\n  kefuaddApi,\n  kefuAddApi,\n  kefusetStatusApi,\n  kefuEditApi,\n  kefuRecordApi,\n  kefuChatlistApi,\n  kefuLogin,\n} from \"@/api/setting\";\nexport default {\n  name: \"index\",\n  filters: {\n    typeFilter(status) {\n      const statusMap = {\n        wechat: \"微信用户\",\n        routine: \"小程序用户\",\n      };\n      return statusMap[status];\n    },\n  },\n  computed: {\n    ...mapState(\"admin/layout\", [\"isMobile\"]),\n    ...mapState(\"admin/userLevel\", [\"categoryId\"]),\n    labelWidth() {\n      return this.isMobile ? undefined : 80;\n    },\n    labelPosition() {\n      return this.isMobile ? \"top\" : \"left\";\n    },\n  },\n  data() {\n    return {\n      isChat: true,\n      formValidate3: {\n        page: 1,\n        limit: 15,\n      },\n      total3: 0,\n      loading3: false,\n      modals3: false,\n      tableList3: [],\n      columns3: [\n        {\n          title: \"用户名称\",\n          key: \"nickname\",\n          width: 200,\n        },\n        {\n          title: \"客服头像\",\n          slot: \"headimgurl\",\n        },\n        {\n          title: \"操作\",\n          slot: \"action\",\n        },\n      ],\n      formValidate5: {\n        page: 1,\n        limit: 15,\n        uid: 0,\n        to_uid: 0,\n        id: 0,\n      },\n      total5: 0,\n      loading5: false,\n      tableList5: [],\n      columns5: [\n        {\n          title: \"用户名称\",\n          key: \"nickname\",\n          width: 200,\n        },\n        {\n          title: \"用户头像\",\n          slot: \"avatar\",\n        },\n        {\n          title: \"发送消息\",\n          key: \"msn\",\n          width: 250,\n        },\n        {\n          title: \"发送时间\",\n          key: \"add_time\",\n        },\n      ],\n      FromData: null,\n      formValidate: {\n        page: 1,\n        limit: 15,\n        data: \"\",\n        type: \"\",\n        nickname: \"\",\n      },\n      tableList2: [],\n      modals: false,\n      total: 0,\n      tableFrom: {\n        page: 1,\n        limit: 15,\n      },\n      timeVal: [],\n      fromList: {\n        title: \"选择时间\",\n        custom: true,\n        fromTxt: [\n          { text: \"全部\", val: \"\" },\n          { text: \"今天\", val: \"today\" },\n          { text: \"昨天\", val: \"yesterday\" },\n          { text: \"最近7天\", val: \"lately7\" },\n          { text: \"最近30天\", val: \"lately30\" },\n          { text: \"本月\", val: \"month\" },\n          { text: \"本年\", val: \"year\" },\n        ],\n      },\n      loading: false,\n      tableList: [],\n      columns1: [\n        {\n          title: \"ID\",\n          key: \"id\",\n          width: 80,\n        },\n        {\n          title: \"微信用户名称\",\n          key: \"nickname\",\n          minWidth: 120,\n        },\n        {\n          title: \"客服头像\",\n          slot: \"avatar\",\n          minWidth: 60,\n        },\n        {\n          title: \"客服名称\",\n          key: \"wx_name\",\n          minWidth: 120,\n        },\n        {\n          title: \"企微员工\",\n          slot: \"workMember\",\n          minWidth: 120,\n        },\n        {\n          title: \"账号状态\",\n          slot: \"account_status\",\n          minWidth: 120,\n        },\n        {\n          title: \"添加时间\",\n          key: \"add_time\",\n          minWidth: 130,\n        },\n        {\n          title: \"操作\",\n          slot: \"action\",\n          fixed: \"right\",\n          width: 200,\n        },\n      ],\n      columns4: [\n        {\n          type: \"selection\",\n          width: 60,\n          align: \"center\",\n        },\n        {\n          title: \"ID\",\n          key: \"uid\",\n          width: 80,\n        },\n        {\n          title: \"微信用户名称\",\n          key: \"nickname\",\n          minWidth: 160,\n        },\n        {\n          title: \"客服头像\",\n          slot: \"headimgurl\",\n          minWidth: 60,\n        },\n        {\n          title: \"用户类型\",\n          slot: \"user_type\",\n          width: 100,\n        },\n        {\n          title: \"性别\",\n          slot: \"sex\",\n          minWidth: 60,\n        },\n        {\n          title: \"地区\",\n          slot: \"country\",\n          minWidth: 120,\n        },\n        {\n          title: \"是否关注公众号\",\n          slot: \"subscribe\",\n          minWidth: 120,\n        },\n      ],\n      loading2: false,\n      total2: 0,\n      addFrom: {\n        uids: [],\n      },\n      selections: [],\n      rows: {},\n      rowRecord: {},\n    };\n  },\n  created() {\n    this.getList();\n  },\n  methods: {\n    // 进入工作台\n    goChat(item) {\n      kefuLogin(item.id)\n        .then((res) => {\n          var url = \"\";\n          if (res.data.token) {\n            let expires = this.getExpiresTime(res.data.exp_time);\n            util.cookies.setKefu(\"token\", res.data.token, expires);\n            util.cookies.setKefu(\"uuid\", res.data.kefuInfo.uid, expires);\n            util.cookies.setKefu(\"expires_time\", res.data.exp_time, expires);\n            util.cookies.setKefu(\"kefuInfo\", res.data.kefuInfo, expires);\n            if (this.$store.state.admin.layout.isMobile) {\n              url =\n                window.location.protocol +\n                \"//\" +\n                window.location.host +\n                \"/kefu/mobile_list\";\n            } else {\n              url =\n                window.location.protocol +\n                \"//\" +\n                window.location.host +\n                \"/kefu/pc_list\";\n            }\n            window.open(url, \"_blank\");\n          }\n        })\n        .catch((error) => {\n          this.$Message.error(error.msg);\n        });\n    },\n    getExpiresTime(expiresTime) {\n      let nowTimeNum = Math.round(new Date() / 1000);\n      let expiresTimeNum = expiresTime - nowTimeNum;\n      return parseFloat(parseFloat(parseFloat(expiresTimeNum / 60) / 60) / 24);\n    },\n    cancel() {\n      this.formValidate = {\n        page: 1,\n        limit: 10,\n        data: \"\",\n        type: \"\",\n        nickname: \"\",\n      };\n    },\n    handleReachBottom() {\n      return new Promise((resolve) => {\n        this.formValidate.page = this.formValidate.page + 1;\n        setTimeout(() => {\n          // this.loading2 = true;\n          kefucreateApi(this.formValidate)\n            .then(async (res) => {\n              let data = res.data;\n              // this.tableList2 = data.list;\n              if (data.list.length > 0) {\n                for (let i = 0; i < data.list.length; i++) {\n                  this.tableList2.push(data.list[i]);\n                }\n              }\n              this.total2 = data.count;\n              this.loading2 = false;\n            })\n            .catch((res) => {\n              this.loading2 = false;\n              this.$Message.error(res.msg);\n            });\n          resolve();\n        }, 2000);\n      });\n    },\n    // 查看对话\n    look(row) {\n      this.isChat = false;\n      this.rowRecord = row;\n      this.getChatlist();\n    },\n    // 查看对话列表\n    getChatlist() {\n      this.loading5 = true;\n      this.formValidate5.uid = this.rows.uid;\n      this.formValidate5.to_uid = this.rowRecord.uid;\n      this.formValidate5.id = this.rows.id;\n      kefuChatlistApi(this.formValidate5)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList5 = data.list;\n          this.total5 = data.count;\n          this.loading5 = false;\n        })\n        .catch((res) => {\n          this.loading5 = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange5(index) {\n      this.formValidate5.page = index;\n      this.getChatlist();\n    },\n    // 修改成功\n    submitFail() {\n      this.getList();\n    },\n    // 聊天记录\n    record(row) {\n      this.rows = row;\n      this.modals3 = true;\n      this.isChat = true;\n      this.getListRecord();\n    },\n    // 聊天记录列表\n    getListRecord() {\n      this.loading3 = true;\n      kefuRecordApi(this.formValidate3, this.rows.id)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList3 = data.list ? data.list : [];\n          this.total3 = data.count;\n          this.loading3 = false;\n        })\n        .catch((res) => {\n          this.loading3 = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange3(index) {\n      this.formValidate3.page = index;\n      this.getListRecord();\n    },\n    // 编辑\n    edit(row) {\n      this.$modalForm(kefuEditApi(row.id)).then(() => this.getList());\n    },\n    // 添加\n    add() {\n      // this.modals = true;\n      // this.formValidate.data = '';\n      // this.getListService();\n      this.$modalForm(kefuaddApi()).then(() => this.getList());\n    },\n    // 全选\n    onSelectTab(selection) {\n      this.selections = selection;\n      let data = [];\n      this.selections.map((item) => {\n        data.push(item.uid);\n      });\n      this.addFrom.uids = data;\n    },\n    // 具体日期\n    onchangeTime(e) {\n      this.timeVal = e;\n      this.formValidate.data = this.timeVal[0] ? this.timeVal.join(\"-\") : \"\";\n      this.formValidate.page = 1;\n      this.getListService();\n    },\n    // 选择时间\n    selectChange(tab) {\n      this.formValidate.data = tab;\n      this.timeVal = [];\n      this.formValidate.page = 1;\n      this.getListService();\n    },\n    // 客服列表\n    getListService() {\n      this.loading2 = true;\n      kefucreateApi(this.formValidate)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList2 = data.list;\n          this.total2 = data.count;\n          this.tableList2.map((item) => {\n            item._isChecked = false;\n          });\n          this.loading2 = false;\n        })\n        .catch((res) => {\n          this.loading2 = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange2(pageIndex) {\n      this.formValidate.page = pageIndex;\n      this.getListService();\n      this.addFrom.uids = [];\n    },\n    // 搜索\n    userSearchs() {\n      this.formValidate.page = 1;\n      this.getListService();\n    },\n    // 删除\n    del(row, tit, num) {\n      let delfromData = {\n        title: tit,\n        num: num,\n        url: `app/wechat/kefu/${row.id}`,\n        method: \"DELETE\",\n        ids: \"\",\n      };\n      this.$modalSure(delfromData)\n        .then((res) => {\n          this.$Message.success(res.msg);\n          this.tableList.splice(num, 1);\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    // 列表\n    getList() {\n      this.loading = true;\n      kefuListApi(this.tableFrom)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList = data.list;\n          this.total = res.data.count;\n          this.loading = false;\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange(index) {\n      this.tableFrom.page = index;\n      this.getList();\n    },\n    // 修改是否显示\n    onchangeIsShow(row) {\n      let data = {\n        id: row.id,\n        account_status: row.account_status,\n      };\n      kefusetStatusApi(data)\n        .then(async (res) => {\n          this.$Message.success(res.msg);\n          this.getList();\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    // 添加客服\n    putRemark() {\n      if (this.addFrom.uids.length === 0) {\n        return this.$Message.warning(\"请选择要添加的客服\");\n      }\n      kefuAddApi(this.addFrom)\n        .then(async (res) => {\n          this.$Message.success(res.msg);\n          this.modals = false;\n          this.getList();\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    // 进入工作台\n    // goChat(item){\n    //     kefuLogin(item.id).then(res=>{\n    //         if(res.data.token){\n    //             let expires = this.getExpiresTime(res.data.exp_time);\n    //             util.cookies.setKefu('token', res.data.token, {\n    //                 expires:expires\n    //             });\n    //             util.cookies.setKefu('uuid', res.data.kefuInfo.uid, {\n    //                 expires: expires\n    //             });\n    //             util.cookies.setKefu('expires_time', res.data.exp_time, {\n    //                 expires: expires\n    //             });\n    //             let url = window.location.protocol+\"//\"+window.location.host + '/kefu';\n    //             window.open(url, '_blank');\n    //         }\n    //     })\n    // },\n    // getExpiresTime (expiresTime) {\n    //     let nowTimeNum = Math.round(new Date() / 1000);\n    //     let expiresTimeNum = expiresTime - nowTimeNum;\n    //     return parseFloat(parseFloat(parseFloat(expiresTimeNum / 60) / 60) / 24);\n    // },\n  },\n};\n",null]}