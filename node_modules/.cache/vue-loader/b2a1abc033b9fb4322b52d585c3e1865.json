{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/work/welcome/addWelcome.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/work/welcome/addWelcome.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\";\nimport uploadPictures from \"@/components/uploadPictures\";\nimport { getNewFormBuildRuleApi } from \"@/api/setting\";\nimport department from \"@/components/department/index.vue\";\nimport {workWelcomeSave,getWelcomeInfo,welcomeUpdate} from \"@/api/work\"\nexport default {\n  data() {\n    return {\n      formItem: {\n        sort:0,\n        type:\"0\",\n        userids:[],\n        content: \"\",\n        attachments: [],\n      },\n      gridBtn: {\n        xl: 4,\n        lg: 8,\n        md: 8,\n        sm: 8,\n        xs: 8,\n      },\n      gridPic: {\n        xl: 6,\n        lg: 8,\n        md: 12,\n        sm: 12,\n        xs: 12,\n      },\n      rontineObj:{\n        msgtype: \"miniprogram\",\n        miniprogram:{\n          pic_url:\"\",\n          pic_media_id:\"\",\n          title:\"\",\n          appid:\"\",\n          page:\"\"\n        }\n      },\n      imageObj:{\n        msgtype: \"image\",\n        image:{\n          media_id:\"\",\n          pic_url:\"\"\n        }\n      },\n      picTit:\"\",\n      modalPic: false,\n      modalRoutine: false,\n      isChoice: \"单选\",\n      activeDepartment: {},\n      isSite: true,\n      onlyDepartment: false,\n      openType:'',\n      userList:[]\n    };\n  },\n    components: { uploadPictures, department },\n  computed: {\n    ...mapState(\"admin/layout\", [\"isMobile\",\"menuCollapse\"]),\n    labelWidth() {\n      return this.isMobile ? undefined : 80;\n    },\n    labelPosition() {\n      return this.isMobile ? \"top\" : \"left\";\n    },\n  },\n  mounted() {\n    if (this.$route.params.id !== \"0\" && this.$route.params.id) {\n      this.getInfo();\n    } else if (!this.$route.params.id){\n      \n    }\n  },\n  methods: {\n    modalPicTap(picTit){\n      this.modalPic = true;\n      this.picTit = picTit;\n    },\n    addRoutine() {\n      getNewFormBuildRuleApi('routine').then(res => {\n          let data = res.data;\n          this.rontineObj.miniprogram.pic_url = '';\n          this.rontineObj.miniprogram.title = data.routine_name.value;\n          this.rontineObj.miniprogram.appid = data.routine_appId.value;\n          this.rontineObj.miniprogram.page = '/pages/index/index';\n      })\n      this.modalRoutine = true;\n    },\n    addUser(){\n      this.userList = this.formItem.userids;\n      this.$refs.department.memberStatus = true;\n    },\n    //tag标签删除成员\n    handleDel(e,name){\n        // let index = this.formItem.userids.indexOf(name);\n        // this.formItem.userids.splice(index, 1);\n        let i = this.formItem.userids.findIndex((item) => item.name == name);\n        this.formItem.userids.splice(i,1);\n    },\n    //欢迎语tag删除\n    wordsDel(name){\n      let index = this.formItem.attachments.indexOf(name);\n      this.formItem.attachments.splice(index,1);\n    },\n    changeMastart(arr,type){\n        this.formItem.userids = arr.map(item=>{\n            return {\n              userid:item.userid, \n              name:item.name,\n            }\n        })\n    },\n    // 选中图片\n    getPic(pc) {\n      switch (this.picTit) {\n        case \"image\":\n          this.imageObj.image.pic_url = pc.att_dir;\n          this.formItem.attachments.push(this.imageObj)\n          break;\n        case \"routine\":\n          this.rontineObj.miniprogram.pic_url = pc.att_dir;\n          break;\n      }\n      this.modalPic = false;\n    },\n    insertName(){\n      this.formItem.content = this.formItem.content.concat('##客户名称##');\n    },\n    routineConfirm() {\n      const routine = this.deepClone(this.rontineObj);\n      this.formItem.attachments.push(routine)\n    },\n    getInfo(){\n        getWelcomeInfo(this.$route.params.id).then(res=>{\n            this.formItem.type = res.data.type.toString();\n            this.formItem.attachments = res.data.attachments;\n            this.formItem.content = res.data.content;\n            this.formItem.sort = res.data.sort;\n            if(res.data.userList.length){\n              this.formItem.userids = res.data.userList.map(item=>{\n                return {\n                    userid:item.userid,\n                    welcome_id:item.welcome_id,\n                    name:item.member.name\n                }\n              })\n            }else{\n              this.$set(this.formItem,'userids',[]);\n            }\n            \n        }).catch(err=>{\n            this.$Message.error(err.msg);\n        })\n    },\n    submit(){\n        const formData = this.deepClone(this.formItem)\n        if(formData.type == 1){\n            formData.userids = formData.userids.map(item=>{\n                return item.userid\n            })\n        }\n        if(formData.type == 0 && formData.userids.length){\n            formData.userids = formData.userids.map(item=>{\n                return item.userid\n            })\n            delete formData.userList\n          }\n        formData.type = Number(formData.type);\n        if (this.$route.params.id !== \"0\" && this.$route.params.id) {\n            welcomeUpdate(this.$route.params.id,formData).then(res=>{\n                this.$Message.success(\"欢迎语修改成功\");\n                this.$router.push('/admin/work/welcome')\n            }).catch(err=>{\n                this.$Message.error(err.msg)\n            })\n        } else if (!this.$route.params.id){\n            workWelcomeSave(formData).then(res=>{\n                this.$Message.success(\"欢迎语新建成功\");\n                this.$router.push('/admin/work/welcome')\n            }).catch(err=>{\n                this.$Message.error(err.msg)\n            })\n        }\n    },\n    //深克隆\n    deepClone(obj) {\n        let newObj = Array.isArray(obj) ? [] : {}\n        if (obj && typeof obj === \"object\") {\n            for (let key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    newObj[key] = (obj && typeof obj[key] === 'object') ? this.deepClone(obj[key]) : obj[key];\n                }\n            }\n        } \n        return newObj\n    },\n  },\n};\n",null]}