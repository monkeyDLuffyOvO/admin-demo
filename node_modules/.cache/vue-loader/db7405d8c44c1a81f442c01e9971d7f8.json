{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/product/productAdd/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/product/productAdd/index.vue","mtime":1663723634000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import COS from 'cos-js-sdk-v5'\nimport { mapState,mapMutations } from \"vuex\";\nimport Setting from \"@/setting\";\nimport util from \"@/libs/util\";\nimport vuedraggable from \"vuedraggable\";\nimport uploadPictures from \"@/components/uploadPictures\";\nimport freightTemplate from \"@/components/freightTemplate\";\nimport wangeditor from \"@/components/wangEditor/index.vue\";\n\nimport menusFrom from \"../productBrand/components/menusFrom\";\nimport userLabel from \"@/components/labelList\";\nimport storeLabelList from \"@/components/storeLabelList\";\nimport couponList from \"@/components/couponList\";\nimport goodsList from '@/components/goodsList/index';\nimport addAttr from \"../productAttr/addAttr\";\nimport attrList from \"../components/attrList\";\nimport addCarMy from \"../components/addCarMy\";\nimport VueUeditorWrap from \"vue-ueditor-wrap\";\nimport taoBao from './taoBao'\nimport {\n  productInfoApi,\n  cascaderListApi,\n  productAddApi,\n  generateAttrApi,\n  productGetRuleApi,\n  productGetTemplateApi,\n  productGetTempKeysApi,\n  checkActivityApi,\n  labelListApi,\n  productCache,\n  cacheDelete,\n\tbrandList,\n\tproductCreateApi,\n\tproductAllUnit,\n\tproductUnitCreate,\n\tuploadType,\n\tproductAllEnsure,\n\tproductLabelAdd,\n\tproductAllSpecs\n} from \"@/api/product\";\nimport {getSupplierList} from '@/api/supplier'\nimport { erpConfig } from \"@/api/erp\";\nimport { uploadByPieces } from \"@/utils/upload\"; //引入uploadByPieces方法\nexport default {\n  name: \"product_productAdd\",\n  components: {\n    VueUeditorWrap,\n    uploadPictures,\n    freightTemplate,\n\tgoodsList,\n    addAttr,\n    couponList,\n    taoBao,\n\tuserLabel,\n\tmenusFrom,\n\tattrList,\n\taddCarMy,\n\tstoreLabelList,\n\twangeditor,\n    draggable: vuedraggable,\n  },\n  data() {\n    return {\n\t\t\tspecsList:[],\n\t\t\tsupplierList:[],\n\t\t\tspecsColumns:[\n\t\t\t\t{\n\t\t\t\t    title: '参数名称',\n\t\t\t\t    key: 'name',\n\t\t\t\t\t\talign:'center',\n\t\t\t\t    width: 150,\n\t\t\t\t\t\trender: (h, params) => {\n\t\t\t\t\t\t  return h(\"div\", [\n\t\t\t\t\t\t    h(\"Input\", {\n\t\t\t\t\t\t      props: {\n\t\t\t\t\t\t        value: params.row.name,\n\t\t\t\t\t\t\t\tplaceholder:'请输入参数名称'\n\t\t\t\t\t\t      },\n\t\t\t\t\t\t      on: {\n\t\t\t\t\t\t        \"on-change\": (e) => {\n\t\t\t\t\t\t          params.row.name = e.target.value;\n\t\t\t\t\t\t          this.specsList[params.index].name = e.target.value;\n\t\t\t\t\t\t        },\n\t\t\t\t\t\t      },\n\t\t\t\t\t\t    }),\n\t\t\t\t\t\t  ]);\n\t\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t    title: '参数值',\n\t\t\t\t    key: 'value',\n\t\t\t\t\t\talign:'center',\n\t\t\t\t    width: 300,\n\t\t\t\t\t\trender: (h, params) => {\n\t\t\t\t\t\t  return h(\"div\", [\n\t\t\t\t\t\t    h(\"Input\", {\n\t\t\t\t\t\t      props: {\n\t\t\t\t\t\t        value: params.row.value,\n\t\t\t\t\t\t\t\tplaceholder:'请输入参数值'\n\t\t\t\t\t\t      },\n\t\t\t\t\t\t      on: {\n\t\t\t\t\t\t        \"on-change\": (e) => {\n\t\t\t\t\t\t          params.row.value = e.target.value;\n\t\t\t\t\t\t          this.specsList[params.index].value = e.target.value;\n\t\t\t\t\t\t        },\n\t\t\t\t\t\t      },\n\t\t\t\t\t\t    }),\n\t\t\t\t\t\t  ]);\n\t\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t    title: '排序',\n\t\t\t\t    key: 'sort',\n\t\t\t\t\talign:'center',\n\t\t\t\t    width: 100,\n\t\t\t\t\trender: (h, params) => {\n\t\t\t\t\t\treturn h(\"div\", [\n\t\t\t\t\t\t\th(\"InputNumber\", {\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tvalue: parseInt(params.row.sort) || 0,\n\t\t\t\t\t\t\t\t\tplaceholder:'排序',\n\t\t\t\t\t\t\t\t\tprecision:0\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\"on-change\": (e) => {\n\t\t\t\t\t\t\t\t\t\tparams.row.sort = e;\n\t\t\t\t\t\t\t\t\t\tthis.specsList[params.index].sort = e;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t    title: '操作',\n\t\t\t\t    slot: 'action',\n\t\t\t\t\t\talign:'center',\n\t\t\t\t    minWidth: 120\n\t\t\t\t}\n\t\t\t],\n\t\t//自定义留言下拉选择\n\t\tcustomList: [\n\t\t  {\n\t\t    value: \"text\",\n\t\t    label: \"文本框\",\n\t\t  },\n\t\t  {\n\t\t    value: \"number\",\n\t\t    label: \"数字\",\n\t\t  },\n\t\t  {\n\t\t    value: \"email\",\n\t\t    label: \"邮件\",\n\t\t  },\n\t\t  {\n\t\t    value: \"data\",\n\t\t    label: \"日期\",\n\t\t  },\n\t\t  {\n\t\t    value: \"time\",\n\t\t    label: \"时间\",\n\t\t  },\n\t\t  {\n\t\t    value: \"id\",\n\t\t    label: \"身份证\",\n\t\t  },\n\t\t  {\n\t\t    value: \"phone\",\n\t\t    label: \"手机号\",\n\t\t  },\n\t\t  {\n\t\t    value: \"img\",\n\t\t    label: \"图片\",\n\t\t  },\n\t\t],\n\t\theadTab: [\n\t\t  { title: \"基础信息\", name: \"1\" },\n\t\t  { title: \"规格库存\", name: \"2\" },\n\t\t  { title: \"商品详情\", name: \"3\" },\n\t\t  { title: \"物流设置\", name: \"4\" },\n\t\t  { title: \"营销设置\", name: \"5\" },\n\t\t  { title: \"其他设置\", name: \"6\" },\n\t\t],\n\t\tproductType: [\n\t\t  { name: \"普通商品\", title: \"物流发货\", id: 0 },\n\t\t  { name: \"卡密/网盘\", title: \"自动发货\", id: 1 },\n\t\t  { name: \"虚拟商品\", title: \"虚拟发货\", id: 3 },\n\t\t],\n\t\tvirtualList:[],\n\t\tcarMyShow: false,//是否开启卡密弹窗\n\t\trecommend: [], //商品推荐\n\t\tcustomBtn: false, //自定义留言开关\n\t\tattrShow:false,\n\t\tcontent: \"\",\n\t\tcontents: \"\",\n\t\tseletVideo: 0,\n\t\tfileUrl: Setting.apiBaseURL + \"/file/upload\",\n\t\tfileUrl2: Setting.apiBaseURL + \"/file/video_upload\",\n\t\tupload_type: \"\", //视频上传类型 1 本地上传 2 3 4 OSS上传\n\t\tuploadData: {}, // 上传参数\n\t\theader: {},\n\t\tdataLabel:[],\n\t\tstoreDataLabel:[],\n\t\tlabelShow:false,\n\t\tstoreLabelShow:false,\n\t\tprops: { emitPath: false, multiple: true },\n        type: 0,\n\t\tgoodsModals: false,\n\t\toff_show: 0,\n      modals: false,\n      spinShow: false,\n      openSubimit: false,\n      grid2: {\n        xl: 10,\n        lg: 12,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      grid3: {\n        xl: 18,\n        lg: 18,\n        md: 20,\n        sm: 24,\n        xs: 24,\n      },\n      // 批量设置表格data\n      oneFormBatch: [\n        {\n          attr:\"全部\",\n\t\t  pic: \"\",\n          price: 0,\n          cost: 0,\n          ot_price: 0,\n          stock: 0,\n          bar_code: \"\",\n\t\t  code: \"\",\n          weight: 0,\n          volume: 0,\n        },\n      ],\n      // 规格数据\n      formDynamic: {\n        attrsName: \"\",\n        attrsVal: \"\",\n      },\n      formDynamicNameData: [],\n      isBtn: false,\n      myConfig: {\n        autoHeightEnabled: false, // 编辑器不自动被内容撑高\n        initialFrameHeight: 500, // 初始容器高度\n        initialFrameWidth: \"100%\", // 初始容器宽度\n        UEDITOR_HOME_URL: \"/admin/UEditor/\",\n        serverUrl: \"\",\n      },\n\t  columnsCarMy:[],\n      columns2: [\n\t\t{\n\t\t  title: \"商品规格\",\n\t\t  slot: \"attr\",\n\t\t  align: \"center\",\n\t\t  minWidth: 80,\n\t\t},  \n        {\n          title: \"图片\",\n          slot: \"pic\",\n          align: \"center\",\n          minWidth: 80,\n        },\n        {\n          title: \"售价\",\n          slot: \"price\",\n          align: \"center\",\n          minWidth: 95,\n        },\n        {\n          title: \"成本价\",\n          slot: \"cost\",\n          align: \"center\",\n          minWidth: 95,\n        },\n        {\n          title: \"原价\",\n          slot: \"ot_price\",\n          align: \"center\",\n          minWidth: 95,\n        },\n        {\n          title: \"库存\",\n          slot: \"stock\",\n          align: \"center\",\n          minWidth: 95,\n        },\n        {\n          title: \"商品条形码\",\n          slot: \"bar_code\",\n          align: \"center\",\n          minWidth: 120,\n        },\n\t\t{\n\t\t  title: \"商品编号\",\n\t\t  slot: \"code\",\n\t\t  align: \"center\",\n\t\t  minWidth: 120,\n\t\t},\n        {\n          title: \"重量（KG）\",\n          slot: \"weight\",\n          align: \"center\",\n          minWidth: 95,\n        },\n        {\n          title: \"体积(m³)\",\n          slot: \"volume\",\n          align: \"center\",\n          minWidth: 95,\n        },\n        {\n          title: \"操作\",\n          slot: \"action\",\n          // fixed: \"right\",\n          align: \"center\",\n          minWidth: 140,\n        },\n      ],\n      columns: [],\n      columnsInstall: [],\n      columnsInstal2: [],\n      gridPic: {\n        xl: 6,\n        lg: 8,\n        md: 12,\n        sm: 12,\n        xs: 12,\n      },\n      gridBtn: {\n        xl: 4,\n        lg: 8,\n        md: 8,\n        sm: 8,\n        xs: 8,\n      },\n      formValidate: {\n\t\tsupplier_id:0,//供应商\n\t\tis_presale_product: 0, //预售商品开关\n\t\tis_limit:0,//是否限购开关\n\t\tlimit_type:1,//1单次限购，2长期限购\n\t\tlimit_num:1,//限购数量\n\t\tis_vip_product: 0, //付费会员专属开关\n\t\tis_support_refund:0,\n\t\tdisk_info: \"\", //卡密简介\n\t\tpresale_day: 1, //预售发货时间-结束\n        presale_time:[],\t  \n\t\tauto_on_time:'',\n\t\tvideo_open: false, //视频按钮是否显示\n        store_name: \"\",\n\t\tfreight: 1, //运费设置\n\t\tpostage: 0, //设置运费金额\n\t\tcustom_form: [], //自定义留言\n        cate_id: [],\n        label_id: [],\n\t\t\t\tensure_id:[],\n        keyword: \"\",\n        unit_name: \"\",\n\t\tspecs_id:0,\n        store_info: \"\",\n\t\tbar_code:\"\",\n\t\tcode:\"\",\n        image: \"\",\n        recommend_image: \"\",\n        slider_image: [],\n        description: \"\",\n        ficti: 0,\n        give_integral: 0,\n        sort: 0,\n        is_show: 1,\n        is_hot: 0,\n        is_benefit: 0,\n        is_best: 0,\n        is_new: 0,\n        is_good: 0,\n        is_postage: 0,\n        is_sub: [],\n        id: 0,\n        spec_type: 0,\n        video_link: \"\",\n        temp_id: \"\",\n        attrs: [],\n        items: [\n          {\n            pic: \"\",\n            price: 0,\n            cost: 0,\n            ot_price: 0,\n            stock: 0,\n            bar_code: \"\",\n\t\t\tcode: \"\",\n          },\n        ],\n        activity: [\"默认\", \"秒杀\", \"砍价\", \"拼团\"],\n        couponName: [],\n        header: [],\n        selectRule: \"\",\n        coupon_ids: [],\n        command_word: \"\",\n        delivery_type: ['1'],\n\t\tspecs:[],\n\t\trecommend_list: [],\n\t\tbrand_id: [],\n\t\tproduct_type:0\n      },\n      ruleList: [],\n      templateList: [],\n      createBnt: false,\n      showIput: false,\n      manyFormValidate: [],\n      // 单规格表格data\n      oneFormValidate: [\n        {\n          pic: \"\",\n          price: 0,\n          cost: 0,\n          ot_price: 0,\n          stock: 0,\n          bar_code: \"\",\n\t\t  code: \"\",\n          weight: 0,\n          volume: 0,\n          brokerage: 0,\n          brokerage_two: 0,\n          vip_price: 0,\n\t\t  virtual_list: []\n        },\n      ],\n      images: [],\n      imagesTable: \"\",\n      currentTab: \"1\",\n      isChoice: \"\",\n      grid: {\n        xl: 8,\n        lg: 8,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      loading: false,\n      modalPic: false,\n      template: false,\n      uploadList: [],\n      treeSelect: [],\n      labelSelect: [],\n\t\t\tensureData:[],\n\t\t\tspecsData:[],\n      picTit: \"\",\n      tableIndex: 0,\n      ruleValidate: {\n        store_name: [\n          { required: true, message: \"请输入商品名称\", trigger: \"blur\" },\n        ],\n        cate_id: [\n          {\n            required: true,\n            message: \"请选择商品分类\",\n            trigger: \"change\",\n            type: \"array\"\n          },\n        ],\n        keyword: [\n          { required: true, message: \"请输入商品关键字\", trigger: \"blur\" },\n        ],\n\t\tunit_name: [\n\t\t  {\n\t\t    required: true,\n\t\t    message: \"请输入单位\",\n\t\t    trigger: \"change\",\n\t\t  },\n\t\t],\n        store_info: [\n          { required: true, message: \"请输入商品简介\", trigger: \"blur\" },\n        ],\n        //image: [{ required: true, message: \"请上传商品图\", trigger: \"change\" }],\n        slider_image: [\n          {\n            required: true,\n            message: \"请上传商品轮播图\",\n            type: \"array\",\n            trigger: \"change\",\n          },\n        ],\n        spec_type: [\n          { required: true, message: \"请选择商品规格\", trigger: \"change\" },\n        ],\n        selectRule: [\n          { required: true, message: \"请选择商品规格属性\", trigger: \"change\" },\n        ],\n        give_integral: [{ type: \"integer\", message: \"请输入整数\" }],\n\t\t  // delivery_type:[\n\t\t\t//   { required: true, type: 'array', min: 1, message: '请选择配送方式', trigger: 'change' },\n\t\t  // ]\n      },\n      manyBrokerage: 0,\n      manyBrokerageTwo: 0,\n      manyVipPrice: 0,\n      upload: {\n        videoIng: false, // 是否显示进度条；\n      },\n\t  videoIng: false, // 是否显示进度条；\n      progress: 0, // 进度条默认0\n      videoLink: \"\",\n      attrs: [],\n      activity: { 默认: \"colorBlue\", 秒杀: \"colorBlue\", 砍价: \"colorBlue\", 拼团: \"colorBlue\" },\n      couponName: [],\n      updateIds: [],\n      updateName: [],\n      rakeBack: [\n        {\n          title: \"一级返佣\",\n          slot: \"brokerage\",\n          align: \"center\",\n          width: 95,\n        },\n        {\n          title: \"二级返佣\",\n          slot: \"brokerage_two\",\n          align: \"center\",\n          width: 95,\n        },\n      ],\n      member: [\n        {\n          title: \"会员价\",\n          slot: \"vip_price\",\n          align: \"center\",\n          width: 95,\n        },\n      ],\n\t  headerCarMy:{\n\t\t  title: \"卡密设置\",\n\t\t  slot: \"fictitious\",\n\t\t  align: \"center\",\n\t\t  width: 95,\n\t  },\n      columnsInstalM: [],\n      moveIndex: \"\",\n\t\t\tgoodsData:[],\n\t\t\tbrandData:[],\n\t\t\tunitNameList:[],\n\t\t\tformBrand:{},\n\t\t\tattrsList:[],\n\t\t\tactiveAtter:[],\n\t\t\ttabIndex: 0,\n\t\t\ttabName: \"\",\n\t\t\tattrData:[],\n        datePickerOptions: {\n            disabledDate (date) {\n                return date && date.valueOf() < Date.now() - 86400000;\n            }\n        },\n\t\topenErp:false,\n\t\tmerchantType:0\n    };\n  },\n  computed: {\n    ...mapState(\"admin/layout\", [\"isMobile\",\"menuCollapse\"]),\n    labelWidth() {\n      return this.isMobile ? undefined : 120;\n    },\n    labelPosition() {\n      return this.isMobile ? \"top\" : \"right\";\n    },\n    labelBottom() {\n      return this.isMobile ? undefined : 15;\n\t\t},\n\t\tstartPickOptions() {\n\t\t\tconst that = this;\n\t\t\treturn {\n\t\t\t\tdisabledDate(time) {\n\t\t\t\t\tif(that.formValidate.auto_off_time) {\n\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\ttime.getTime() > new Date(that.formValidate.auto_off_time).getTime() - 86400000\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tendPickOptions() {\n\t\t\tconst that = this;\n\t\t\treturn {\n\t\t\t\tdisabledDate(time) {\n\t\t\t\t\tif(that.formValidate.is_show == '1'){\n\t\t\t\t\t\treturn time.getTime() < Date.now();\n\t\t\t\t\t}\n\t\t\t\t\tif(that.formValidate.auto_on_time) {\n\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\t time.getTime() < new Date(that.formValidate.auto_on_time).getTime() + 86400000\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t}\n\t\t}\n  },\n  created() {\n  \tthis.getSupplierList();\n\tthis.columns = this.columns2.slice(1, 10);\n\tlet data = JSON.parse(JSON.stringify(this.columns2)); \n\tdata.splice(8,2,this.headerCarMy);  \n\tthis.columnsCarMy = data; \n\tlet fictitious = JSON.parse(JSON.stringify(this.columns2));\n\tfictitious.splice(8,2);\n\tthis.columnsFictitious = fictitious;\n\tthis.getToken();\n\tthis.getErpConfig();\n    // this.columnsInstall = this.columns2.slice(0, 4).concat(this.columnsInstall);\n    // this.columnsInsta8 = this.columns2.slice(0, 4).concat(this.columnsInsta8);\n  },\n  mounted() {\n\t\tthis.setCopyrightShow({ value: false });\n    if (this.$route.params.id !== \"0\" && this.$route.params.id) {\n      this.getInfo();\n    } else if (this.$route.params.id === \"0\") {\n      productCache()\n        .then((res) => {\n          let data = res.data.info;\n          if (!Array.isArray(data)) {\n            let cate_id = data.cate_id.map(Number);\n            let label_id = data.label_id.map(Number);\n            this.attrs = data.items || [];\n            let ids = [];\n            // let names = [];\n            if (data.coupons) {\n              data.coupons.map((item) => {\n                ids.push(item.id);\n                // names.push(item.title);\n              });\n              this.couponName = data.coupons;\n            }\n            this.formValidate = data;\n            // this.couponName = data.coupons;\n            // that.couponName = names;\n            this.formValidate.coupon_ids = ids;\n\t\t\tthis.formValidate.is_limit = this.formValidate.is_limit?1:0;\n\t\t\tthis.formValidate.limit_type = parseInt(this.formValidate.limit_type);\n\t\t\tthis.formValidate.is_support_refund = parseInt(this.formValidate.is_support_refund);\n            this.updateIds = ids;\n            this.updateName = data.coupons;\n            this.formValidate.cate_id = cate_id;\n\t\t\tthis.dataLabel = data.label_id;\n\t\t\tthis.storeDataLabel = data.store_label_id;\n\t\t\tthis.specsList = data.specs;\n            this.oneFormValidate = data.attrs;\n            this.formValidate.header = [];\n            this.generate(0);\n\t\t\tthis.addmanyData(data.attrs);\n\t\t\tthis.productTypeTap(2);\n\t\t\tthis.columns = this.columns2.slice(1, 10);\n            //this.manyFormValidate = data.attrs;\n\t\t\tthis.formValidate.custom_form = data.custom_form || [];\n\t\t\tif (this.formValidate.custom_form.length) {\n\t\t\t  this.customBtn = true;\n\t\t\t}\n            this.spec_type = data.spec_type;\n            if (data.spec_type === 0) {\n              this.manyFormValidate = [];\n            } else {\n              this.createBnt = true;\n              this.oneFormValidate = [\n                {\n                  pic: data.slider_image[0],\n                  price: 0,\n                  cost: 0,\n                  ot_price: 0,\n                  stock: 0,\n                  bar_code: \"\",\n\t\t\t\t  code: \"\",\n                  weight: 0,\n                  volume: 0,\n                  brokerage: 0,\n                  brokerage_two: 0,\n                  vip_price: 0,\n\t\t\t\t  virtual_list: [],\n                },\n              ];\n            }\n            this.spinShow = false;\n          }\n        })\n        .catch((err) => {\n          this.$Message.error(err.msg);\n        });\n    }\n    if(this.$route.query.type){\n      this.modals = true;\n      this.type = this.$route.query.type;\n    }else {\n      this.type = 0;\n    }\n    this.goodsCategory();\n    this.productGetRule();\n    this.productGetTemplate();\n\tthis.getBrandList();\n\tthis.getAllUnit();\t\n\tthis.uploadType();\n\tthis.getProductAllEnsure();\n\tthis.getProductAllSpecs();\n  },\n\tdestroyed () {\n\t  this.setCopyrightShow({ value: true });\n\t},\n  methods: {\n\t\t...mapMutations('admin/layout', [\n\t\t    'setCopyrightShow'\n\t\t]),\n\t\tlimitTap(e){\n\t\t\tif(e){\n\t\t\t\tthis.formValidate.limit_type = (this.formValidate.is_limit && !this.formValidate.limit_type)?1:0\n\t\t\t\tthis.formValidate.limit_num = (this.formValidate.is_limit && this.formValidate.limit_num == 0)?1:0\n\t\t\t}else{\n\t\t\t\tthis.formValidate.limit_type = 0;\n\t\t\t\tthis.formValidate.limit_num = 0;\n\t\t\t}\n\t\t},\n\t\t//erp配置\n\t\tgetErpConfig(){\n\t\t\terpConfig().then(res=>{\n\t\t\t\tthis.openErp = res.data.open_erp;\n\t\t\t}).catch(err=>{\n\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t})\n\t\t},\n\t\tdelSpecs(index){\n\t\t\tthis.specsList.splice(index, 1);\n\t\t},\n\t\taddSpecs(){\n\t\t\tlet obj = {'name':'','value':'','sort':0}\n\t\t\tthis.specsList.push(obj)\n\t\t},\n\t\tspecsInfo(e){\n\t\t\tthis.specsData.forEach(item=>{\n\t\t\t\tif(item.id == e){\n\t\t\t\t\tthis.specsList = item.specs\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tgetProductAllSpecs(){\n\t\t\tproductAllSpecs().then(res=>{\n\t\t\t\tthis.specsData = res.data\n\t\t\t}).catch(err=>{\n\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t})\n\t\t},\n\t\tgetProductAllEnsure(){\n\t\t\tproductAllEnsure().then(res=>{\n\t\t\t\tthis.ensureData = res.data\n\t\t\t}).catch(err=>{\n\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t})\n\t\t},\n\t  //添加倒入卡密的值\n\t  changeVirtual(e){\n\t\t  this.virtualList = this.virtualList.concat(e);\n\t  },\n\t  //添加卡密\n\t  addVirtual(index, name) {\n\t    this.tabIndex = index;\n\t    this.tabName = name;\n\t\tthis.virtualListClear();\n\t\tthis.$refs.addCarMy.fixedCar = {\n\t\t\t\t\tdisk_info:'',\n\t\t\t\t\tstock:0\n\t\t\t\t}\n\t\tthis.$refs.addCarMy.cartMyType = 1;\t\n\t\tthis.carMyShow = true;\t\n\t  },\n\t  //确认提交卡密\n\t  fixdBtn(e){\n\t\t  if(e.cartMyType == 1){\n\t\t\t  this.$set(this[this.tabName][this.tabIndex],\"disk_info\",e.disk_info);\n\t\t\t  this.$set(this[this.tabName][this.tabIndex],\"stock\",Number(e.stock));\n\t\t\t  this[this.tabName][this.tabIndex].virtual_list = [];\n\t\t  }else{\n\t\t\t  this.$set(this[this.tabName][this.tabIndex],\"virtual_list\",e.virtualList);\n\t\t\t  this.$set(this[this.tabName][this.tabIndex],\"stock\",e.virtualList.length);\n\t\t\t  this[this.tabName][this.tabIndex].disk_info = '';\n\t\t  }\n\t\t  this.carMyShow = false;\n\t  },\n\t  closeCarMy(){\n\t\t  this.carMyShow = false;\n\t  },\n\t  //清空卡密\n\t  virtualListClear(){\n\t\t  this.virtualList = [\n\t\t    {\n\t\t      key: \"\",\n\t\t      value: \"\",\n\t\t    },\n\t\t  ];\n\t  },\n\t  seeVirtual(data, name, index) {\n\t    this.tabName = name;\n\t    this.tabIndex = index;\n\t\tthis.virtualListClear();\n\t\tthis.$refs.addCarMy.fixedCar = {\n\t\t\t\t\tdisk_info:'',\n\t\t\t\t\tstock:0\n\t\t\t\t}\t\n\t    if (data.virtual_list && data.virtual_list.length) {\n\t\t  this.$refs.addCarMy.cartMyType = 2;\n\t      this.virtualList = data.virtual_list;\n\t    } else if (data.disk_info) {\n\t      this.$refs.addCarMy.cartMyType = 1;\n\t      this.$refs.addCarMy.fixedCar.disk_info = data.disk_info;\n\t      this.$refs.addCarMy.fixedCar.stock = data.stock;\n\t    }\n\t    this.carMyShow = true;\n\t  },\n\t  //动态添加组件\n\t  addAssembly(){\n\t\t  this.formValidate.custom_form.push({\n\t\t    title: \"\",\n\t\t    label: \"text\",\n\t\t    value: \"\",\n\t\t    status: 0,\n\t\t  });\n\t  },\n\t  customMessBtn(e) {\n\t    if (!e) {\n\t      this.formValidate.custom_form = [];\n\t    }else{\n\t\t  this.addAssembly();\t\n\t\t}\n\t  },\n\t  addcustom() {\n\t    if (this.formValidate.custom_form.length > 9) {\n\t      this.$Message.warning(\"最多添加10条\");\n\t    } else {\n\t      this.addAssembly();\n\t    }\n\t  },\n\t  delcustom(index) {\n\t    this.formValidate.custom_form.splice(index, 1);\n\t  },\n\t  // 预售具体日期\n\t  onchangeTime(e) {\n\t    this.formValidate.presale_time = e;\n\t  },\n\t  //定时上架\n\t  onchangeShow(e){\n\t\t this.formValidate.auto_on_time = e \n\t  },\n\t  //定时下架\n\t  onchangeOff(e){\n\t     this.formValidate.auto_off_time = e \n\t  },\n\t // 获取供应商内容\n    getSupplierList() {\n      getSupplierList().then(async(res)=>{\n        this.supplierList = res.data\n\n      }).catch((res)=>{\n        this.$Message.error(res.msg)\n      })\n    },\n\t  //打开属性\n\t  batchAttr(){\n\t\t  this.attrShow = true;\n\t\t  // if(!this.activeAtter.length){\n\t\t\t //  let data = this.attrs;\n\t\t\t //  data.map(el=>{\n\t\t\t //  \t\t\tel.details = [];\n\t\t\t //  \tel.detail.map(label=>{\n\t\t\t //  \t\tel.details.push({\n\t\t\t //  \t\t\tname:label,\n\t\t\t //  \t\t\tselect:false\n\t\t\t //  \t\t})\n\t\t\t //  \t})\n\t\t\t //  })\n\t\t\t //  this.attrsList = data;\n\t\t  // }\n\t  },\n\t\t//获取属性\n\t\tgetAttr(){\n\t\t\tthis.oneFormBatch[0].attr = '全部';\n\t\t\tlet data = this.attrs;\n\t\t\tdata.map(el=>{\n\t\t\t\t\t\tel.details = [];\n\t\t\t\tel.detail.map(label=>{\n\t\t\t\t\tel.details.push({\n\t\t\t\t\t\tname:label,\n\t\t\t\t\t\tselect:false\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t})\n\t\t\tthis.attrsList = data;\n\t\t},\n\t  //选中属性\n\t  activeAttr(e){\n\t\t  this.attrsList = e;\n\t  },\n\t  //关闭属性弹窗\n\t  labelAttr(){\n\t  \tthis.attrShow = false;\n\t  },\n\t  //多属性为空\n\t  manyEmpty(j){\n\t\t  j.pic = '';\n\t\t  j.price = 0;\n\t\t  j.cost = 0;\n\t\t  j.ot_price = 0;\n\t\t  j.stock = 0;\n\t\t  j.bar_code = '';\n\t\t  j.code = '';\n\t\t  j.weight = 0;\n\t\t  j.volume = 0;\n\t\t  j.virtual_list = []\n\t  },\n\t\t\n\t\t\n\t\tdoCombination(arr) {\n\t\t    var count = arr.length - 1; //数组长度(从0开始)\n\t\t    var tmp = [];\n\t\t    var totalArr = [];// 总数组\n\t\t\n\t\t    return doCombinationCallback(arr, 0);//从第一个开始\n\t\t    //js 没有静态数据，为了避免和外部数据混淆，需要使用闭包的形式\n\t\t    function doCombinationCallback(arr, curr_index) {\n\t\t        for(let val of arr[curr_index]) {\n\t\t            tmp[curr_index] = val;//以curr_index为索引，加入数组\n\t\t            //当前循环下标小于数组总长度，则需要继续调用方法\n\t\t            if(curr_index < count) {\n\t\t                doCombinationCallback(arr, curr_index + 1);//继续调用\n\t\t            }else{\n\t\t                totalArr.push(tmp.join(','));//(直接给push进去，push进去的不是值，而是值的地址)\n\t\t            }\n\t\t\n\t\t            //js  对象都是 地址引用(引用关系)，每次都需要重新初始化，否则 totalArr的数据都会是最后一次的 tmp 数据；\n\t\t            let oldTmp = tmp;\n\t\t            tmp = [];\n\t\t            for(let index of oldTmp) {\n\t\t                tmp.push(index);\n\t\t            }\n\t\t            }\n\t\t            return totalArr;\n\t\t    }\n\t\t},\n\t\t\n\t  //提交属性值；\n\t  subAttrs(e){\n\t\t\tlet selectData = [];\n\t\t\tthis.attrsList.forEach((el,index)=>{\n\t\t\t\tlet obj = [];\n\t\t\t\tel.details.forEach((label)=>{\n\t\t\t\t\tif(label.select){\n\t\t\t\t\t\tobj.push(label.name);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif(obj.length){\n\t\t\t\t\tselectData.push(obj)\n\t\t\t\t}\n\t\t\t})\n\t\t  let newData = [];\n\t\t  if(selectData.length){\n\t\t\t  newData = this.doCombination(selectData);\n\t\t  }\n\t\t  this.attrShow = false;\n\t\t  this.activeAtter = selectData;\n\t\t  this.oneFormBatch[0].attr = newData.length?newData.join(';') : '全部';\n\t\t  this.manyFormValidate.forEach(j=>{\n\t\t\t  j.select = false;\n\t\t\t  if(newData.length){\n\t\t\t\t  newData.forEach(item=>{\n\t\t\t\t\t  if(j.values.split('').length == item.split('').length){\n\t\t\t\t\t  \t  if(j.values == item){\n\t\t\t\t\t\t\t\t\tj.select = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t  }else{\n\t\t\t\t\t\t\tif(j.values.indexOf(item) != -1){\n\t\t\t\t\t\t\t\tj.select = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t  })\n\t\t\t  }else{\n\t\t\t\t  j.select = true;\n\t\t\t  }\n\t\t  })\n\t\t  this.$set(this,'manyFormValidate',this.manyFormValidate)\n\t  },\n\t  goodsOn(e){\n\t\t  if(e==0 || e==1){\n\t\t\t  this.formValidate.auto_on_time = '';\n\t\t  }\n\t  },\n\t  goodsOff(e){\n\t\t  if(!e){\n\t\t\t  this.formValidate.auto_off_time = '';\n\t\t  }\n\t  },\n\t  addBrand(){\n\t      this.$refs.menusFrom.modals = true\n\t      this.$refs.menusFrom.titleFrom = \"添加品牌分类\"\n\t      this.formBrand = {\n\t          sort:0,\n\t\t\t  is_show:1\n\t      }\n\t\t  this.formBrand.fid = [0];\n\t      this.$refs.menusFrom.type = 1\n\t  },\n\t  getAllUnit(){\n\t\t  productAllUnit().then(res=>{\n\t\t\t  this.unitNameList = res.data;\n\t\t  }).catch(err=>{\n\t\t\t  this.$Message.error(err.msg);\n\t\t  })\n\t  },\n\t  addClass(){\n\t\t  this.$modalForm(productCreateApi()).then(() => this.goodsCategory());\n\t  },\n\t  addUnit(){\n\t\t  this.$modalForm(productUnitCreate()).then(() => this.getAllUnit());\n\t  },\n\t\taddStoreLabel(){\n\t\t  this.$modalForm(productLabelAdd()).then(() => {});\n\t\t},\n\t  productTypeTap(num,item){\n\t\tif(num == 1){\n\t\t\tif(this.$route.params.id) return this.$Message.error('商品类型不能切换！');\n\t\t\tthis.formValidate.product_type = item.id;\n\t\t}  \n\t\tif(this.formValidate.product_type){\n\t\t\tthis.headTab = [\n\t\t\t  { title: \"基础信息\", name: \"1\" },\n\t\t\t  { title: \"规格库存\", name: \"2\" },\n\t\t\t  { title: \"商品详情\", name: \"3\" },\n\t\t\t  { title: \"营销设置\", name: \"5\" },\n\t\t\t  { title: \"其他设置\", name: \"6\" },\n\t\t\t]\n\t\t\tthis.formValidate.postage = 0;\n\t\t\tthis.formValidate.supplier_id = 0;\n\t\t}else{\n\t\t\tthis.headTab = [\n\t\t\t  { title: \"基础信息\", name: \"1\" },\n\t\t\t  { title: \"规格库存\", name: \"2\" },\n\t\t\t  { title: \"商品详情\", name: \"3\" },\n\t\t\t  { title: \"物流设置\", name: \"4\" },\n\t\t\t  { title: \"营销设置\", name: \"5\" },\n\t\t\t  { title: \"其他设置\", name: \"6\" },\n\t\t\t]\n\t\t}\n\t  },\n\t\tcloseLabel(label){\n\t\t\tlet index = this.dataLabel.indexOf(this.dataLabel.filter(d=>d.id == label.id)[0]);\n\t\t\tthis.dataLabel.splice(index,1);\n\t\t},\n\t\tactiveData(dataLabel){\n\t\t\tthis.labelShow = false;\n\t\t\tthis.dataLabel = dataLabel;\n\t\t},\n\t\topenLabel(row) {\n\t\t  this.labelShow = true;\n\t\t\tthis.$refs.userLabel.userLabel(JSON.parse(JSON.stringify(this.dataLabel)));\n\t\t},\n\t\t// 标签弹窗关闭\n\t\tlabelClose() {\n\t\t  this.labelShow = false;\n\t\t},\n\t\tcloseStoreLabel(label){\n\t\t\tlet index = this.storeDataLabel.indexOf(this.storeDataLabel.filter(d=>d.id == label.id)[0]);\n\t\t\tthis.storeDataLabel.splice(index,1);\n\t\t},\n\t\tactiveStoreData(storeDataLabel){\n\t\t\tthis.storeLabelShow = false;\n\t\t\tthis.storeDataLabel = storeDataLabel;\n\t\t},\n\t\topenStoreLabel(row) {\n\t\t  this.storeLabelShow = true;\n\t\t\tthis.$refs.storeLabel.storeLabel(JSON.parse(JSON.stringify(this.storeDataLabel)));\n\t\t},\n\t\t// 标签弹窗关闭\n\t\tstoreLabelClose() {\n\t\t  this.storeLabelShow = false;\n\t\t},\n\t\t// 品牌列表\n\t\tgetBrandList(){\n\t\t\tbrandList().then(res=>{\n\t\t\t\tthis.brandData = res.data\n\t\t\t}).catch(err=>{\n\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t})\n\t\t},\n\t\tgetProductId(e){\n\t\t\tthis.goodsModals = false;\n\t\t\tlet nArr = this.goodsData.concat(e).filter((element,index,self)=>{\n\t\t\t    return self.findIndex(x=>x.product_id==element.product_id) == index\n\t\t\t})\n\t\t\t\n\t\t\tthis.goodsData = nArr.slice(0,12);\n\t\t},\n\t\tgoodCancel () {\n\t\t  this.goodsModals = false;\n\t\t},\n\t\tgoodsTap(){\n\t\t\tthis.goodsModals = true;\n\t\t\tthis.$refs.goodslist.handleSelectAll();\n\t\t},\n\t\tbindDelete (index) {\n\t\t  this.goodsData.splice(index, 1)\n\t\t},\n    cancel() {\n      this.$router.push({path:'/admin/product/product_list'});\n    },\n\t\n\tvideoSaveToUrl(file) {\n\t\tlet imgTypeArr = [\"video/mp4\"];\n\t\tlet imgType = imgTypeArr.indexOf(file.type) !== -1\n\t\tif (!imgType) {\n\t\t\treturn this.$Message.warning({\n\t\t\tcontent:  '文件  ' + file.name + '  格式不正确, 请选择格式正确的视频',\n\t\t\tduration: 5\n\t\t\t});\n\t\t}\n\t  uploadByPieces({\n\t    randoms: \"\", // 随机数，这里作为给后端处理分片的标识 根据项目看情况 是否要加\n\t    file: file, // 视频实体\n\t    pieceSize: 3, // 分片大小\n\t    success: (data) => {\n\t      this.formValidate.video_link = data.file_path;\n\t      this.progress = 100;\n\t    },\n\t    error: (e) => {\n\t      this.$Message.error(e.msg);\n\t    },\n\t    uploading: (chunk, allChunk) => {\n\t      this.videoIng = true;\n\t      let st = Math.floor((chunk / allChunk) * 100);\n\t      this.progress = st;\n\t    },\n\t  });\n\t  return false;\n\t},\n\t\n\t// 上传头部token\n\tgetToken() {\n\t  this.header[\"Authori-zation\"] = \"Bearer \" + util.cookies.get(\"token\");\n\t},\n\t// beforeUpload() {\n\t//   this.uploadData = {};\n\t//   let promise = new Promise((resolve) => {\n\t//     this.$nextTick(function () {\n\t//       resolve(true);\n\t//     });\n\t//   });\n\t//   return promise;\n\t// },\n\t// 上传成功\n\thandleSuccess(res, file, fileList) {\n\t  if (res.status === 200) {\n\t    this.formValidate.video_link = res.data.src;\n\t    this.$Message.success(res.msg);\n\t  } else {\n\t    this.$Message.error(res.msg);\n\t  }\n\t},\n\t//获取视频上传类型\n\tuploadType() {\n\t  uploadType().then((res) => {\n\t    this.upload_type = res.data.upload_type;\n\t  });\n\t},\n\tgetEditorContent(data) {\n\t  this.content = data;\n\t},\n    infoData(data){\n      let cate_id = data.cate_id.map(Number);\n      this.attrs = data.items || [];\n      let ids = [];\n      data.coupons.map((item) => {\n        ids.push(item.id);\n      });\n\t  this.goodsData = data.recommend_list;\n\t  if(data.auto_off_time){\n\t\t this.off_show = 1;\n\t  }else{\n\t\t this.off_show = 0;\n\t  }\n      this.formValidate = data;\n\t  this.formValidate.supplier_id = data.relation_id;\n\t  this.formValidate.is_limit = this.formValidate.is_limit?1:0;\n\t  this.formValidate.limit_type = parseInt(data.limit_type);\n\t  this.formValidate.is_support_refund = parseInt(this.formValidate.is_support_refund);\n\t  this.contents = data.description;\n      this.couponName = data.coupons;\n      this.formValidate.coupon_ids = ids;\n      this.updateIds = ids;\n      this.updateName = data.coupons;\n      this.formValidate.cate_id = cate_id;\n      this.dataLabel = data.label_id;\n      this.storeDataLabel = data.store_label_id;\n      this.specsList = data.specs;\n      if(data.attr){\n        this.oneFormValidate = [data.attr];\n      }\n      this.formValidate.header = [];\n      this.generate(0);\n      //this.manyFormValidate = data.attrs;\n\t  this.addmanyData(data.attrs);\n\t  this.productTypeTap(2);\n\t  this.formValidate.custom_form = data.custom_form || [];\n\t  if (this.formValidate.custom_form.length) {\n\t    this.customBtn = true;\n\t  }\n\t  \n      this.spec_type = data.spec_type;\n      if (data.spec_type === 0) {\n        this.manyFormValidate = [];\n      } else {\n        this.createBnt = true;\n        this.oneFormValidate = [\n          {\n            pic: \"\",\n            price: 0,\n            cost: 0,\n            ot_price: 0,\n            stock: 0,\n            bar_code: \"\",\n\t\t\tcode: \"\",\n            weight: 0,\n            volume: 0,\n            brokerage: 0,\n            brokerage_two: 0,\n            vip_price: 0,\n\t\t\tvirtual_list: [],\n          },\n        ];\n      }\n    },\n    //关闭淘宝弹窗并生成数据；\n    onClose(data){\n      this.modals = false;\n      this.infoData(data);\n    },\n\n    checkMove(evt) {\n      this.moveIndex = evt.draggedContext.index;\n    },\n    end() {\n      this.moveIndex = \"\";\n    },\n    checkAllGroupChange(data) {\n      this.checkAllGroup(data);\n    },\n    checkAllGroup(data) {\n      if (this.formValidate.spec_type === 0) {\n        if (data.indexOf(0) > -1) {\n          this.columnsInstall = this.columns2.slice(1, 5).concat(this.member);\n        } else if (data.indexOf(1) > -1) {\n          this.columnsInstall = this.columns2.slice(1, 5).concat(this.rakeBack);\n        } else {\n          this.columnsInstall = this.columns2.slice(1, 5);\n        }\n        if (data.length === 2) {\n          this.columnsInstall = this.columns2\n            .slice(1, 5)\n            .concat(this.rakeBack)\n            .concat(this.member);\n        }\n      } else {\n        if (data.indexOf(0) > -1) {\n          this.columnsInstal2 = this.columnsInstalM\n            .slice(0, 4)\n            .concat(this.member);\n        } else if (data.indexOf(1) > -1) {\n          this.columnsInstal2 = this.columnsInstalM\n            .slice(0, 4)\n            .concat(this.rakeBack);\n        } else {\n          this.columnsInstal2 = this.columnsInstalM.slice(0, 4);\n        }\n        if (data.length === 2) {\n          this.columnsInstal2 = this.columnsInstalM\n            .slice(0, 4)\n            .concat(this.rakeBack)\n            .concat(this.member);\n        }\n      }\n    },\n    // 添加优惠券\n    addCoupon() {\n      this.$refs.couponTemplates.isTemplate = true;\n      this.$refs.couponTemplates.tableList();\n    },\n    //对象数组去重；\n    unique(arr) {\n      const res = new Map();\n      return arr.filter((arr) => !res.has(arr.id) && res.set(arr.id, 1));\n    },\n    nameId(id, names) {\n      this.formValidate.coupon_ids = id;\n      this.couponName = this.unique(names);\n    },\n    handleClose(name) {\n      let index = this.couponName.indexOf(name);\n      this.couponName.splice(index, 1);\n      let couponIds = this.formValidate.coupon_ids;\n      couponIds.splice(index, 1);\n      this.updateIds = couponIds;\n      this.updateName = this.couponName;\n    },\n    // 运费模板\n    getList() {\n      this.productGetTemplate();\n    },\n    // 添加运费模板\n    addTemp() {\n      this.$refs.templates.isTemplate = true;\n    },\n    // 删除视频；\n\tdelVideo() {\n\t  let that = this;\n\t  that.$set(that.formValidate, \"video_link\", \"\");\n\t  that.$set(that, \"progress\", 0);\n\t  that.videoIng = false;\n\t  that.upload.videoIng = false;\n\t  that.$refs.refid.value ='';\n\t},\n\tzh_uploadFile() {\n\t  if (this.seletVideo == 1) {\n\t  \tif(this.videoLink && this.$getFileType(this.videoLink) == 'video'){\n\t\t\tthis.formValidate.video_link = this.videoLink;\n\t\t}else{\n\t\t\treturn this.$Message.error(\"请输入正确的视频链接\")\n\t\t}\n\t  } else {\n\t    this.$refs.refid.click();\n\t  }\n\t},\n    zh_uploadFile_change(evfile) {\n      let that = this;\n      let suffix = evfile.target.files[0].name.substr(\n        evfile.target.files[0].name.indexOf(\".\")\n      );\n      if (suffix.indexOf(\".mp4\") === -1) {\n        return that.$Message.error(\"只能上传MP4文件\");\n      }\n      productGetTempKeysApi()\n        .then((res) => {\n          that.$videoCloud\n            .videoUpload({\n              type: res.data.type,\n              evfile: evfile,\n              res: res,\n              uploading(status, progress) {\n                that.upload.videoIng = status;\n\t\t\t\tif (res.status == 200) {\n\t\t\t\t  that.progress = 100;\n\t\t\t\t}\n              },\n            })\n            .then((res) => {\n              that.formValidate.video_link = res.url;\n              that.$Message.success(\"视频上传成功\");\n\t\t\t  that.upload.videoIng = false;\n            })\n            .catch((res) => {\n              that.$Message.error(res);\n            });\n        })\n        .catch((res) => {\n          that.$Message.error(res.msg);\n        });\n    },\n    // 上一页；\n    upTab() {\n\t\tif(this.currentTab==5&&this.formValidate.product_type!=0){\n\t\t\tthis.currentTab = (Number(this.currentTab) - 2).toString();\n\t\t}else{\n\t\t\tthis.currentTab = (Number(this.currentTab) - 1).toString();\n\t\t}\n    },\n    // 下一页；\n    downTab(name) {\n\t\tthis.$refs[name].validate((valid) => {\n\t\t\tif (valid) {\n\t\t\t\tif(this.formValidate.is_show == 2 && !this.formValidate.auto_on_time){\n\t\t\t\t\treturn this.$Message.warning(\"请填写定时上架时间\");\n\t\t\t\t}\n\t\t\t\tif(this.off_show == 1 && !this.formValidate.auto_off_time){\n\t\t\t\t\treturn this.$Message.warning(\"请填写定时下架时间\");\n\t\t\t\t}\n\t\t\t\tif(this.currentTab==4 && !this.formValidate.delivery_type.length){\n\t\t\t\t\treturn this.$Message.warning(\"请选择配送方式\");\n\t\t\t\t}\n\t\t\t\tif(this.currentTab==3&&this.formValidate.product_type!=0){\n\t\t\t\t\tthis.currentTab = (Number(this.currentTab) + 2).toString();\n\t\t\t\t}else{\n\t\t\t\t\tthis.currentTab = (Number(this.currentTab) + 1).toString();\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tthis.$Message.warning(\"请完善数据\");\n\t\t\t}\n\t\t})\n    },\n    // 属性弹窗回调函数；\n    userSearchs() {\n      this.productGetRule();\n    },\n    // 添加规则；\n    addRule() {\n      this.$refs.addattr.modal = true;\n    },\n    // 批量设置分佣；\n    brokerageSetUp() {\n      let that = this;\n      if (that.formValidate.is_sub.indexOf(1) > -1) {\n        if (that.manyBrokerage <= 0 || that.manyBrokerageTwo <= 0) {\n          return that.$Message.error(\"请填写返佣金额后进行批量添加\");\n        }\n      } else if (that.formValidate.is_sub.indexOf(0) > -1) {\n        if (that.manyVipPrice <= 0) {\n          return that.$Message.error(\"请填写会员价后进行批量添加\");\n        }\n      }\n      if (this.formValidate.is_sub.length === 2) {\n        if (\n          that.manyBrokerage <= 0 ||\n          that.manyBrokerageTwo <= 0 ||\n          that.manyVipPrice <= 0\n        ) {\n          return that.$Message.error(\"请填写完金额后进行批量添加\");\n        }\n      }\n      for (let val of that.manyFormValidate) {\n        this.$set(val, \"brokerage\", that.manyBrokerage);\n        this.$set(val, \"brokerage_two\", that.manyBrokerageTwo);\n        this.$set(val, \"vip_price\", that.manyVipPrice);\n      }\n      // let that = this;\n      // if (that.manyBrokerage <= 0 || that.manyBrokerageTwo <= 0) {\n      //     return that.$Message.error('请填写返佣金额在进行批量添加');\n      // } else {\n      //     for (let val of that.manyFormValidate) {\n      //         this.$set(val, 'brokerage', that.manyBrokerage);\n      //         this.$set(val, 'brokerage_two', that.manyBrokerageTwo);\n      //     }\n      // }\n    },\n    // 批量设置会员价\n    vipPriceSetUp() {\n      let that = this;\n      if (that.manyVipPrice <= 0) {\n        return that.$Message.error(\"请填写会员价在进行批量添加\");\n      } else {\n        for (let val of that.manyFormValidate) {\n          this.$set(val, \"vip_price\", that.manyVipPrice);\n        }\n      }\n    },\n    batchDel() {\n      this.oneFormBatch = [\n        {\n\t\t  attr:\"全部\",\n          pic: \"\",\n          price: 0,\n          cost: 0,\n          ot_price: 0,\n          stock: 0,\n          bar_code: \"\",\n\t\t  code: \"\",\n          weight: 0,\n          volume: 0,\n\t\t  virtualList:[],\n\t\t  disk_info:''\n        },\n      ];\n\t  this.activeAtter=[];\n\t  for (let val of this.manyFormValidate) {\n\t\t  val.select = true;\n\t  }  \n    },\n    confirm() {\n      let that = this;\n      that.createBnt = true;\n      if (that.formValidate.selectRule.trim().length <= 0) {\n        return that.$Message.error(\"请选择属性\");\n      }\n      that.ruleList.forEach(function (item, index) {\n        if (item.rule_name === that.formValidate.selectRule) {\n          that.attrs = item.rule_value;\n        }\n      });\n    },\n    // 获取商品属性模板；\n    productGetRule() {\n      productGetRuleApi().then((res) => {\n        this.ruleList = res.data;\n      });\n    },\n    // 获取运费模板；\n    productGetTemplate() {\n      productGetTemplateApi().then((res) => {\n        this.templateList = res.data;\n      });\n    },\n    // 删除表格中的属性\n    delAttrTable(index) {\n      let id = this.$route.params.id;\n      if (id) {\n        checkActivityApi(id)\n          .then((res) => {\n            this.manyFormValidate.splice(index, 1);\n            this.$Message.success(res.msg);\n          })\n          .catch((res) => {\n            this.$Message.error(res.msg);\n          });\n      } else {\n        this.manyFormValidate.splice(index, 1);\n      }\n    },\n    // 批量添加\n    batchAdd() {\n      for (let val of this.manyFormValidate) {\n\t\t  //this.manyEmpty(val);\n\t\t  if(val.select){\n\t\t\t  if (this.oneFormBatch[0].pic) {\n\t\t\t    this.$set(val, \"pic\", this.oneFormBatch[0].pic);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].price > 0) {\n\t\t\t    this.$set(val, \"price\", this.oneFormBatch[0].price);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].cost > 0) {\n\t\t\t    this.$set(val, \"cost\", this.oneFormBatch[0].cost);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].ot_price > 0) {\n\t\t\t    this.$set(val, \"ot_price\", this.oneFormBatch[0].ot_price);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].stock > 0) {\n\t\t\t    this.$set(val, \"stock\", this.oneFormBatch[0].stock);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].bar_code !== \"\") {\n\t\t\t    this.$set(val, \"bar_code\", this.oneFormBatch[0].bar_code);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].code !== \"\") {\n\t\t\t    this.$set(val, \"code\", this.oneFormBatch[0].code);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].weight > 0) {\n\t\t\t    this.$set(val, \"weight\", this.oneFormBatch[0].weight);\n\t\t\t  }\n\t\t\t  if (this.oneFormBatch[0].volume > 0) {\n\t\t\t    this.$set(val, \"volume\", this.oneFormBatch[0].volume);\n\t\t\t  }\n\t\t\t  if(this.formValidate.product_type == 1){\n\t\t\t\t  if(this.oneFormBatch[0].virtual_list && this.oneFormBatch[0].virtual_list.length){\n\t\t\t\t\t  this.$set(val, \"virtual_list\", this.oneFormBatch[0].virtual_list);\n\t\t\t\t  }else if(this.oneFormBatch[0].disk_info){\n\t\t\t\t\t  this.$refs.addCarMy.cartMyType = 1;\n\t\t\t\t\t  this.$set(val, \"disk_info\", this.oneFormBatch[0].disk_info);\n\t\t\t\t  }\n\t\t\t  }\n\t\t  }\n      }\n    },\n    // 添加按钮\n    addBtn() {\n      this.clearAttr();\n      this.createBnt = false;\n      this.showIput = true;\n    },\n\taddmanyData(data){\n\t\tdata.forEach(item=>{\n\t\t\titem.select = true\n\t\t})\n\t\tthis.manyFormValidate = data;\n\t},\n    // 立即生成\n    generate(type) {\n      generateAttrApi({ attrs: this.attrs,product_type: this.formValidate.product_type }, this.formValidate.id, type)\n        .then((res) => {\n          let info = res.data.info,\n            header1 = JSON.parse(JSON.stringify(info.header));\n          if (this.$route.params.id !== \"0\") {\n\t\t\t  this.addmanyData(info.value);\n          }\n          this.formValidate.header = header1;\n\t\t\t\t\tthis.attrData = res.data.info.attr;\n          let header = info.header;\n          header.pop();\n          this.columnsInstalM = info.header;\n          this.checkAllGroup(this.formValidate.is_sub);\n          if (!this.$route.params.id && this.formValidate.spec_type === 1) {\n            this.manyFormValidate.map((item) => {\n              item.pic = this.formValidate.slider_image[0];\n            });\n            this.oneFormBatch[0].pic = this.formValidate.slider_image[0];\n          } else if (this.$route.params.id) {\n            this.manyFormValidate.map((item) => {\n              if (!item.pic) {\n                item.pic = this.formValidate.slider_image[0];\n              }\n            });\n            this.oneFormBatch[0].pic = this.formValidate.slider_image[0];\n          }\n\t\t\t\t\tthis.getAttr();\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    // 取消\n    offAttrName() {\n      this.showIput = false;\n      this.createBnt = true;\n    },\n    clearAttr() {\n      this.formDynamic.attrsName = \"\";\n      this.formDynamic.attrsVal = \"\";\n    },\n    // 删除规格\n    handleRemoveRole(index) {\n      this.attrs.splice(index, 1);\n      this.manyFormValidate.splice(index, 1);\n    },\n    // 删除属性\n    handleRemove2(item, index) {\n      item.splice(index, 1);\n    },\n    // 添加规则名称\n    createAttrName() {\n      if (this.formDynamic.attrsName && this.formDynamic.attrsVal) {\n        let data = {\n          value: this.formDynamic.attrsName,\n          detail: [this.formDynamic.attrsVal],\n        };\n        this.attrs.push(data);\n        var hash = {};\n        this.attrs = this.attrs.reduce(function (item, next) {\n          /* eslint-disable */\n          hash[next.value] ? \"\" : (hash[next.value] = true && item.push(next));\n          return item;\n        }, []);\n        this.clearAttr();\n        this.showIput = false;\n        this.createBnt = true;\n      } else {\n        this.$Message.warning(\"请添加完整的规格！\");\n      }\n    },\n    // 添加属性\n    createAttr(num, idx) {\n      if (num) {\n        this.attrs[idx].detail.push(num);\n        var hash = {};\n        this.attrs[idx].detail = this.attrs[idx].detail.reduce(function (\n          item,\n          next\n        ) {\n          /* eslint-disable */\n          hash[next] ? \"\" : (hash[next] = true && item.push(next));\n          return item;\n        },\n        []);\n      } else {\n        this.$Message.warning(\"请添加属性\");\n      }\n    },\n    // 商品分类；\n    goodsCategory() {\n      cascaderListApi(1)\n        .then((res) => {\n          this.treeSelect = res.data;\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n\t//视视上传类型\n\tchangeVideo(e) {\n\t  this.formValidate.video_link = \"\";\n\t  this.videoLink = \"\";\n\t},\n    // 改变规格\n    changeSpec() {\n      this.formValidate.is_sub = [];\n      let id = this.$route.params.id;\n      if (id) {\n        checkActivityApi(id)\n          .then((res) => {})\n          .catch((res) => {\n            this.formValidate.spec_type = this.spec_type;\n            this.$Message.error(res.msg);\n          });\n      }\n    },\n    // 详情\n    getInfo() {\n      let that = this;\n      that.spinShow = true;\n      productInfoApi(that.$route.params.id)\n        .then(async (res) => {\n          let data = res.data.productInfo;\n          this.merchantType = parseInt(data.type);\n          this.infoData(data);\n          // let cate_id = data.cate_id.map(Number);\n          // let label_id = data.label_id.map(Number);\n          // this.attrs = data.items || [];\n          // let ids = [];\n          // data.coupons.map((item) => {\n          //   ids.push(item.id);\n          // });\n          // that.formValidate = data;\n          // that.couponName = data.coupons;\n          // that.formValidate.coupon_ids = ids;\n          // that.updateIds = ids;\n          // that.updateName = data.coupons;\n          // that.formValidate.cate_id = cate_id;\n          // that.formValidate.label_id = label_id;\n          // that.oneFormValidate = [data.attr];\n          // that.formValidate.header = [];\n          // that.manyFormValidate = data.attrs;\n          // that.generate(0);\n          // that.spec_type = data.spec_type;\n          // if (data.spec_type === 0) {\n          //   that.manyFormValidate = [];\n          // } else {\n          //   that.createBnt = true;\n          //   that.oneFormValidate = [\n          //     {\n          //       pic: data.image,\n          //       price: 0,\n          //       cost: 0,\n          //       ot_price: 0,\n          //       stock: 0,\n          //       bar_code: \"\",\n          //       weight: 0,\n          //       volume: 0,\n          //       brokerage: 0,\n          //       brokerage_two: 0,\n          //       vip_price: 0,\n          //     },\n          //   ];\n          // }\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    // tab切换\n    onhangeTab(name) {\n      this.currentTab = name;\n    },\n    handleRemove(i) {\n      this.images.splice(i, 1);\n      this.formValidate.slider_image.splice(i, 1);\n\t  this.oneFormValidate[0].pic = this.formValidate.slider_image[0];\n    },\n    // 关闭图片上传模态框\n    changeCancel(msg) {\n      this.modalPic = false;\n    },\n    // 点击商品图\n    modalPicTap(tit, picTit, index) {\n      this.modalPic = true;\n      this.isChoice = tit === \"dan\" ? \"单选\" : \"多选\";\n      this.picTit = picTit;\n      this.tableIndex = index;\n    },\n    // 获取单张图片信息\n    getPic(pc) {\n      switch (this.picTit) {\n        case \"danFrom\":\n          this.formValidate.image = pc.att_dir;\n          if (!this.$route.params.id) {\n            if (this.formValidate.spec_type === 0) {\n              this.oneFormValidate[0].pic = pc.att_dir;\n            } else {\n              this.manyFormValidate.map((item) => {\n                item.pic = pc.att_dir;\n              });\n              this.oneFormBatch[0].pic = pc.att_dir;\n            }\n          }\n          break;\n        case \"danTable\":\n          this.oneFormValidate[this.tableIndex].pic = pc.att_dir;\n          break;\n        case \"duopi\":\n          this.oneFormBatch[this.tableIndex].pic = pc.att_dir;\n          break;\n        case \"recommend_image\":\n          this.formValidate.recommend_image = pc.att_dir;\n          break;\n        default:\n          this.manyFormValidate[this.tableIndex].pic = pc.att_dir;\n      }\n      this.modalPic = false;\n    },\n    // 获取多张图信息\n    getPicD(pc) {\n      this.images = pc;\n      this.images.map((item) => {\n        this.formValidate.slider_image.push(item.att_dir);\n        this.formValidate.slider_image = this.formValidate.slider_image.splice(\n          0,\n          10\n        );\n      });\n\t  this.oneFormValidate[0].pic = this.formValidate.slider_image[0];\n      this.modalPic = false;\n    },\n    // 提交\n    handleSubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n\t\t  if (!this.formValidate.store_name.trim()) {\n\t\t    return this.$Message.warning(\"基础信息-商品名称不能为空\");\n\t\t  }\n\t\t  if(this.formValidate.is_show == 2 && !this.formValidate.auto_on_time){\n\t\t  \treturn this.$Message.warning(\"基础信息-定时上架时间不能为空\");\n\t\t  }\n\t\t  if(this.off_show == 1 && !this.formValidate.auto_off_time){\n\t\t  \treturn this.$Message.warning(\"基础信息-定时下架时间不能为空\");\n\t\t  }\t\n\t\t  if(this.formValidate.freight==2&&this.formValidate.product_type == 0&&this.formValidate.postage<=0){\n\t\t\t  return this.$Message.warning(\"物流设置-固定邮费不能为0\");\n\t\t  }\n\t\t  if(this.formValidate.freight==3&&this.formValidate.product_type == 0&&!this.formValidate.temp_id){\n\t\t  \t  return this.$Message.warning(\"物流设置-运费模板不能为空\");\n\t\t  }\n\t\t  if(this.formValidate.product_type==0&&this.formValidate.is_presale_product&&!this.formValidate.presale_time[0]){\n\t\t\t  return this.$Message.warning(\"营销设置-预售时间不能为空\");\n\t\t  }\n\t\t  for (let i = 0; i < this.formValidate.custom_form.length; i++) {\n\t\t    const element = this.formValidate.custom_form[i];\n\t\t    if (!element.title) {\n\t\t      return this.$Message.warning(\"其他设置-留言标题不能为空\");\n\t\t    }\n\t\t  }\n          this.formValidate.type = this.type;\n          if (this.formValidate.spec_type === 0) {\n            this.formValidate.attrs = this.oneFormValidate;\n            this.formValidate.header = [];\n            this.formValidate.items = [];\n          } else {\n            this.formValidate.items = this.attrs;\n            this.formValidate.attrs = this.manyFormValidate;\n          }\n          if (\n            this.formValidate.spec_type === 1 &&\n            this.manyFormValidate.length === 0\n          ) {\n            return this.$Message.warning(\"规格库存-请点击生成多规格\");\n            // return this.$Message.warning('请点击生成规格！');\n          }\n          let item = this.formValidate.attrs;\n          if ( this.formValidate.is_sub.indexOf(1) != -1 ) {\n            for (let i = 0; i < item.length; i++) {\n              if (\n                item[i].brokerage === null ||\n                item[i].brokerage_two === null\n              ) {\n                return this.$Message.warning(\"营销设置- 一二级返佣不能为空\");\n              }\n            }\n          }\n          if(this.formValidate.is_sub.indexOf(0) != -1){\n\t\t\t  for (let i = 0; i < item.length; i++) {\n\t\t\t\t  if (item[i].vip_price === null) {\n\t\t\t\t\t  return this.$Message.warning(\"营销设置-会员价不能为空\");\n\t\t\t\t  }\n\t\t\t\t  if (item[i].vip_price === 0) {\n\t\t\t\t\t  return this.$Message.warning(\"营销设置-会员价不能为0\");\n\t\t\t\t  }\n\t\t\t  }\n\t\t  }\n          if (this.formValidate.is_sub.length === 2) {\n            for (let i = 0; i < item.length; i++) {\n              if (\n                item[i].brokerage === null ||\n                item[i].brokerage_two === null ||\n                item[i].vip_price === null\n              ) {\n                return this.$Message.error(\n                  \"营销设置- 一二级返佣和会员价不能为空\"\n                );\n              }\n            }\n          }\n\t\t\tfor (let i = 0; i < this.specsList.length; i++){\n\t\t\t\tlet data = this.specsList[i];\n\t\t\t\tif(!data.name.trim()){\n\t\t\t\t\treturn this.$Message.error('请输入参数名称');\n\t\t\t\t}\n\t\t\t\tif(!data.value.trim()){\n\t\t\t\t\treturn this.$Message.error('请输入参数值');\n\t\t\t\t}\n\t\t\t}\n\t\t  if(!this.formValidate.product_type){\n\t\t\t  this.formValidate.is_support_refund = 1;  \n\t\t  }\n          this.openSubimit = false;\n\t\t  this.formValidate.description = this.formatRichText(this.content);\n\t\t\tlet goodsId = [];\n\t\t\tthis.goodsData.forEach(item=>{\n\t\t\t\tgoodsId.push(item.product_id)\n\t\t\t})\n\t\t\tthis.formValidate.recommend_list = goodsId;\n\t\t\t// 用户标签\n\t\t\tlet activeIds = [];\n\t\t\tthis.dataLabel.forEach((item)=>{\n\t\t\t\tactiveIds.push(item.id)\n\t\t\t});\n\t\t\tthis.formValidate.label_id = activeIds\n\t\t\t// 商品标签\n\t\t\tlet storeActiveIds = [];\n\t\t\tthis.storeDataLabel.forEach((item)=>{\n\t\t\t\tstoreActiveIds.push(item.id)\n\t\t\t});\n\t\t\tthis.formValidate.store_label_id = storeActiveIds\n\t\t\t// 商品参数\n\t\t\tthis.formValidate.specs = this.specsList;\n          productAddApi(this.formValidate)\n            .then(async (res) => {\n              this.openSubimit = true;\n              this.$Message.success(res.msg);\n              if (this.$route.params.id === \"0\") {\n                cacheDelete().catch((err) => {\n                  this.$Message.error(err.msg);\n                });\n              }\n              setTimeout(() => {\n                this.$router.push({ path: \"/admin/product/product_list\" });\n              }, 500);\n            })\n            .catch((res) => {\n              this.openSubimit = false;\n              this.$Message.error(res.msg);\n            });\n        } else {\n          if (!this.formValidate.store_name) {\n            return this.$Message.warning(\"基础信息-商品名称不能为空\");\n          } else if (!this.formValidate.cate_id.length) {\n            return this.$Message.warning(\"基础信息-商品分类不能为空\");\n          } else if (!this.formValidate.unit_name) {\n            return this.$Message.warning(\"基础信息-商品单位不能为空\");\n          } else if (!this.formValidate.slider_image.length) {\n            return this.$Message.warning(\"基础信息-商品轮播图不能为空\");\n          } \n          //    if(!this.formValidate.store_name || !this.formValidate.cate_id || !this.formValidate.keyword\n          //    || !this.formValidate.unit_name || !this.formValidate.store_info\n          //        || !this.formValidate.image || !this.formValidate.slider_image){\n          //        this.$Message.warning(\"请填写完整商品信息！\");\n          //    }\n        }\n      });\n    },\n    changeTemplate(msg) {\n      this.template = msg;\n    },\n    // 表单验证\n    validate(prop, status, error) {\n      if (status === false) {\n        this.$Message.warning(error);\n      }\n    },\n    // 移动\n    handleDragStart(e, item) {\n      this.dragging = item;\n    },\n    handleDragEnd(e, item) {\n      this.dragging = null;\n    },\n    handleDragOver(e) {\n      e.dataTransfer.dropEffect = \"move\";\n    },\n    handleDragEnter(e, item) {\n      e.dataTransfer.effectAllowed = \"move\";\n      if (item === this.dragging) {\n        return;\n      }\n      const newItems = [...this.formValidate.slider_image];\n      const src = newItems.indexOf(this.dragging);\n      const dst = newItems.indexOf(item);\n      newItems.splice(dst, 0, ...newItems.splice(src, 1));\n      this.formValidate.slider_image = newItems;\n    },\n    // 添加自定义弹窗\n    addCustomDialog(editorId) {\n      window.UE.registerUI(\n        \"test-dialog\",\n        function (editor, uiName) {\n          // 创建 dialog\n          let dialog = new window.UE.ui.Dialog({\n            iframeUrl: \"/admin/widget.images/index.html?fodder=dialog\",\n            editor: editor,\n            name: uiName,\n            title: \"上传图片\",\n            cssRules: \"width:1200px;height:500px;padding:20px;\",\n          });\n          this.dialog = dialog;\n          let btn = new window.UE.ui.Button({\n            name: \"dialog-button\",\n            title: \"上传图片\",\n            cssRules: `background-image: url(https://cdn.oss.9gt.net/prov1.1/1/icons.png);background-position: -726px -77px;`,\n            onclick: function () {\n              // 渲染dialog\n              dialog.render();\n              dialog.open();\n            },\n          });\n          return btn;\n        },\n        37\n      );\n      window.UE.registerUI(\n        \"video-dialog\",\n        function (editor, uiName) {\n          let dialog = new window.UE.ui.Dialog({\n            iframeUrl: \"/admin/widget.video/index.html?fodder=video\",\n            editor: editor,\n            name: uiName,\n            title: \"上传视频\",\n            cssRules: \"width:1000px;height:500px;padding:20px;\",\n          });\n          this.dialog = dialog;\n          let btn = new window.UE.ui.Button({\n            name: \"video-button\",\n            title: \"上传视频\",\n            cssRules: `background-image: url(../../../assets/images/icons.png);background-position: -320px -20px;`,\n            onclick: function () {\n              // 渲染dialog\n              dialog.render();\n              dialog.open();\n            },\n          });\n          return btn;\n        },\n        38\n      );\n    },\n    formatRichText(html) {\n      let newContent = html.replace(/<img[^>]*>/gi, function (match, capture) {\n        match = match\n          .replace(/style=\"[^\"]+\"/gi, \"\")\n          .replace(/style='[^']+'/gi, \"\");\n        match = match\n          .replace(/width=\"[^\"]+\"/gi, \"\")\n          .replace(/width='[^']+'/gi, \"\");\n        match = match\n          .replace(/height=\"[^\"]+\"/gi, \"\")\n          .replace(/height='[^']+'/gi, \"\");\n        return match;\n      });\n      newContent = newContent.replace(\n        /style=\"[^\"]+\"/gi,\n        function (match, capture) {\n          match = match\n            .replace(/width:[^;]+;/gi, \"max-width:100%;\")\n            .replace(/width:[^;]+;/gi, \"max-width:100%;\");\n          return match;\n        }\n      );\n      newContent = newContent.replace(/<br[^>]*\\/>/gi, \"\");\n      newContent = newContent.replace(\n        /\\<img/gi,\n        '<img style=\"max-width:100%;height:auto;display:block;margin-top:0;margin-bottom:0;\"'\n      );\n      return newContent;\n    },\n  },\n};\n",null]}