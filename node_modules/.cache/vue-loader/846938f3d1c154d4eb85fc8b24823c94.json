{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/layouts/basic-layout/header-notice/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/layouts/basic-layout/header-notice/index.vue","mtime":1654055305000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\";\nimport { jnoticeRequest } from \"@/api/common\";\nimport { adminSocket } from \"@/libs/socket\";\nimport util from \"@/libs/util\";\n\nexport default {\n  name: \"iHeaderNotice\",\n  data() {\n    return {\n      badgeProps: {\n        offset: [20, 0],\n        dot: true,\n      },\n      needList: [],\n      messageList: [],\n      messageLoading: false,\n      newOrderAudioLink: \"\",\n      pageWs: \"\",\n    };\n  },\n  computed: {\n    ...mapState(\"admin/layout\", [\"isMobile\"]),\n    ...mapState(\"admin/kefu\", [\"socketStatus\"]),\n  },\n  mounted() {\n    this.getNotict();\n    this.$store\n      .dispatch(\"admin/db/get\", {\n        dbName: \"sys\",\n        path: \"user.info\",\n        user: true,\n      })\n      .then((res) => {\n        this.newOrderAudioLink = res.newOrderAudioLink;\n      });\n    this.pageWs = adminSocket(false, util.cookies.get(\"token\"));\n    this.wsStart();\n  },\n  methods: {\n    wsStart() {\n      this.pageWs\n        .then((ws) => {\n          let that = this;\n          if (this.socketStatus) {\n            return;\n          }\n          ws.$on('close',()=>{\n            this.$store.commit(\"admin/kefu/setStatus\", false);\n          })\n\n          ws.$on(\"ADMIN_NEW_PUSH\", function (data) {\n            that.getNotict();\n          });\n          ws.$on(\"success\", () => {\n            this.$store.commit(\"admin/kefu/setStatus\", true);\n          });\n          ws.$on(\"NEW_ORDER\", function (data) {\n            that.$Notice.info({\n              title: \"新订单\",\n              duration: 8,\n              // desc: \"您有一个新的订单(\" + data.order_id + \"),请注意查看\",\n\t\t\t\t\t\t\t// render:h=>{\n\t\t\t\t\t\t\t// \treturn h('div','您有一个新的订单(' + data.order_id + '),请注意查看')\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\trender:h=>{\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<div class=\"tle\">您有一个新的订单({data.order_id}),请注意查看</div>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n            });\n            if (this.newOrderAudioLink)\n              new Audio(this.newOrderAudioLink).play();\n            that.messageList.push({\n              title: \"新订单提醒\",\n              icon: \"md-bulb\",\n              iconColor: \"#87d068\",\n              time: 0,\n              read: 0,\n            });\n          });\n          ws.$on(\"NEW_REFUND_ORDER\", function (data) {\n            that.$Notice.warning({\n              title: \"退款订单提醒\",\n              duration: 8,\n              desc: \"您有一个订单(\" + data.order_id + \")申请退款,请注意查看\",\n            });\n            if (window.newOrderAudioLink)\n              new Audio(window.newOrderAudioLink).play();\n            that.messageList.push({\n              title: \"退款订单提醒\",\n              icon: \"md-information\",\n              iconColor: \"#fe5c57\",\n              time: 0,\n              read: 0,\n            });\n          });\n          ws.$on(\"WITHDRAW\", function (data) {\n            that.$Notice.warning({\n              title: \"提现提醒\",\n              duration: 8,\n              desc: \"有用户申请提现(\" + data.id + \"),请注意查看\",\n            });\n            that.messageList.push({\n              title: \"退款订单提醒\",\n              icon: \"md-people\",\n              iconColor: \"#f06292\",\n              time: 0,\n              read: 0,\n            });\n          });\n          ws.$on(\"STORE_STOCK\", function (data) {\n            that.$Notice.warning({\n              title: \"库存预警\",\n              duration: 8,\n              desc: \"(\" + data.id + \")商品库存不足,请注意查看\",\n            });\n            that.messageList.push({\n              title: \"库存预警\",\n              icon: \"md-information\",\n              iconColor: \"#fe5c57\",\n              time: 0,\n              read: 0,\n            });\n          });\n          ws.$on(\"PAY_SMS_SUCCESS\", function (data) {\n            that.$Notice.info({\n              title: \"短信充值成功\",\n              duration: 8,\n              desc:\n                \"恭喜您充值\" + data.price + \"元，获得\" + data.number + \"条短信\",\n            });\n            that.messageList.push({\n              title: \"短信充值成功\",\n              icon: \"md-bulb\",\n              iconColor: \"#87d068\",\n              time: 0,\n              read: 0,\n            });\n          });\n          ws.$on(\"timeout\", (data) => {\n            //this.wsRestart();\n          });\n        })\n    },\n    wsRestart() {\n      if (this.pageWs === null) {\n        this.pageWs = adminSocket(true, util.cookies.get(\"token\"));\n        this.wsStart();\n      } else {\n        this.pageWs.reconne();\n      }\n    },\n    jumpUrl(url) {\n      this.$router.push({ path: url });\n    },\n    getNotict() {\n      jnoticeRequest()\n        .then((res) => {\n          this.needList = res.data || [];\n          this.badgeProps.dot = res.data.length > 0;\n        })\n        .catch(() => {});\n    },\n    handleClear(tab) {\n      this.badgeProps.dot = false;\n      this.clearUnread(tab.name);\n    },\n    clearUnread(type) {\n      this[`${type}List`] = this[`${type}List`].map((item) => {\n        item.read = 1;\n        return item;\n      });\n      this[`${type}List`] = [];\n    },\n  },\n};\n",null]}