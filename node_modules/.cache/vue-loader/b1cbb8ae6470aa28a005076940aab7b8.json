{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/marketing/shortVideo/create.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/marketing/shortVideo/create.vue","mtime":1663723634000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\";\nimport uploadPictures from \"@/components/uploadPictures\";\nimport { videoInfo, videoSave } from \"@/api/marketing\";\nimport goodsList from '@/components/goodsList';\nexport default {\n    name: \"create\",\n    components:{\n        uploadPictures,\n        goodsList\n    },\n    data() {\n        const validateImage = (rule, value, callback) =>{\n            if(!value){\n                return callback(new Error('请上传视频封面图'))\n            }else{\n                callback();\n            }\n        };\n        const validateVideo = (rule, value, callback) => {\n            if(!value){\n                return callback(new Error('请上传视频'))\n            }else{\n                callback();\n            }\n        };\n        return {\n            currentTab: \"1\",\n            modals:false,\n            gridBtn: {\n                xl: 4,\n                lg: 8,\n                md: 8,\n                sm: 8,\n                xs: 8,\n            },\n            gridPic: {\n                xl: 6,\n                lg: 8,\n                md: 12,\n                sm: 12,\n                xs: 12,\n            },\n            headeNum: [\n                { type: \"1\", name: \"基础设置\" },\n                { type: \"2\", name: \"关联商品\" }\n            ],\n            formValidate:{\n                desc:'',\n                image:'',\n                sort:0,\n                video_url:'',\n                product_id:[]\n            },\n            modalPic: false,\n            isChoice: \"单选\",\n            ruleValidate: {\n                desc: [\n                    { required: true, message: '请输入视频简介', trigger: 'blur' }\n                ],\n                video_url: [\n                    {\n                        required: true,\n                        message: \"请上传视频\",\n                        validator: validateVideo,\n                        trigger: \"change\",\n                    }\n                ],\n                image: [\n                    {\n                        required: true,\n                        validator: validateImage,\n                        trigger: 'change',\n                    }\n                ]\n            },\n            columns: [\n                {\n                    type: 'selection',\n                    width: 60,\n                    align: 'center'\n                },\n                {\n                    title: \"商品信息\",\n                    slot: \"info\",\n                    minWidth: 180,\n                },\n                {\n                    title: \"商品分类\",\n                    key: \"cate_name\",\n                    minWidth: 180,\n                },\n                {\n                    title: \"售价\",\n                    key: \"price\",\n                    minWidth: 180,\n                },\n                {\n                    title: \"库存\",\n                    key: \"stock\",\n                    minWidth: 180,\n                },\n                {\n                    title: \"操作\",\n                    slot: \"action\",\n                    fixed: \"right\",\n                    width: 100,\n                }\n            ],\n            tableData:[],\n            id:0,\n            formSelection:[],\n            typeTit:''\n        };\n    },\n    computed: {\n        ...mapState(\"admin/layout\", [\"isMobile\",\"menuCollapse\"]),\n        labelWidth() {\n            return this.isMobile ? undefined : 90;\n        },\n        labelPosition() {\n            return this.isMobile ? \"top\" : \"right\";\n        }\n    },\n    created() {\n        this.id = this.$route.params.id || 0;\n        if(this.id){\n            this.getInfo();\n        }\n    },\n    methods: {\n        delVideo(){\n            let that = this;\n            that.$set(that.formValidate, \"video_url\", \"\");\n            this.$refs.formValidate.validateField('video_url');\n        },\n        del(row){\n            this.tableData.forEach((item,index)=>{\n                if(row.id === item.id){\n                    return this.tableData.splice(index, 1)\n                }\n            })\n        },\n        batchDel(){\n            for(var i=0;i<this.formSelection.length;i++){\n                for(var j=0;j<this.tableData.length;j++){\n                    if(this.tableData[j].id===this.formSelection[i].id){\n                        this.tableData.splice(j,1);\n                        j--;\n                    }\n                }\n            }\n        },\n        selectChange(data){\n            this.formSelection = data;\n        },\n        addGoods(){\n            this.modals = true;\n        },\n        cancel () {\n            this.modals = false;\n        },\n        //对象数组去重；\n        unique(arr) {\n            const res = new Map();\n            return arr.filter((arr) => !res.has(arr.id) && res.set(arr.id, 1))\n        },\n        getProductId (data) {\n            this.modals = false;\n            let list = this.tableData.concat(data);\n            this.tableData = this.unique(list);\n        },\n        //视频详情\n        getInfo(){\n            videoInfo(this.id).then(res=>{\n                this.formValidate = res.data;\n                this.tableData = res.data.productInfo;\n            }).catch(err=>{\n                this.$Message.error(err.msg)\n            })\n        },\n        upTab(){\n            this.currentTab =  '1';\n        },\n        downTab(name){\n            this.$refs[name].validate((valid) => {\n                if (valid) {\n                    this.currentTab =  '2';\n                }else{\n                    this.$Message.warning(\"请完善数据\");\n                }\n            })\n        },\n        //保存视频\n        handleSubmit(name){\n            this.$refs[name].validate((valid) => {\n                if (valid) {\n\n                    let product_id = [];\n                    this.tableData.forEach(item=>{\n                        product_id.push(item.id)\n                    });\n                    this.formValidate.product_id = product_id;\n                    videoSave(this.formValidate,this.id).then(res=>{\n                        this.$router.push({ path: \"/admin/marketing/short_video/index\" });\n                        this.$Message.success(res.msg)\n                    }).catch(err=>{\n                        this.$Message.error(err.msg)\n                    })\n                }else{\n                    this.$Message.warning(\"请完善数据\");\n                }\n            })\n        },\n        // 点击商品图\n        modalPicTap(type) {\n            this.typeTit = type;\n            this.modalPic = true;\n        },\n        // 获取单张图片信息\n        getPic(pc) {\n            this.modalPic = false;\n            if(this.typeTit == 'image'){\n                this.formValidate.image = pc.att_dir;\n                this.$refs.formValidate.validateField('image');\n            }else{\n                this.formValidate.video_url = pc.att_dir;\n                this.$refs.formValidate.validateField('video_url');\n            }\n        },\n        handleRemove() {\n            this.formValidate.image = '';\n            this.$refs.formValidate.validateField('image');\n        },\n    }\n};\n",null]}