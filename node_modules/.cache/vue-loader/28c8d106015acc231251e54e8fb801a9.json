{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/system/maintain/systemDatabackup/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/system/maintain/systemDatabackup/index.vue","mtime":1650075894000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { backupListApi, backupBackupApi, backupOptimizeApi, backupRepairApi, filesListApi, filesDownloadApi, filesImportApi } from '@/api/system';\nimport Setting from '@/setting';\nimport dataDetails from \"./handle/dataDetails\";\nexport default {\n    name: 'systemDatabackup',\n    components: {\n        dataDetails,\n    },\n    data () {\n        return {\n            modals: false,\n            loading: false,\n            tabList: [],\n            columns4: [\n                {\n                    title: '备份名称',\n                    key: 'filename',\n                    minWidth: 200,\n                    sortable: true\n                },\n                {\n                    title: 'part',\n                    key: 'part',\n                    minWidth: 100\n                },\n                {\n                    title: '大小',\n                    key: 'size',\n                    minWidth: 150\n                },\n                {\n                    title: 'compress',\n                    key: 'compress',\n                    minWidth: 100\n                },\n                {\n                    title: '时间',\n                    key: 'backtime',\n                    minWidth: 150\n                },\n                {\n                    title: '操作',\n                    slot: 'action',\n                    fixed: 'right',\n                    minWidth: 100\n                }\n            ],\n            tabList2: [],\n            columns: [\n                {\n                    type: 'selection',\n                    width: 60,\n                    align: 'center'\n                },\n                {\n                    title: '表名称',\n                    key: 'name',\n                    minWidth: 200,\n                    sortable: true\n                },\n                {\n                    title: '备注',\n                    key: 'comment',\n                    minWidth: 200\n                },\n                {\n                    title: '类型',\n                    key: 'engine',\n                    minWidth: 130,\n                    sortable: true\n                },\n                {\n                    title: '大小',\n                    key: 'data_length',\n                    minWidth: 130,\n                    sortable: true\n                },\n                {\n                    title: '更新时间',\n                    key: 'update_time',\n                    minWidth: 150,\n                    sortable: true\n                },\n                {\n                    title: '行数',\n                    key: 'rows',\n                    minWidth: 100,\n                    sortable: true\n                },\n                {\n                    title: '操作',\n                    slot: 'action',\n                    fixed: 'right',\n                    minWidth: 60\n                }\n            ],\n            selectionList: [],\n            // tabList3: [],\n            // columns2: [\n            //     {\n            //         title: '字段名',\n            //         key: 'COLUMN_NAME'\n            //     },\n            //     {\n            //         title: '数据类型',\n            //         key: 'COLUMN_TYPE'\n            //     },\n            //     {\n            //         title: '默认值',\n            //         key: 'COLUMN_DEFAULT'\n            //     },\n            //     {\n            //         title: '允许非空',\n            //         key: 'IS_NULLABLE'\n            //     },\n            //     {\n            //         title: '自动递增',\n            //         key: 'EXTRA'\n            //     },\n            //     {\n            //         title: '备注',\n            //         key: 'COLUMN_COMMENT'\n            //     }\n            // ],\n            rows: {},\n            dataList: {},\n            loading2: false,\n            loading3: false,\n            header: {},\n            Token: ''\n        }\n    },\n    computed: {\n        fileUrl () {\n            const search = '/adminapi/';\n            const start = Setting.apiBaseURL.indexOf(search);\n            return Setting.apiBaseURL.substring(0, start);// 截取字符串\n        }\n    },\n    created () {\n        this.getToken();\n        this.getList();\n        this.getfileList();\n    },\n    methods: {\n        // 导入\n        ImportFile (row) {\n            filesImportApi({\n                part: row.part,\n                time: row.time\n            }).then(async res => {\n                this.$Message.success(res.msg);\n                this.getfileList();\n            }).catch(res => {\n                this.loading = false;\n                this.$Message.error(res.msg);\n            })\n        },\n        // 删除备份记录表\n        del (row, tit, num) {\n            let delfromData = {\n                title: tit,\n                num: num,\n                url: `system/backup/del_file`,\n                method: 'DELETE',\n                ids: {\n                    filename: row.time\n                }\n            };\n            this.$modalSure(delfromData).then((res) => {\n                this.$Message.success(res.msg);\n                this.tabList.splice(num, 1);\n            }).catch(res => {\n                this.$Message.error(res.msg);\n            });\n        },\n        // 上传头部token\n        getToken () {\n            this.$store.dispatch('admin/db/database', {\n                user: true\n            }).then(res => {\n                this.Token = res.get('TOKEN').value();\n            })\n        },\n        download (row) {\n            let data = {\n                time: row.time\n            }\n            filesDownloadApi(data).then(res => {\n                if (res.data.key) {\n                   window.open(Setting.apiBaseURL + '/download?key=' + res.data.key)\n                }\n            }).catch(res => {\n                this.$Message.error(res);\n            })\n        },\n        // 导出备份记录表\n        exportData () {\n            const columns = this.columns.slice(1, 7);\n            this.$refs.selection.exportCsv({\n                filename: '导出',\n                columns: columns,\n                data: this.tabList2\n            });\n        },\n        // 全选\n        onSelectTab (selection) {\n            this.selectionList = selection;\n            let tables = [];\n            this.selectionList.map((item) => {\n                tables.push(item.name)\n            });\n            this.dataList = {\n                tables: tables.join(',')\n            };\n        },\n        // 备份表\n        getBackup () {\n            if (this.selectionList.length === 0) {\n                return this.$Message.warning('请选择表');\n            }\n            backupBackupApi(this.dataList).then(async res => {\n                this.$Message.success(res.msg);\n                this.getfileList();\n            }).catch(res => {\n                this.loading = false;\n                this.$Message.error(res.msg);\n            })\n        },\n        // 备份记录表列表\n        getfileList () {\n            this.loading3 = true;\n            filesListApi().then(async res => {\n                let data = res.data;\n                this.tabList = data.list;\n                this.loading3 = false;\n            }).catch(res => {\n                this.loading3 = false;\n                this.$Message.error(res.msg);\n            })\n        },\n        // 优化表\n        getOptimize () {\n            if (this.selectionList.length === 0) {\n                return this.$Message.warning('请选择表');\n            }\n            backupOptimizeApi(this.dataList).then(async res => {\n                this.$Message.success(res.msg);\n            }).catch(res => {\n                this.$Message.error(res.msg);\n            })\n        },\n        // 修复表\n        getRepair () {\n            if (this.selectionList.length === 0) {\n                return this.$Message.warning('请选择表');\n            }\n            backupRepairApi(this.dataList).then(async res => {\n                this.$Message.success(res.msg);\n            }).catch(res => {\n                this.$Message.error(res.msg);\n            })\n        },\n        // 数据库列表\n        getList () {\n            this.loading = true;\n            backupListApi().then(async res => {\n                let data = res.data;\n                this.tabList2 = data.list;\n                this.loading = false;\n            }).catch(res => {\n                this.loading = false;\n                this.$Message.error(res.msg);\n            })\n        },\n        // 详情\n        Info (row) {\n            this.$refs.dataDetails.modals = true;\n            this.$refs.dataDetails.activeName = \"datainfo\";\n            this.$refs.dataDetails.getDetails(row);\n        }\n    }\n}\n",null]}