{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/store/components/addStore.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/store/components/addStore.vue","mtime":1662022679000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\t// import { keyApi} from '@/api/setting';\n\timport { keyApi, storeGetInfoApi, cityApi, storeUpdateApi } from '@/api/store';\n\timport { erpConfig } from \"@/api/erp\";\n\t// import { keyApi, storeUpdateApi, storeGetInfoApi, cityApi } from '@/api/setting';\n\timport { mapState } from 'vuex';\n\timport uploadPictures from '@/components/uploadPictures';\n\timport erpList from './erpList.vue';\n\timport Maps from '@/components/map/map.vue'\n\texport default {\n\t\tname: 'systemStore',\n\t\tcomponents: { uploadPictures,Maps,erpList },\n\t\tprops: { },\n\t\tdata () {\n\t\t\tlet validatePhone = (rule, value, callback) => {\n\t\t\t\tif (!value) {\n\t\t\t\t\treturn callback(new Error('请填写手机号'));\n\t\t\t\t} else if (!/^1[3456789]\\d{9}$/.test(value)) {\n\t\t\t\t\tcallback(new Error('手机号格式不正确!'));\n\t\t\t\t} else {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t};\n\t\t\tlet validateUpload = (rule, value, callback) => {\n\t\t\t\tif (!this.formItem.image) {\n\t\t\t\t\tcallback(new Error('请上传门店照片'))\n\t\t\t\t} else {\n\t\t\t\t\tcallback()\n\t\t\t\t}\n\t\t\t};\n\t\t\tlet validateErp = (rule, value, callback) => {\n\t\t\t\tif (this.formItem.erp_shop_id == 0) {\n\t\t\t\t\tcallback(new Error('请选择erp门店'))\n\t\t\t\t} else {\n\t\t\t\t\tcallback()\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tmodalErp:false,\n\t\t\t\topenErp:false,\n\t\t\t\tisTemplate: false,\n\t\t\t\ttitle: '',\n\t\t\t\tformItem: {\n\t\t\t\t\tid: 0,\n\t\t\t\t\terp_shop_id: 0,\n\t\t\t\t\tstore_account: '',\n\t\t\t\t\tstore_password: '',\n\t\t\t\t\timage: '',\n\t\t\t\t\tname: '',\n\t\t\t\t\tintroduction: '',\n\t\t\t\t\tphone: '',\n\t\t\t\t\tis_show: 1,\n\t\t\t\t\tday_time: [],\n\t\t\t\t\tis_store: 0,\n\t\t\t\t\taddress: '',\n\t\t\t\t\tdetailed_address: '',\n\t\t\t\t\tlatitude:'',\n\t\t\t\t\tlongitude:'',\n\t\t\t\t\tprovince:0,\n\t\t\t\t\tcity:0,\n\t\t\t\t\tarea:0,\n\t\t\t\t\tstreet:0,\n\t\t\t\t\taddressSelect:[],\n\t\t\t\t\tvalid_range:0,\n\t\t\t\t\tproduct_verify_status:0,\n          product_status:1\n\t\t\t\t},\n\t\t\t\tspinShow: false,\n\t\t\t\taddresData: [],\n\t\t\t\truleValidate: {\n\t\t\t\t\tname: [\n\t\t\t\t\t\t{ required: true, message: '请输入门店名称', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\terp_shop_id: [\n\t\t\t\t\t\t{ required: true, validator: validateErp, trigger: 'change' }\n\t\t\t\t\t],\n\t\t\t\t\tstore_account: [\n\t\t\t\t\t\t{ required: true, message: '请输入管理员账号', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tstore_password: [\n\t\t\t\t\t\t{ required: true, message: '请输入管理员密码', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\taddress: [\n\t\t\t\t\t\t{ required: true, message: '请选择门店地址', trigger: 'change' }\n\t\t\t\t\t],\n\t\t\t\t\tday_time: [ \n\t\t\t\t\t\t{required: true,type: \"array\", message: \"请选择营业时间\",trigger: \"change\"},\n\t\t\t\t\t\t{validator(rule, value, callback, source, options) \n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (value[0] === \"\") {\n\t\t\t\t\t\t\t\tcallback(\"时间不能为空\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t callback();//这个一定要有。不然无法验证通过\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t    ],//TimePicker-timerange，自定义的\n\n\t\t\t\t\tphone: [\n\t\t\t\t\t\t{ required: true, validator: validatePhone, trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tdetailed_address: [\n\t\t\t\t\t\t{ required: true, message: '请输入详细地址', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\timage: [\n\t\t\t\t\t\t{ required: true, validator: validateUpload, trigger: 'change' }\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tmapKey: '',\n\t\t\t\tgrid: {\n\t\t\t\t\txl: 20,\n\t\t\t\t\tlg: 20,\n\t\t\t\t\tmd: 20,\n\t\t\t\t\tsm: 24,\n\t\t\t\t\txs: 24\n\t\t\t\t},\n\t\t\t\tgridPic: {\n\t\t\t\t\txl: 6,\n\t\t\t\t\tlg: 8,\n\t\t\t\t\tmd: 12,\n\t\t\t\t\tsm: 12,\n\t\t\t\t\txs: 12\n\t\t\t\t},\n\t\t\t\tgridBtn: {\n\t\t\t\t\txl: 4,\n\t\t\t\t\tlg: 8,\n\t\t\t\t\tmd: 8,\n\t\t\t\t\tsm: 8,\n\t\t\t\t\txs: 8\n\t\t\t\t},\n\t\t\t\tmodalPic: false,\n\t\t\t\tisChoice: '单选',\n\t\t\t\tpid:0,\n\t\t\t\tisApi:0,\n\t\t\t\tadd:0\n\t\t\t}\n\t\t},\n\t\tcreated () {\n\t\t\tthis.getErpConfig();\n\t\t\tthis.getKey();\n\t\t\t// this.getInfo();\n\t\t\tlet data = {pid:0}\n\t\t\tthis.cityInfo(data);\n\t\t},\n\t\tcomputed: {\n\t\t\t...mapState('admin/layout', [\n\t\t\t\t'isMobile'\n\t\t\t]),\n\t\t\tlabelWidth () {\n\t\t\t\treturn this.isMobile ? undefined : 120;\n\t\t\t},\n\t\t\tlabelPosition () {\n\t\t\t\treturn this.isMobile ? 'top' : 'right';\n\t\t\t}\n\t\t},\n\t\tmounted: function () {},\n\t\tmethods: {\n\t\t\tgetProductId(id){\n\t\t\t\tthis.formItem.erp_shop_id = id;\n\t\t\t\tthis.modalErp = false;\n\t\t\t\tthis.$refs.formItem.validateField(\"erp_shop_id\");\n\t\t\t},\n\t\t\ttapErp(){\n\t\t\t\tthis.$refs.refErp.currentid = this.formItem.erp_shop_id;\n\t\t\t\tthis.modalErp = true;\n\t\t\t\tthis.$refs.formItem.validateField(\"erp_shop_id\");\n\t\t\t},\n\t\t\tgetErpConfig(){\n\t\t\t\terpConfig().then(res=>{\n\t\t\t\t\tthis.openErp = res.data.open_erp;\n\t\t\t\t}).catch(err=>{\n\t\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t\t})\n\t\t\t},\n\t\t\tclearFrom () {\n\t\t\t    this.formItem = {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tstore_account: '',\n\t\t\t\t\tstore_password: \"\",\n\t\t\t\t\timage: '',\n\t\t\t\t\terp_shop_id:0,\n\t\t\t\t\tname: '',\n\t\t\t\t\tintroduction: '',\n\t\t\t\t\tphone: '',\n\t\t\t\t\tis_show: 1,\n\t\t\t\t\tday_time: [],\n\t\t\t\t\tis_store: 0,\n\t\t\t\t\taddress: '',\n\t\t\t\t\tdetailed_address: '',\n\t\t\t\t\tlatitude:'',\n\t\t\t\t\tlongitude:'',\n\t\t\t\t\tprovince:0,\n\t\t\t\t\tcity:0,\n\t\t\t\t\tarea:0,\n\t\t\t\t\tstreet:0,\n\t\t\t\t\taddressSelect:[],\n\t\t\t\t\tvalid_range:0\n\t\t\t\t}\n\t\t\t\tthis.add = 0;\n\t\t\t\tthis.isApi = 0;\n\t\t\t},\n\t\t\tcancel () {\n\t\t\t\tthis.isTemplate = false;\n\t\t\t    // this.$refs['formItem'].resetFields();\n\t\t\t    this.clearFrom();\n\t\t\t},\n\t\t\taddchack(e,selectedData){\n\t\t\t\te.forEach((i,index)=>{\n\t\t\t\t\tif(index==0){\n\t\t\t\t\t\tthis.formItem.province = i\n\t\t\t\t\t}else if(index==1){\n\t\t\t\t\t\tthis.formItem.city = i\n\t\t\t\t\t}else if(index==2){\n\t\t\t\t\t\tthis.formItem.area = i\n\t\t\t\t\t}else {\n\t\t\t\t\t\tthis.formItem.street = i\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.formItem.address = (selectedData.map(o => o.label)).join(\"/\");\n\t\t\t},\n\t\t\tcityInfo(data){\n\t\t\t\tcityApi(data).then(res=>{\n\t\t\t\t\tthis.addresData = res.data\n\t\t\t\t})\n\t\t\t},\n\t\t\tloadData(item, callback) {\n\t\t\t\titem.loading = true;\n\t\t\t\tcityApi({pid:item.value}).then(res=>{\n\t\t\t\t\titem.children = res.data;\n\t\t\t\t\titem.loading = false;\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t},\n\t\t\t// 地图信息获取\n\t\t\tgetCoordinates(data) {\n\t\t\t\tthis.formItem.latitude = data.location.lat || 34.34127\n\t\t\t\tthis.formItem.longitude = data.location.lng || 108.93984\n\t\t\t\tif(this.isApi){\n\t\t\t\t\t// // this.formItem.detailed_address = data.address\n\t\t\t\t\tlet components = data.addressComponents;\n\t\t\t\t\tif(this.formItem.detailed_address.indexOf(components.street) == -1){\n\t\t\t\t\t\tthis.formItem.detailed_address = data.address+(components.town?components.town:'');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 查找位置\n\t\t\tonSearch() {\n\t\t\t\tif(this.$refs.mapChild){\n\t\t\t\t\tthis.$refs.mapChild.searchKeyword(this.formItem.detailed_address)\n\t\t\t\t}\n\t\t\t},\n\t\t\t// key值\n\t\t\tgetKey () {\n\t\t\t\tkeyApi().then(res => {\n\t\t\t\t\tthis.mapKey = res.data.key\n\t\t\t\t}).catch(res => {\n\t\t\t\t\tthis.$Message.error(res.msg)\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 详情\n\t\t\tgetInfo (id) {\n\t\t\t    let that = this;\n\t\t\t    that.formItem.id = id;\n\t\t\t    that.spinShow = true;\n\t\t\t    storeGetInfoApi(id).then(res => {\n\t\t\t\t\tthis.isApi = 1;\n\t\t\t\t\tlet addressSelect = [];\n\t\t\t\t\tthis.formItem = res.data.info;\n\t\t\t\t\tthis.formItem.erp_shop_id = res.data.info.erp_shop_id || 0;\n\t\t\t\t\tlet a = []\n\t\t\t\t\ta.push(res.data.info.day_start)\n\t\t\t\t\ta.push(res.data.info.day_end)\n\t\t\t\t\tthis.formItem.day_time = a\n\t\t\t\t\tif(res.data.info.province){\n\t\t\t\t\t\taddressSelect.push(res.data.info.province)\n\t\t\t\t\t}\n\t\t\t\t\tif(res.data.info.city){\n\t\t\t\t\t\taddressSelect.push(res.data.info.city)\n\t\t\t\t\t}\n\t\t\t\t\tif(res.data.info.area){\n\t\t\t\t\t\taddressSelect.push(res.data.info.area)\n\t\t\t\t\t}\n\t\t\t\t\tif(res.data.info.street){\n\t\t\t\t\t\taddressSelect.push(res.data.info.street)\n\t\t\t\t\t}\n\t\t\t\t\tthis.$set(this.formItem,'valid_range',(this.formItem.valid_range)/1000)\n\t\t\t\t\tthis.formItem.addressSelect = addressSelect;\n\t\t\t\t\tthis.onSearch();\n\t\t\t\t\tthat.spinShow = false;\n\t\t\t\t}).catch(function (res) {\n\t\t\t\t\tthat.spinShow = false;\n\t\t\t\t\tthat.$Message.error(res.msg);\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 选择图片\n\t\t\tmodalPicTap () {\n\t\t\t\tthis.modalPic = true;\n\t\t\t\tthis.$refs.formItem.validateField(\"image\")\n\t\t\t},\n\t\t\t// 选中图片\n\t\t\tgetPic (pc) {\n\t\t\t\tthis.formItem.image = pc.att_dir;\n\t\t\t\tthis.modalPic = false;\n\t\t\t\tthis.$refs.formItem.validateField(\"image\")\n\t\t\t},\n\t\t\t// 营业时间\n\t\t\tonchangeTime (e) {\n\t\t\t\tthis.formItem.day_time = e;\n\t\t\t},\n\t\t\t// 提交\n\t\t\thandleSubmit (name) {\n\t\t\t\tthis.$refs[name].validate((valid) => {\n\t\t\t\t\tif (valid) {\n\t\t\t\t\t\tif(this.formItem.day_time[0] == ''){\n\t\t\t\t\t\t\tthis.formItem.day_time = ['00:00:00', '23:59:59']\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(this.formItem.valid_range == ''||this.formItem.valid_range<0){\n\t\t\t\t\t\t\treturn this.$Message.error('请输入有效的门店范围');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// this.formItem.valid_range = this.formItem.valid_range/1000 \n\t\t\t\t\t\tstoreUpdateApi(this.formItem.id,this.formItem).then(async res => {\n\t\t\t\t\t\t\tthis.$Message.success(res.msg);\n\t\t\t\t\t\t\tthis.isTemplate = false;\n\t\t\t\t\t\t\tthis.$parent.getList();\n\t\t\t\t\t\t\t// this.$refs[name].resetFields();\n\t\t\t\t\t\t\tthis.clearFrom();\n\t\t\t\t\t\t}).catch(res => {\n\t\t\t\t\t\t\tthis.$Message.error(res.msg);\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n",null]}