{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/kefu/mobile/orderList/orderDelivery.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/kefu/mobile/orderList/orderDelivery.vue","mtime":1643074684000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n    import {orderSendApi, orderDetailApi} from '@/api/order';\n    import {orderTemp, orderInfo, orderExport, orderDelivery, getSender, orderDeliveryAll} from '@/api/kefu';\n    import {required, num} from \"@/utils/validate\";\n    import {validatorDefaultCatch} from \"@/libs/dialog\";\n    import vuePickers from 'vue-pickers';\n    export default {\n        name: \"GoodsDeliver\",\n        components: { vuePickers },\n        props: {},\n        data: function () {\n            return {\n                pickerVisible: false, // 快递公司选择\n                types: [\n                    {\n                        type: 1,\n                        title: \"发货\"\n                    },\n                    {\n                        type: 2,\n                        title: \"送货\"\n                    },\n                    {\n                        type: 3,\n                        title: \"无需发货\"\n                    }\n                ],\n                expressType: [\n                    {\n                        title: '手动填写',\n                        key: 1\n                    },\n                    {\n                        title: '电子面单打印',\n                        key: 2\n                    },\n                ],\n                active: 0,\n                activeExpTpe: 0,\n                orderId: \"\",\n                delivery: null,\n                pickData: [],\n                type: \"1\",\n                result: {},\n                expFrom:{\n                    type: 1, // 发货方式\n                    delivery_name: '', //快递公司\n                    delivery_id: '', //快递单号\n                    delivery_code: '', //快递公司编码\n                    express_record_type: 1, // 发货类型\n                    express_temp_id: '', // 电子面单模板\n                    to_name: '',\n                    to_tel: '',\n                    to_addr: '',\n                    sh_delivery_name: '',\n                    sh_delivery_id: '',\n                    sh_delivery_uid: '',\n                    fictitious_content: ''\n                },\n                expTemp: [],\n                pickerVisibleName: false, // 送货人选择\n                pickerVisibleExpTemp: false, //电子面单选择\n                expTempData: [], // 面单数据\n                tempName: '', // 面单名称\n                tempImg: '', //面单图片\n                deliveryList: [], // 送货人数据\n\t\t\t\tproductType:0\n            };\n        },\n        watch: {\n            \"$route.params.orderId\": function (newVal) {\n                let that = this;\n                if (newVal != undefined) {\n                    that.orderId = newVal;\n                    that.getIndex();\n                }\n            }\n        },\n        created() {\n            // import('@/assets/js/media_750')\n        },\n        mounted: function () {\n            this.orderId = this.$route.params.orderId;\n\t\t\tthis.productType = this.$route.query.productType;\n\t\t\tif(this.productType==3){\n\t\t\t\tthis.types.splice(0,2);\n\t\t\t\tthis.active = 2;\n\t\t\t\tthis.expFrom.type = 3;\n\t\t\t}\n            this.getIndex();\n            this.getLogistics();\n        },\n        methods: {\n            // 显示送货人\n            showName(){\n                this.pickerVisibleName = true\n            },\n            // 获取配送人\n            getDelivery(){\n                orderDeliveryAll().then(res=>{\n                    let tdata = []\n                    res.data.map(item => {\n                        tdata.push({\n                            label: item.nickname,\n                            value: item.uid,\n                            phone: item.phone\n                        })\n                    });\n                    this.deliveryList = [tdata];\n                    this.expFrom.sh_delivery_name = tdata[0].label;\n                    this.expFrom.sh_delivery_id = tdata[0].phone;\n                    this.expFrom.sh_delivery_uid = tdata[0].value;\n                    if(this.expFrom.express_record_type === 2) this.getTemp();\n                })\n            },\n            // 选择送货人\n            confirmName(res){\n                this.expFrom.sh_delivery_name = res[0].label;\n                this.expFrom.sh_delivery_id = res[0].phone;\n                this.expFrom.sh_delivery_uid = res[0].value\n            },\n            // 获取订单打印默认配置\n            orderDeliveryInfo(){\n                getSender().then(res=>{\n                    this.expFrom.to_name = res.data.to_name;\n                    this.expFrom.to_tel = res.data.to_tel;\n                    this.expFrom.to_addr = res.data.to_add;\n                })\n            },\n            cancel() {\n               // this.result = 'click cancel result: null'\n            },\n            // 选择发货类型\n            changeExpTpe(item, index) {\n                this.expFrom.express_record_type = item.key;\n                this.activeExpTpe = index;\n                if(item.key === 2){\n                    this.orderDeliveryInfo();\n                    this.getTemp();\n                }else{\n                    this.expTemp = [];\n                }\n                if(index == 1){\n                    this.getLogistics(1);\n                }else{\n                    this.getLogistics('');\n                }\n            },\n            // 快递模板\n            getTemp(){\n                orderTemp({\n                    com: this.expFrom.delivery_code\n                }).then(res=>{\n                    this.expTemp = res.data.data;\n                    let tdata = []\n                    if(this.expTemp.length){\n                        this.expTemp.map(item => {\n                            tdata.push({\n                                label: item.title,\n                                value: item.temp_id,\n                                id: item.id,\n                                pic: item.pic,\n                                code: item.code\n                            })\n                        });\n                        this.expTempData = [tdata];\n                        this.expFrom.express_temp_id = tdata[0].value;\n                        this.tempName = tdata[0].label;\n                        this.tempImg = tdata[0].pic;\n                    }\n\n                })\n            },\n            // 选择电子面单模板\n            confirmExpTemp(res) {\n                this.expFrom.express_temp_id = res[0].value;\n                this.tempName = res[0].label;\n                this.tempImg = res[0].pic\n            },\n            // 选择快递公司\n            confirm(res) {\n                this.expFrom.delivery_name = res[0].label;\n                this.expFrom.delivery_code = res[0].value;\n                if(this.expFrom.express_record_type === 2) this.getTemp();\n            },\n            show() {\n                this.pickerVisible = true\n            },\n            showExpTemp(){\n                this.pickerVisibleExpTemp = true\n            },\n            // 发货方式\n            changeType: function (item, index) {\n                this.active = index;\n                this.expFrom.type = item.type;\n                if(index ===1) this.getDelivery();\n            },\n            getIndex() {\n                orderInfo(this.$route.params.id).then(res => {\n                    this.delivery = res.data;\n                }).catch((error) => {\n                    this.$dialog.error(error.msg);\n                })\n            },\n            getLogistics(status) {\n                orderExport(status ? status : '').then(async res => {\n                    let tdata = []\n                    res.data.map(item => {\n                        tdata.push({\n                            label: item.value,\n                            value: item.code,\n                            id: item.id\n                        })\n                    });\n                    this.pickData = [tdata];\n                    this.expFrom.delivery_name = tdata[0].label;\n                    this.expFrom.delivery_code = tdata[0].value;\n                    if(this.expFrom.express_record_type === 2) this.getTemp();\n                })\n            },\n            async saveInfo() {\n                let that = this,\n                    type = that.type,\n                    // expressId = that.expressId,\n                    // expressCode = that.expressCode,\n                    save = {};\n                // save.id = that.$route.params.id;\n                // save.type = that.expFrom.type;\n                switch (type) {\n                    case \"1\":\n                        if (this.expFrom.type === 1 && !that.expFrom.delivery_name) return that.$dialog.error('请输入快递公司');\n                        if (this.expFrom.type === 1 && this.expFrom.express_record_type === 1 && !that.expFrom.delivery_id) return that.$dialog.error('请输入快递单号');\n                        if (this.expFrom.type === 1 && !that.expFrom.express_temp_id && this.expFrom.express_record_type === 2) return that.$dialog.error('请选择电子面单');\n                        that.setInfo(that.expFrom);\n                        break;\n                    case \"2\":\n                        try {\n                            await this.$validator({\n                                expressId: [required(required.message(\"发货人姓名\"))],\n                                expressCode: [required(required.message(\"发货人电话\"))]\n                            }).validate({expressId, expressCode});\n                        } catch (e) {\n                            return validatorDefaultCatch(e);\n                        }\n                        save.expressId = expressId;\n                        save.expressCode = expressCode;\n                        that.setInfo(save);\n                        break;\n                    case \"3\":\n                        that.setInfo(save);\n                        break;\n                }\n            },\n            setInfo: function (item) {\n                let that = this;\n                orderDelivery(that.$route.params.id,item).then(\n                    res => {\n                        that.$dialog.success('发送货成功');\n                        that.$router.go(-1);\n                    },\n                    error => {\n                        that.$dialog.error(error.msg);\n                    }\n                );\n            }\n        }\n    };\n",null]}