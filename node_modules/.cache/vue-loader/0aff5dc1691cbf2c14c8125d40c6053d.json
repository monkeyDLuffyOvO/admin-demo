{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/cms/article/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/cms/article/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from 'vuex';\nimport { cmsListApi, categoryListApi, relationApi } from '@/api/cms';\nimport relationList from './relation';\nimport { formatDate } from '@/utils/validate';\nimport goodsList from '@/components/goodsList/index';\nexport default {\n    name: 'addArticle',\n    data () {\n        return {\n            modalTitleSs: '',\n            currentTab: '',\n            grid: {\n                xl: 8,\n                lg: 8,\n                md: 12,\n                sm: 24,\n                xs: 24\n            },\n            loading: false,\n            artFrom: {\n                pid: 0,\n                title: '',\n                page: 1,\n                limit: 20\n            },\n            total: 0,\n            columns1: [\n                {\n                    title: 'ID',\n                    key: 'id',\n                    width: 80\n                },\n                {\n                    title: '文章图片',\n                    slot: 'image_inputs',\n                    minWidth: 90\n                },\n                {\n                    title: '文章名称',\n                    slot: 'titles',\n                    minWidth: 130\n                },\n                {\n                    title: '关联商品',\n                    key: 'store_name',\n                    minWidth: 130\n                },\n                // {\n                //     title: '排序',\n                //     key: 'sort',\n                //     minWidth: 60\n                // },\n                {\n                    title: '浏览量',\n                    key: 'visit',\n                    minWidth: 80\n                },\n                {\n                    title: '时间',\n                    key: 'add_time',\n                    sortable: true,\n                    render: (h, params) => {\n                        return h('div',\n                                 formatDate(new Date(Number(params.row.add_time) * 1000), 'yyyy-MM-dd hh:mm')\n                        )\n                    },\n                    minWidth: 120\n                },\n                {\n                    title: '操作',\n                    slot: 'action',\n                    fixed: 'right',\n                    minWidth: 150\n                }\n            ],\n            cmsList: [],\n            treeData: [],\n            list: [],\n            cid: 0, // 移动分类id\n            cmsId: 0,\n            formValidate: {\n                type: 1\n            },\n            rows: {},\n            modal_loading: false,\n            modals: false\n        }\n    },\n    components: {\n        relationList,\n        goodsList\n    },\n    computed: {\n        ...mapState('admin/layout', [\n            'isMobile'\n        ]),\n        labelWidth () {\n            return this.isMobile ? undefined : 96;\n        },\n        labelPosition () {\n            return this.isMobile ? 'top' : 'right';\n        }\n    },\n    mounted () {\n        this.artFrom.pid = this.$route.query.id ? this.$route.query.id : 0;\n        this.getList();\n        this.getClass();\n    },\n    methods: {\n        // 关联成功\n        getProductId (row) {\n            let data = {\n                product_id: row.id\n            };\n            relationApi(data, this.rows.id).then(async res => {\n                this.$Message.success(res.msg);\n                row.id = 0;\n                this.modal_loading = false;\n                this.modals = false;\n                setTimeout(() => {\n                    this.getList();\n                }, 500);\n            }).catch(res => {\n                this.modal_loading = false;\n                this.loading = false;\n                this.$Message.error(res.msg);\n            })\n        },\n        cancel () {\n            this.modals = false;\n        },\n        // 等级列表\n        getList () {\n            this.loading = true;\n            cmsListApi(this.artFrom).then(async res => {\n                let data = res.data\n                this.cmsList = data.list;\n                this.total = data.count;\n                this.loading = false;\n            }).catch(res => {\n                this.loading = false;\n                this.$Message.error(res.msg);\n            })\n        },\n        // 分类\n        getClass () {\n            categoryListApi(this.formValidate).then(async res => {\n                let data = res.data\n                this.treeData = data;\n                let obj = {\n                    id: 0,\n                    title: '全部'\n                }\n                this.treeData.unshift(obj);\n            }).catch(res => {\n                this.$Message.error(res.msg);\n            })\n        },\n        pageChange (index) {\n            this.artFrom.page = index;\n            this.getList();\n        },\n        // 下拉树\n        handleCheckChange (data) {\n            let value = ''\n            let title = ''\n            this.list = []\n            this.artFrom.pid = 0;\n            data.forEach((item, index) => {\n                value += `${item.id},`\n                title += `${item.title},`\n            });\n            value = value.substring(0, value.length - 1)\n            title = title.substring(0, title.length - 1)\n            this.list.push({\n                value,\n                title\n            });\n            this.artFrom.pid = value;\n            this.artFrom.page = 1;\n            this.getList();\n        },\n        // 编辑\n        edit (row) {\n            this.$router.push({ path: '/admin/cms/article/add_article/' + row.id });\n        },\n        // 关联\n        artRelation (row, tit, num) {\n            this.rows = row;\n            if (row.product_id === 0) {\n                this.modals = true;\n            } else {\n                let delfromData = {\n                    title: tit,\n                    num: num,\n                    url: `/cms/cms/unrelation/${row.id}`,\n                    method: 'PUT',\n                    ids: ''\n                }\n                this.$modalSure(delfromData).then((res) => {\n                    this.$Message.success(res.msg);\n                    this.getList()\n                }).catch(res => {\n                    this.$Message.error(res.msg);\n                });\n            }\n        },\n        // 删除\n        del (row, tit, num) {\n            let delfromData = {\n                title: tit,\n                num: num,\n                url: `cms/cms/${row.id}`,\n                method: 'DELETE',\n                ids: ''\n            };\n            this.$modalSure(delfromData).then((res) => {\n                this.$Message.success(res.msg);\n                this.cmsList.splice(num, 1);\n            }).catch(res => {\n                this.$Message.error(res.msg);\n            });\n        },\n        // 表格搜索\n        userSearchs () {\n            this.artFrom.page = 1;\n            this.getList();\n        }\n    }\n}\n",null]}