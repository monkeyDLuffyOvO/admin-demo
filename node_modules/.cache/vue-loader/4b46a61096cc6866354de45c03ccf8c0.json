{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/marketing/lottery/recordingList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/marketing/lottery/recordingList.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from \"vuex\";\nimport { recordList, lotteryRecordDeliver } from \"@/api/lottery\";\nimport { formatDate } from \"@/utils/validate\";\nimport { getExpressData } from \"@/api/order\";\nimport { ruleShip, ruleMark } from \"./formRule/ruleShip\";\nexport default {\n  name: \"lotteryRecordList\",\n  filters: {\n    formatDate(time) {\n      if (time !== 0) {\n        let date = new Date(time * 1000);\n        return formatDate(date, \"yyyy-MM-dd hh:mm\");\n      }\n    },\n  },\n  data() {\n    return {\n      modals: false,\n      shipModel: false,\n      loading: false,\n      locationList: [],\n      shipForm: {\n        id: \"\",\n        deliver_name: \"\",\n        deliver_number: null,\n      },\n      markForm: {\n        id: \"\",\n        mark: \"\",\n      },\n      ruleShip: ruleShip,\n      ruleMark: ruleMark,\n\t  lotteryList:[\n\t\t  { text: \"全部\", val: \"0\" },\n\t\t  { text: \"积分抽取\", val: \"1\" },\n\t\t  { text: \"订单支付\", val: \"3\" },\n\t\t  { text: \"订单评价\", val: \"4\" },\n\t\t  { text: \"关注公众号\", val: \"5\" },\n\t  ],\n      typeList: [\n        { text: \"全部\", val: \"0\" },\n        { text: \"未中奖\", val: \"1\" },\n        { text: \"积分\", val: \"2\" },\n        { text: \"余额\", val: \"3\" },\n        { text: \"红包\", val: \"4\" },\n        { text: \"优惠券\", val: \"5\" },\n        { text: \"商品\", val: \"6\" },\n      ],\n      columns1: [\n        {\n          title: \"ID\",\n          key: \"id\",\n          width: 80,\n        },\n        {\n          title: \"用户信息\",\n          slot: \"user\",\n          minWidth: 90,\n        },\n        {\n          title: \"奖品信息\",\n          slot: \"prize\",\n          minWidth: 130,\n        },\n        {\n          title: \"抽奖时间\",\n          key: \"add_time\",\n          minWidth: 100,\n        },\n        {\n          title: \"收货信息\",\n          slot: \"receive_info\",\n          minWidth: 100,\n        },\n        {\n          title: \"备注\",\n          slot: \"mark\",\n          minWidth: 100,\n        },\n        {\n          title: \"操作\",\n          slot: \"action\",\n          // fixed: \"right\",\n          minWidth: 130,\n        },\n      ],\n      tableList: [],\n      grid: {\n        xl: 6,\n        lg: 10,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      tableFrom: {\n\t\ttype:'',  \n\t\tfactor:'',  \n        keyword: \"\",\n        date: [],\n        page: 1,\n        limit: 15,\n      },\n      total: 0,\n      timeVal: [],\n      modelType: 1,\n      lottery_id: \"\",\n      modelTitle: \"\",\n\t  options: {\n\t    shortcuts: [\n\t      {\n\t        text: \"今天\",\n\t        value() {\n\t          const end = new Date();\n\t          const start = new Date();\n\t          start.setTime(\n\t            new Date(\n\t              new Date().getFullYear(),\n\t              new Date().getMonth(),\n\t              new Date().getDate()\n\t            )\n\t          );\n\t          return [start, end];\n\t        },\n\t      },\n\t      {\n\t        text: \"昨天\",\n\t        value() {\n\t          const end = new Date();\n\t          const start = new Date();\n\t          start.setTime(\n\t            start.setTime(\n\t              new Date(\n\t                new Date().getFullYear(),\n\t                new Date().getMonth(),\n\t                new Date().getDate() - 1\n\t              )\n\t            )\n\t          );\n\t          end.setTime(\n\t            end.setTime(\n\t              new Date(\n\t                new Date().getFullYear(),\n\t                new Date().getMonth(),\n\t                new Date().getDate() - 1\n\t              )\n\t            )\n\t          );\n\t          return [start, end];\n\t        },\n\t      },\n\t      {\n\t        text: \"最近7天\",\n\t        value() {\n\t          const end = new Date();\n\t          const start = new Date();\n\t          start.setTime(\n\t            start.setTime(\n\t              new Date(\n\t                new Date().getFullYear(),\n\t                new Date().getMonth(),\n\t                new Date().getDate() - 6\n\t              )\n\t            )\n\t          );\n\t          return [start, end];\n\t        },\n\t      },\n\t      {\n\t        text: \"最近30天\",\n\t        value() {\n\t          const end = new Date();\n\t          const start = new Date();\n\t          start.setTime(\n\t            start.setTime(\n\t              new Date(\n\t                new Date().getFullYear(),\n\t                new Date().getMonth(),\n\t                new Date().getDate() - 29\n\t              )\n\t            )\n\t          );\n\t          return [start, end];\n\t        },\n\t      },\n\t      {\n\t        text: \"本月\",\n\t        value() {\n\t          const end = new Date();\n\t          const start = new Date();\n\t          start.setTime(\n\t            start.setTime(\n\t              new Date(new Date().getFullYear(), new Date().getMonth(), 1)\n\t            )\n\t          );\n\t          return [start, end];\n\t        },\n\t      },\n\t      {\n\t        text: \"本年\",\n\t        value() {\n\t          const end = new Date();\n\t          const start = new Date();\n\t          start.setTime(\n\t            start.setTime(new Date(new Date().getFullYear(), 0, 1))\n\t          );\n\t          return [start, end];\n\t        },\n\t      },\n\t    ],\n\t  },\n    };\n  },\n  computed: {\n    ...mapState(\"admin/layout\", [\"isMobile\"]),\n    labelWidth() {\n      return this.isMobile ? undefined : 96;\n    },\n    labelPosition() {\n      return this.isMobile ? \"top\" : \"right\";\n    },\n  },\n  created() {\n\tthis.getList();\n    this.getExpressData();\n  },\n  methods: {\n    clear(){\n      this.markForm = {\n        id: \"\",\n        mark: \"\",\n      };\n      this.shipForm = {\n        id: \"\",\n        deliver_name: \"\",\n        deliver_number: null,\n      };\n      this.modelTitle = \"\";\n    },\n    tapMark(row){\n      this.markForm.id = row.id;\n      this.markForm.mark = row.deliver_info.mark;\n      this.modals = true;\n    },\n    closeRemark(){\n      this.modals = false;\n      this.clear();\n    },\n    putRemark(){\n      lotteryRecordDeliver(this.markForm).then(()=>{\n        this.$Message.success(\"操作成功\");\n        this.modals = false;\n        this.getList();\n        this.clear();\n      }).catch(err=>{\n        this.$Message.error(err.msg)\n      })\n    },\n    deliver(row, type) {\n      this.shipForm.id = row.id;\n\t  this.shipForm.deliver_name = '';\n\t  this.shipForm.deliver_number = '';\n      this.modelType = type;\n      this.shipModel = true;\n    },\n    isDeliver(row) {\n      this.shipForm.id = row.id;\n      this.modelType = 1;\n      this.modelTitle = \"配送信息\";\n      this.shipModel = true;\n      this.shipForm.deliver_name = row.deliver_info.deliver_name;\n      this.shipForm.deliver_number = row.deliver_info.deliver_number;\n    },\n    ok(name) {\n      this.$refs[name].validate((valid) => {\n        if(valid){\n          lotteryRecordDeliver(this.shipForm)\n                  .then(() => {\n                    this.$Message.success(\"操作成功\");\n                    this.shipModel = false;\n                    this.getList();\n                    this.clear();\n                    this.$refs[name].resetFields();\n                  })\n                  .catch((err) => {\n                    this.$Message.error(err.msg);\n                  });\n        }\n      });\n    },\n    cancel(name) {\n      this.modelType = 1;\n      this.shipModel = false;\n      this.clear();\n      this.$refs[name].resetFields();\n    },\n    // 物流公司列表\n    getExpressData() {\n      getExpressData('')\n        .then(async (res) => {\n          this.locationList = res.data;\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    // 具体日期\n    onchangeTime(e) {\n      this.timeVal = e;\n      this.tableFrom.data = this.timeVal[0] ? this.timeVal.join(\"-\") : \"\";\n      this.tableFrom.page = 1;\n      this.getList();\n    },\n    // 列表\n    getList() {\n      this.loading = true;\n      recordList(this.tableFrom)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList = data.list;\n          this.total = res.data.count;\n          this.loading = false;\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange(index) {\n      this.tableFrom.page = index;\n      this.getList();\n    },\n    // 表格搜索\n    userSearchs() {\n      this.tableFrom.page = 1;\n      this.getList();\n    },\n  },\n};\n",null]}