{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/app/wechat/card/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/app/wechat/card/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\timport { wechatCardListApi, wechatCardApi} from '@/api/app'\n\timport uploadPictures from \"@/components/uploadPictures\";\n    import { mapMutations } from \"vuex\";\n    export default {\n        name: 'card',\n        components: { uploadPictures },\n        data () {\n\t\t\t var checkPhone = (rule, value, callback) => {\n\t\t\t\t      if (value === '') {\n\t\t\t\t        callback(new Error('请输入电话'));\n\t\t\t\t      } else {\n\t\t\t\t        let regPone = null;\n\t\t\t\t        let mobile = /^1(3|4|5|6|7|8|9)\\d{9}$/; //最新16手机正则\n\t\t\t\t        let tel = /^(0[0-9]{2,3}\\-)([2-9][0-9]{4,7})+(\\-[0-9]{1,4})?$/; //座机\n\t\t\t\t\t\tlet tel2 = /^400-[016789]\\d{1,3}-\\d{1,4}$/; //400电话的正则\n\t\t\t\t        if (value.charAt(0) == 0) {    // charAt查找第一个字符方法，用来判断输入的是座机还是手机号\n\t\t\t\t          regPone = tel;         \n\t\t\t\t        }else if(value.charAt(0) == 4){\n\t\t\t\t\t\t\tregPone = tel2;\n\t\t\t\t\t\t} else {          \n\t\t\t\t          regPone = mobile;\n\t\t\t\t        }\n\t\t\t\t        if (!regPone.test(value)) {\n\t\t\t\t          return callback(\n\t\t\t\t            new Error(\"请填写正确电话\")\n\t\t\t\t          );\n\t\t\t\t        }\n\t\t\t\t        callback();        \n\t\t\t\t      }\n\t\t\t\t    };\n            return {\n\t\t\t\tisChoice: \"\",\n\t\t\t\tmodalPic: false,\n\t\t\t\tlogoPic: false,\n\t\t\t\tgridBtn: {\n\t\t\t\t  xl: 4,\n\t\t\t\t  lg: 8,\n\t\t\t\t  md: 8,\n\t\t\t\t  sm: 8,\n\t\t\t\t  xs: 8,\n\t\t\t\t},\n\t\t\t\tgridPic: {\n\t\t\t\t  xl: 6,\n\t\t\t\t  lg: 8,\n\t\t\t\t  md: 12,\n\t\t\t\t  sm: 12,\n\t\t\t\t  xs: 12,\n\t\t\t\t},\n\t\t\t\ttableIndex: 0,\n\t\t\t\tcolorList: '',\n\t\t\t\tcolors:'',\n\t\t\t\tcolorsname: '',\n\t\t\t\tformValidate: {\n\t\t\t\t\tlogo_url: '',\n\t\t\t\t\tbrand_name: 'CRMEB', // 商户名称\n\t\t\t\t\tselet: 0, //卡券封面切换  0--颜色/1--图片\n\t\t\t\t\tattrs: [{pic:''}],\n\t\t\t\t\ttitle:'', //会员卡标题\n\t\t\t\t\tprerogative: '', //特权说明\n\t\t\t\t\tdescription: '', //介绍\n\t\t\t\t\tservice_phone: '',\n\t\t\t\t\tbackground_pic_url: '',\n\t\t\t\t\tcolor: '',//卡卷颜色\n\t\t\t\t\tcustom_cell: [\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tname: '', //入口名称\n\t\t\t\t\t\t// \ttips: '', //引导语\n\t\t\t\t\t\t// \turl: '' //跳转链接\n\t\t\t\t\t\t// }\n\t\t\t\t\t],\n\t\t\t\t\tcenter_title: '', //按钮描述\n\t\t\t\t\tcenter_url: '', //跳转链接\n\t\t\t\t\tcenter_sub_title: '', //提示语\n\t\t\t\t\tcenter:[\n\t\t\t\t\t\t// center_title: '', //按钮描述\n\t\t\t\t\t\t// center_url: '', //跳转链接\n\t\t\t\t\t\t// center_sub_title: '', //提示语\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\truleValidate: {\n\t\t\t\t\ttitle: [\n\t\t\t\t\t\t{ required: true, message: '会员卡名称不能为空且长度不超过9个占位符', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tprerogative: [\n\t\t\t\t\t\t{ required: true, message: '特权说明不能为空', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tservice_phone: [\n\t\t\t\t\t\t { required: true, validator: checkPhone, trigger: \"blur\" },\n\t\t\t\t\t\t // { pattern: /^1[3456789]\\d{9}$/, message: \"手机号码格式不正确\", trigger: \"blur\" },\n\t\t\t\t\t],\n\t\t\t\t\tbrand_name: [\n\t\t\t\t\t\t{ required: true, message: '商户名称不能为空', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tcenter_url:[\n\t\t\t\t\t\t{ required: true, message: '跳转链接不能为空', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tcenter_sub_title:[\n\t\t\t\t\t\t{ required: true, message: '提示语不能为空', trigger: 'blur' }\n\t\t\t\t\t],\n\t\t\t\t\tcenter_title:[\n\t\t\t\t\t\t{ required: true, message: '按钮描述不能为空', trigger: 'blur' }\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tpic: '',\n\t\t\t\tselecolor: false, //颜色选择框\t\n\t\t\t\tindex:0,\n\t\t\t\tcenterstatus: true, //显示按钮添加\n\t\t\t\t// addentrance: false //自定义入口框\t\n\t\t\t\t\n\t\t\t}\n\t\t},\n\t\tcreated() {\n\t\t},\n\t\tmounted() {\n\t\t\tthis.$nextTick(()=>{\n\t\t\t\tthis.getList()\n\t\t\t})\n            this.setCopyrightShow({ value: false });\n\t\t},\n        destroyed() {\n            this.setCopyrightShow({ value: true });\n        },\n        methods: {\n            ...mapMutations('admin/layout', [\n                'setCopyrightShow'\n            ]),\n\t\t\tgetList(){\n\t\t\t\twechatCardListApi().then(res=>{\n\t\t\t\t\tthis.colorList = res.data.color\n\t\t\t\t\tthis.formValidate = res.data.info\n\t\t\t\t\tthis.$set(this.formValidate,\"selet\",res.data.selet || 0)\n\t\t\t\t\tlet it = res.data.info.color || this.colorList[0].name\n\t\t\t\t\tthis.colors =this.colorList.filter((item) => {\n\t\t\t\t\t\tif(it == item.name){\n\t\t\t\t\t\t\treturn item.value\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tif(res.data.info.center_title != \"\"){\n\t\t\t\t\t\tthis.center_title = false\n\t\t\t\t\t}\n\t\t\t\t\tthis.colorsname = this.colors[0].name\n\t\t\t\t\tthis.colors = this.colors[0].value\n\t\t\t\t\tif(this.colors==\"\"){\n\t\t\t\t\t\tthis.dancolor(this.colorList[0])\n\t\t\t\t\t}\n\t\t\t\t\tif(res.data.selet == 1){\n\t\t\t\t\t\tthis.pic = res.data.info.background_pic_url\n\t\t\t\t\t}\n\t\t\t\t\tif(res.data.selet == 0){\n\t\t\t\t\t\tthis.pic = res.data.info.color\n\t\t\t\t\t}\n\t\t\t\t}).catch(err=>{\n\t\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t\t})\n\t\t\t},\n\t\t\tseletcolor(){\n\t\t\t\tthis.selecolor = !this.selecolor\n\t\t\t},\n\t\t\tdancolor(item){\n\t\t\t\tthis.selecolor = false\n\t\t\t\tthis.colors = item.value\n\t\t\t\tthis.colorsname = item.name\n\t\t\t},\n\t\t\t// 点击上传图片\n\t\t\tmodalPicTap(tit, index) {\n\t\t\t  this.modalPic = true;\n\t\t\t  this.isChoice = tit === \"dan\" ? \"单选\" : \"多选\";\n\t\t\t  this.tableIndex = index;\n\t\t\t},\n\t\t\t// 获取单张图片信息\n\t\t\tgetPic(pc) {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t// this.formValidate.selet = 1\n\t\t\t\t\tthis.pic = pc.att_dir;\n\t\t\t\t\t// this.pic = pc.att_dir;\n\t\t\t\t\tthis.modalPic = false;\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 点击logo图片\n\t\t\tlogoPicTap(tit, index) {\n\t\t\t  this.logoPic = true;\n\t\t\t  this.isChoice = tit === \"dan\" ? \"单选\" : \"多选\";\n\t\t\t  this.tableIndex = index;\n\t\t\t},\n\t\t\t// 获取logo图片信息\n\t\t\tgetlogoPic(pc) {\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.formValidate.logo_url = pc.att_dir;\n\t\t\t\t\tthis.logoPic = false;\n\t\t\t\t})\n\t\t\t},\n\t\t\tcolor(e){\n\t\t\t\tthis.formValidate.selet = e\n\t\t\t},\n\t\t\tadd(){\n\t\t\t\tthis.index ++;\n\t\t\t\t// this.addentrance = true\n\t\t\t\tthis.formValidate.custom_cell.push({\n\t\t\t\t\tname: '',\n\t\t\t\t\ttips: '',\n\t\t\t\t\turl: ''\n\t\t\t\t});\n\t\t\t},\n\t\t\t//按钮添加\n\t\t\taddcenter(){\n\t\t\t\tthis.centerstatus = false\n\t\t\t},\n\t\t\t//按钮取消\n\t\t\tcancelcenter(){\n\t\t\t\tthis.formValidate.center_title= ''\n\t\t\t\tthis.formValidate.center_sub_title= ''\n\t\t\t\tthis.formValidate.center_url= ''\n\t\t\t\tthis.centerstatus = true\n\t\t\t},\n\t\t\thandleRemove(index) {\n\t\t\t\tthis.formValidate.custom_cell.splice(index,1);\n\t\t\t\tthis.index --;\n\t\t\t},\n\t\t\tsubmit() {\n                this.$refs.formValidate.validate((valid) => {\n                    if (valid) {\n\t\t\t\t\t\tif(this.formValidate.selet == 0){\n\t\t\t\t\t\t\tthis.formValidate.color = this.colorsname\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tthis.formValidate.background_pic_url = this.pic\n\t\t\t\t\t\t}\n\t\t\t\t\t\twechatCardApi(this.formValidate).then(res=>{\n\t\t\t\t\t\t\tthis.$Message.success(res.msg);\n\t\t\t\t\t\t\tthis.getList()\n\t\t\t\t\t\t}).catch(err=>{\n\t\t\t\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t\t\t\t})\n                    } else {\n                        this.$Message.error('请完善信息');\n                    }\n                })\n            },\n\t\t}\n    }\n",null]}