{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/components/department/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/components/department/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { workTree } from \"@/api/work\";\nexport default {\n  name: \"Department\",\n  props: {\n    isEdit: {\n      type: Number,\n      default: 0,\n    },\n    activeDepartment: {\n      type: Object,\n      default: () => {\n        return null;\n      },\n    },\n    userList: {\n      type: Array,\n      default: () => {\n        return [];\n      },\n    },\n    // 是否指定成员\n    isAppoint: {\n      type: Boolean,\n      default: false,\n    },\n    // 指定成员数据 与 isAppoint 同时使用\n    appointList: {\n      type: Array,\n      default: () => {\n        return [];\n      },\n    },\n  },\n  data() {\n    return {\n      dialogVisible: false,\n      treeData: [],\n      selectList: {},\n      isShow: false,\n      memberStatus:false,\n      checkUserList: [], // 选中人员列表\n      scrollH: 0,\n      filterText: \"\",\n      openType:\"\",\n      defaultProps: {\n        children: \"children\",\n        label: \"name\",\n      },\n    };\n  },\n  watch: {\n    userList: {\n      handler(nVal, oVal) {\n        this.checkUserList = JSON.parse(JSON.stringify(nVal));\n      },\n      deep: true,\n    },\n    activeDepartment: {\n      handler(nVal, oVal) {\n        if (!nVal) return;\n        this.isShow = false;\n        let tempArr = [];\n        const recursiveFunction = () => {\n          const getStr = (list) => {\n            tempArr = list.map((row, index, arr) => {\n              if (row.children) {\n                if (nVal.hasOwnProperty(row.id)) {\n                  row.isCheck = true;\n                } else {\n                  row.isCheck = false;\n                }\n                getStr(row.children);\n              } else {\n                if (nVal.hasOwnProperty(row.id)) {\n                  row.isCheck = true;\n                } else {\n                  row.isCheck = false;\n                }\n              }\n              return arr;\n            });\n          };\n          getStr(this.treeData);\n        };\n        recursiveFunction();\n        this.$nextTick(() => {\n          this.$set(this, \"treeData\", tempArr[0]);\n          this.isShow = true;\n          this.selectList = nVal;\n        });\n      },\n      deep: true,\n    },\n    filterText(val) {\n      this.$refs.tree.filter(val);\n    },\n    isAppoint: {\n      handler(nVal) {\n\n      },\n      deep: true,\n    },\n  },\n  mounted() {\n    this.getTreeData();\n  },\n  methods: {\n    getTreeData() {\n      workTree().then((res) => {\n        this.isShow = true;\n        this.treeData = res.data;\n        // this.getItemTree(this.treeData)\n      });\n    },\n    handleClick(node, data) {\n      this.isShow = false;\n      this.$set(node, \"isCheck\", true);\n      this.isShow = true;\n      this.$set(this.selectList, node.id, node);\n    },\n    append(node, data) {\n      this.$Message.warning(\"只允许添加成员\");\n      //   if (this.onlyPerson) return this.$message.warning(this.$t('public.waring'))\n      //   if (this.onlyDepartment && Object.keys(this.selectList).length > 0) {\n      //     return this.$message.warning(this.$t('setting.admin.deletetitle4'))\n      //   }\n      //   this.isShow = false\n      //   data.isCheck = false\n      //   data.is_mastart = false\n      //   this.$set(this.selectList, data.id, data)\n      //   this.$nextTick(() => {\n      //     this.isShow = true\n      //     this.$nextTick(() => {\n      //       this.$refs.treeScoll.scroll(0, this.scrollH)\n      //     })\n      //   })\n    },\n    handleDelete(key) {\n      let tempArr = [];\n      this.isShow = false;\n      delete this.selectList[key.id];\n      var recursiveFunction = () => {\n        const getStr = (list) => {\n          tempArr = list.map((row, index, arr) => {\n            if (row.children) {\n              if (row.id === key.id) {\n                row.isCheck = false;\n              }\n              getStr(row.children);\n            } else {\n              if (row.id === key.id) {\n                row.isCheck = false;\n              }\n            }\n            return arr;\n          });\n        };\n        getStr(this.treeData);\n      };\n      recursiveFunction();\n      this.$nextTick(() => {\n        this.$set(this, \"treeData\", tempArr[0]);\n        this.isShow = true;\n      });\n    },\n    // 确认\n    handleConfirm() {\n        let data = this.checkUserList;\n        this.$emit(\"changeMastart\", data,this.openType);\n        this.checkUserList = [];\n    },\n    // 重置树形数据状态\n    reseatData() {\n      this.isShow = false;\n      let tempArr = [];\n      const recursiveFunction = () => {\n        const getStr = (list) => {\n          tempArr = list.map((row, index, arr) => {\n            row.isCheck = false;\n            if (row.children) {\n              row.user.forEach((user) => {\n                user.isCheck = false;\n              });\n              getStr(row.children);\n            } else {\n              row.user.forEach((user) => {\n                user.isCheck = false;\n              });\n            }\n            return arr;\n          });\n        };\n        getStr(this.treeData);\n      };\n      recursiveFunction();\n      this.$nextTick(() => {\n        this.checkUserList = JSON.parse(JSON.stringify(this.userList));\n        this.$set(this, \"treeData\", tempArr[0]);\n        this.isShow = true;\n      });\n    },\n    scroll(e) {\n      this.scrollH = e.target.scrollTop;\n    },\n    // 选中人员\n    checkUser(user) {\n      if (this.checkUserList.length === 0) {\n        this.$set(user, \"isCheck\", true);\n        this.checkUserList.push(user);\n      } else {\n        const status = this.checkUserList.some((el, index) => {\n          return el.userid === user.userid\n        })\n        if (status) {\n          return this.$Message.warning(\"该人员已选择\");\n        } else {\n          this.$set(user, 'isCheck', true)\n          this.checkUserList.push(user)\n        }\n      }\n      this.$nextTick(() => {\n        this.isShow = true;\n        this.$nextTick(() => {\n          this.$refs.treeScoll.scroll(0, this.scrollH);\n        });\n      });\n    },\n    // 删除人员\n    handleDeleteUser(item, index) {\n      this.checkUserList.splice(index, 1);\n      var recursiveFunction = () => {\n        const getStr = list => {\n          list.forEach((row, index, arr) => {\n            row.member.forEach(user => {\n              if (user.id === item.id) {\n                user.isCheck = false\n              }\n            })\n          })\n        }\n        getStr(this.treeData)\n      }\n      recursiveFunction()\n      this.$nextTick(() => {\n        this.isShow = true\n      })\n    },\n    filterNode(value, data, node) {\n      // 如果什么都没填就直接返回\n      if (!value) return true;\n      // 如果传入的value和data中的label相同说明是匹配到了\n      if (data.label.indexOf(value) !== -1) {\n        return true;\n      }\n      // 否则要去判断它是不是选中节点的子节点\n      return this.checkBelongToChooseNode(value, data, node);\n    },\n    checkBelongToChooseNode(value, data, node) {\n      const level = node.level;\n      // 如果传入的节点本身就是一级节点就不用校验了\n      if (level === 1) {\n        return false;\n      }\n      // 先取当前节点的父节点\n      var parentData = node.parent;\n      if (node.data.user.length > 0) {\n        var list = node.data.user.map((val) => {\n          if (val.card.name.indexOf(value) !== -1) {\n            return true;\n          } else {\n            return false;\n          }\n        });\n      }\n      if (list === undefined) {\n        return false;\n      } else {\n        for (let i = 0; i < list.length; i++) {\n          if (list[i] === true) {\n            return true;\n          }\n        }\n      }\n      // 遍历当前节点的父节点\n      var index = 0;\n      while (index < level - 1) {\n        // 如果匹配到直接返回\n        if (parentData.data.label.indexOf(value) !== -1) {\n          return true;\n        }\n        // 否则的话再往上一层做匹配\n        parentData = parentData.parent;\n        index++;\n      }\n      // 没匹配到返回false\n      return false;\n    },\n    getItemTree(data) {\n      data &&\n        data.forEach((item, index) => {\n          if (item.user != undefined && item.user.length > 0) {\n            item.user.forEach((value) => {\n              value.label = value.card.name;\n              value.children = value;\n            });\n          }\n          if (item.children && item.children.length > 0) {\n            this.getItemTree(item.children);\n          }\n        });\n      return data;\n    },\n    searchData(){\n      \n    },\n    handleConcel() {\n      // this.memberStatus = false;\n    },\n  },\n};\n",null]}