{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/notify/smsConfig/components/forgetPassword.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/notify/smsConfig/components/forgetPassword.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Vcode from \"vue-puzzle-vcode\";\nimport { captchaApi, configApi, serveModifyApi, checkCaptchaApi, serveInfoApi} from '@/api/setting';\nexport default {\n    name: 'forgetPassword',\n    props:{\n        isIndex:{\n            type:Boolean,\n            default:false,\n        },\n        psd:{\n            type:Boolean,\n            default:false,\n        }\n    },\n    data () {\n        const validatePhone = (rule, value, callback) => {\n            if (!value) {\n                return callback(new Error('请填写手机号'));\n            } else if (!/^1[3456789]\\d{9}$/.test(value)) {\n                callback(new Error('手机号格式不正确!'));\n            } else {\n                callback();\n            }\n        };\n        var validatePass = (rule, value, callback) => {\n            if (value === '') {\n                callback(new Error('请输入密码'));\n            } else {\n                if(this.current === 1){\n                    if (this.formInline.checkPass !== '') {\n                        this.$refs.formInline.validateField('checkPass');\n                    }\n                    callback();\n                }else{\n                    if(value !== this.formInline.checkPass){\n                        callback(new Error('请输入正确密码!'));\n                    }\n                    callback();\n                }\n            }\n        };\n        var validatePass2 = (rule, value, callback) => {\n            if (value === '') {\n                callback(new Error('请再次输入密码'));\n            } else if (value !== this.formInline.password) {\n                callback(new Error('两次输入密码不一致!'));\n            } else {\n                callback();\n            }\n        };\n        return {\n            cutNUm: '获取验证码',\n            canClick: true,\n            current: 0,\n            formInline: {\n                account: '',\n                phone: '',\n                phone_show: '',\n                verify_code: '',\n                password: '',\n                checkPass: ''\n            },\n            ruleInline: {\n                phone_show: [\n                    { required: true, validator: validatePhone, trigger: 'blur' }\n                ],\n                verify_code: [\n                    { required: true, message: '请输入验证码', trigger: 'blur' }\n                ],\n                password: [\n                    { validator: validatePass, trigger: 'blur' }\n                ],\n                checkPass: [\n                    { validator: validatePass2, trigger: 'blur' }\n                ]\n            },\n            serveInfo:{},\n            isShow: false, // 验证码模态框是否出现\n        }\n    },\n    components:{\n        Vcode\n    },\n    methods: {\n        // 短信验证码\n        cutDown () {\n            if(!this.isIndex){\n                this.formInline.phone = this.formInline.phone_show\n            }\n            if (this.formInline.phone) {\n                this.isShow = true;\n            } else {\n                this.$Message.warning('请填写手机号!');\n            }\n        },\n        handleSubmit1 (name, current) {\n            this.$refs[name].validate((valid) => {\n                if (valid) {\n                    checkCaptchaApi(this.formInline).then(async res => {\n                        this.current = 1;\n                    }).catch(res => {\n                        this.$Message.error(res.msg);\n                    })\n                } else {\n                    return false;\n                }\n            })\n        },\n        handleSubmit2 (name) {\n            this.formInline.account = this.formInline.phone\n            this.$refs[name].validate((valid) => {\n                if (valid) {\n                    serveModifyApi(this.formInline).then(async res => {\n                        this.$Message.success(res.msg);\n                        this.current = 2;\n                    }).catch(res => {\n                        this.$Message.error(res.msg);\n                    })\n                } else {\n                    return false;\n                }\n            })\n        },\n        // 登录\n        handleSubmit (name) {\n            this.$refs[name].validate((valid) => {\n                if (valid) {\n                    configApi({\n                        account: this.formInline.account,\n                        password: this.formInline.password\n                    }).then(async res => {\n                        this.$Message.success('登录成功!');\n                        this.$emit('on-Login');\n                    }).catch(res => {\n                        this.$Message.error(res.msg);\n                    })\n                } else {\n                    return false;\n                }\n            })\n        },\n        returns () {\n            this.current === 0 ? this.$emit('goback') : this.current = 0\n        },\n        onSuccess(){\n            this.isShow = false; // 通过验证后，需要手动隐藏模态框\n            if (!this.canClick) return;\n                this.canClick = false;\n                this.cutNUm = 60;\n                let data = {\n                    phone: this.formInline.phone\n                };\n                captchaApi(data).then(async res => {\n                    this.$Message.success(res.msg);\n                }).catch(res => {\n                    this.$Message.error(res.msg);\n                })\n                let time = setInterval(() => {\n                    this.cutNUm--;\n                    if (this.cutNUm === 0) {\n                        this.cutNUm = '获取验证码';\n                        this.canClick = true;\n                        clearInterval(time)\n                    }\n                }, 1000)\n        },\n        // 用户点击遮罩层，应该关闭模态框\n        onClose(){\n            this.isShow = false;\n        }\n    },\n    mounted() {\n        serveInfoApi().then((res) => {\n            this.formInline.phone = res.data.phone;\n            this.formInline.phone_show = res.data.phone;\n            // this.formInline.phone_show = res.data.phone.replace(/(\\d{3})\\d{4}(\\d{4})/, '$1****$2') || '';\n        }).catch(err=>{\n\n        })\n    },\n}\n",null]}