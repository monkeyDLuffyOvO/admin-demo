{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/agent/agentManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/agent/agentManage.vue","mtime":1663291930000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport cardsData from \"@/components/cards/cards\";\nimport searchFrom from \"@/components/publicSearchFrom\";\nimport { mapState } from \"vuex\";\nimport exportExcel from \"@/utils/newToExcel.js\";\nimport { membershipDataAddApi } from \"@/api/membershipLevel\";\nimport {\n  agentListApi,\n  statisticsApi,\n  lookCodeApi,\n  lookxcxCodeApi,\n  lookh5CodeApi,\n  userAgentApi,\n  agentSpreadApi,\n} from \"@/api/agent\";\nimport promotersList from \"./handle/promotersList\";\nimport customerInfo from \"@/components/customerInfo\";\nimport timeOptions from \"@/utils/timeOptions\";\nexport default {\n  name: \"agentManage\",\n  components: { cardsData, searchFrom, promotersList, customerInfo },\n  data() {\n    return {\n      customerShow: false,\n      promoterShow: false,\n      modals: false,\n      spinShow: false,\n      grid: {\n        xl: 7,\n        lg: 10,\n        md: 12,\n        sm: 24,\n        xs: 24,\n      },\n      options: timeOptions,\n      formValidate: {\n        nickname: \"\",\n        data: \"today\",\n        page: 1,\n        limit: 15,\n      },\n      date: \"all\",\n      total: 0,\n      cardLists: [],\n      loading: false,\n      tableList: [],\n      timeVal: [],\n      columns: [\n        // {\n        //     type: 'selection',\n        //     width: 60,\n        //     align: 'center'\n        // },\n        {\n          title: \"ID\",\n          key: \"uid\",\n          sortable: true,\n          width: 80,\n        },\n        {\n          title: \"头像\",\n          key: \"headimgurl\",\n          minWidth: 60,\n          render: (h, params) => {\n            return h(\"viewer\", [\n              h(\n                \"div\",\n                {\n                  style: {\n                    width: \"36px\",\n                    height: \"36px\",\n                    borderRadius: \"4px\",\n                    cursor: \"pointer\",\n                  },\n                },\n                [\n                  h(\"img\", {\n                    attrs: {\n                      src: params.row.headimgurl\n                        ? params.row.headimgurl\n                        : require(\"../../assets/images/moren.jpg\"),\n                    },\n                    style: {\n                      width: \"100%\",\n                      height: \"100%\",\n                    },\n                  }),\n                ]\n              ),\n            ]);\n          },\n        },\n        {\n          title: \"用户信息\",\n          slot: \"nickname\",\n          minWidth: 120,\n        },\n        {\n          title: \"推广用户数量\",\n          key: \"spread_count\",\n          minWidth: 125,\n        },\n        {\n          title: \"订单数量\",\n          key: \"order_count\",\n          minWidth: 90,\n        },\n        {\n          title: \"订单金额\",\n          key: \"order_price\",\n          minWidth: 120,\n        },\n        {\n          title: \"分销等级\",\n          slot: \"agentLevel\",\n          minWidth: 120,\n        },\n        {\n          title: \"账户佣金\",\n          key: \"brokerage_money\",\n          minWidth: 120,\n        },\n        {\n          title: \"已提现金额\",\n          key: \"extract_count_price\",\n          minWidth: 120,\n        },\n        {\n          title: \"提现次数\",\n          key: \"extract_count_num\",\n          minWidth: 100,\n        },\n        {\n          title: \"未提现金额\",\n          key: \"new_money\",\n          minWidth: 105,\n        },\n        {\n          title: \"上级推广人\",\n          key: \"spread_name\",\n          minWidth: 105,\n        },\n        {\n          title: \"操作\",\n          slot: \"right\",\n          // fixed: \"right\",\n          minWidth: 130,\n        },\n      ],\n      code_src: \"\",\n      code_xcx: \"\",\n      code_h5: \"\",\n      formInline: {\n        uid: 0,\n        spread_uid: 0,\n        image: \"\",\n      },\n    };\n  },\n  computed: {\n    ...mapState(\"admin/layout\", [\"isMobile\"]),\n    labelWidth() {\n      return this.isMobile ? undefined : 96;\n    },\n    labelPosition() {\n      return this.isMobile ? \"top\" : \"right\";\n    },\n  },\n  created() {\n\t\t const end = new Date();\n\t\t    const start = new Date();\n\t\t    start.setTime(\n\t\t      start.setTime(\n\t\t        new Date(\n\t\t          new Date().getFullYear(),\n\t\t          new Date().getMonth(),\n\t\t          new Date().getDate()\n\t\t        )\n\t\t      )\n\t\t    );\n\t\t    this.timeVal = [start, end];\n    this.getList();\n    this.getStatistics();\n  },\n  methods: {\n    // 导出\n    // exports() {\n    //   let formValidate = this.formValidate;\n    //   let data = {\n    //     data: formValidate.data,\n    //     nickname: formValidate.nickname,\n    //   };\n    //   userAgentApi(data)\n    //     .then((res) => {\n    //       location.href = res.data[0];\n    //     })\n    //     .catch((res) => {\n    //       this.$Message.error(res.msg);\n    //     });\n    // },\n    // 提交\n    putSend(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          if (!this.formInline.spread_uid) {\n            return this.$Message.error(\"请上传用户\");\n          }\n          agentSpreadApi(this.formInline)\n                  .then((res) => {\n                    this.promoterShow = false;\n                    this.$Message.success(res.msg);\n                    this.getList();\n                    this.$refs[name].resetFields();\n                  })\n                  .catch((res) => {\n                    this.$Message.error(res.msg);\n                  });\n        }\n      });\n    },\n    // 数据导出；\n    async exports() {\n      let [th, filekey, data] = [[], [], []];\n      let fileName = \"\";\n      let excelData = JSON.parse(JSON.stringify(this.formValidate));\n      excelData.page = 1;\n      for (let i = 0; i < excelData.page + 1; i++) {\n        let lebData = await this.getExcelData(excelData);\n        if (!fileName) fileName = lebData.filename;\n        if (!filekey.length) {\n          filekey = lebData.filekey;\n        }\n        if (!th.length) th = lebData.header;\n        if (lebData.export.length) {\n          data = data.concat(lebData.export);\n          excelData.page++;\n        } else {\n          exportExcel(th, filekey, fileName, data);\n          return;\n        }\n      }\n    },\n    getExcelData(excelData) {\n      return new Promise((resolve, reject) => {\n        userAgentApi(excelData).then((res) => {\n          return resolve(res.data);\n        });\n      });\n    },\n    // 操作\n    changeMenu(row, name, index) {\n      switch (name) {\n        case \"1\":\n          this.promoters(row, \"order\");\n          break;\n        case \"2\":\n          this.spreadQR(row);\n          break;\n        case \"3\":\n          this.$modalForm(\n            membershipDataAddApi({ uid: row.uid }, \"/agent/get_level_form\")\n          ).then(() => this.getList());\n          break;\n        // default:\n        //     this.del(row, '解除【 ' + row.nickname + ' 】的上级推广人', index);\n      }\n    },\n    customer() {\n      this.customerShow = true;\n    },\n    imageObject(e) {\n      this.customerShow = false;\n      this.formInline.spread_uid = e.uid;\n      this.formInline.image = e.image;\n    },\n    // 删除\n    del(row, tit, num) {\n      let delfromData = {\n        title: tit,\n        num: num,\n        url: `agent/stair/delete_spread/${row.uid}`,\n        method: \"PUT\",\n        ids: \"\",\n      };\n      this.$modalSure(delfromData)\n        .then((res) => {\n          this.$Message.success(res.msg);\n          this.getList();\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    edit(row) {\n      this.promoterShow = true;\n      this.formInline.uid = row.uid;\n    },\n    cancel(name) {\n      this.promoterShow = false;\n      this.$refs[name].resetFields();\n    },\n    // 推广人列表 订单\n    promoters(row, tit) {\n      this.$refs.promotersLists.modals = true;\n      this.$refs.promotersLists.getList(row, tit);\n    },\n    // 统计\n    getStatistics() {\n      let data = {\n        nickname: this.formValidate.nickname,\n        data: this.formValidate.data,\n      };\n      statisticsApi(data)\n        .then(async (res) => {\n          let data = res.data;\n          this.cardLists = data.res;\n        })\n        .catch((res) => {\n          this.$Message.error(res.msg);\n        });\n    },\n    // 具体日期\n    onchangeTime(e) {\n      this.timeVal = e;\n\t  this.formValidate.data = this.timeVal[0] ? this.timeVal.join(\"-\") : \"\";\n      this.formValidate.page = 1;\n      if (!e[0]) {\n        this.formValidate.data = \"\";\n      }\n      this.getList();\n      this.getStatistics();\n    },\n    // 选择时间\n    selectChange(tab) {\n      this.formValidate.page = 1;\n      this.formValidate.data = tab;\n      this.timeVal = [];\n      this.getList();\n      this.getStatistics();\n    },\n    // 列表\n    getList() {\n      this.loading = true;\n      agentListApi(this.formValidate)\n        .then(async (res) => {\n          let data = res.data;\n          this.tableList = data.list;\n          this.total = res.data.count;\n          this.loading = false;\n        })\n        .catch((res) => {\n          this.loading = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    pageChange(index) {\n      this.formValidate.page = index;\n      this.getList();\n    },\n    // 表格搜索\n    userSearchs() {\n      this.formValidate.page = 1;\n      this.getList();\n      this.getStatistics();\n    },\n    // 二维码\n    spreadQR(row) {\n      this.modals = true;\n      this.rows = row;\n      // this.getWeChat(row);\n      // this.getXcx(row);\n    },\n    // 公众号推广二维码\n    getWeChat() {\n      this.spinShow = true;\n      let data = {\n        uid: this.rows.uid,\n        action: \"wechant_code\",\n      };\n      lookCodeApi(data)\n        .then(async (res) => {\n          let data = res.data;\n          this.code_src = data.code_src;\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    // 小程序推广二维码\n    getXcx() {\n      this.spinShow = true;\n      let data = {\n        uid: this.rows.uid,\n      };\n      lookxcxCodeApi(data)\n        .then(async (res) => {\n          let data = res.data;\n          this.code_xcx = data.code_src;\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$Message.error(res.msg);\n        });\n    },\n    getH5() {\n      this.spinShow = true;\n      let data = {\n        uid: this.rows.uid,\n      };\n      lookh5CodeApi(data)\n        .then(async (res) => {\n          let data = res.data;\n          this.code_h5 = data.code_src;\n          this.spinShow = false;\n        })\n        .catch((res) => {\n          this.spinShow = false;\n          this.$Message.error(res.msg);\n        });\n    },\n  },\n};\n",null]}