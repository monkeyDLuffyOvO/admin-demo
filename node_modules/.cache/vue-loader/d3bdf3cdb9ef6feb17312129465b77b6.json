{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/store/order/components/orderSend.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/store/order/components/orderSend.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n\tmapState\n} from \"vuex\";\nimport {\n\tgetExpressData,\n\tputDelivery,\n\tsplitDelivery,\n\torderExpressTemp,\n\torderDeliveryList,\n\torderSheetInfo,\n\tsplitCartInfo,\n} from \"@/api/order\";\nexport default {\n\tname: \"orderSend\",\n\tprops: {\n\t\torderId: Number,\n\t\tstatus: Number,\n\t\tpay_type: String,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\torderStatus: 0,\n\t\t\tsplitSwitch: true,\n\t\t\tformItem: {\n\t\t\t\ttype: \"1\",\n\t\t\t\texpress_record_type: \"1\",\n\t\t\t\tdelivery_name: \"\",\n\t\t\t\tdelivery_id: \"\",\n\t\t\t\texpress_temp_id: \"\",\n\t\t\t\tto_name: \"\",\n\t\t\t\tto_tel: \"\",\n\t\t\t\tto_addr: \"\",\n\t\t\t\tsh_delivery: \"\",\n\t\t\t\tfictitious_content: \"\",\n\t\t\t},\n\t\t\tmodals: false,\n\t\t\texpress: [],\n\t\t\texpressTemp: [],\n\t\t\tdeliveryList: [],\n\t\t\ttemp: {},\n\t\t\texport_open: true,\n\t\t\tmanyFormValidate: [],\n\t\t\theader: [{\n\t\t\t\t\ttype: \"selection\",\n\t\t\t\t\twidth: 60,\n\t\t\t\t\talign: \"center\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: \"商品信息\",\n\t\t\t\t\tslot: \"image\",\n\t\t\t\t\twidth: 200,\n\t\t\t\t\talign: \"center\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: \"规格\",\n\t\t\t\t\tslot: \"value\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tminWidth: 120,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: \"价格\",\n\t\t\t\t\tslot: \"price\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tminWidth: 120,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: \"总数\",\n\t\t\t\t\tkey: \"cart_num\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tminWidth: 120,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: \"待发数量\",\n\t\t\t\t\tkey: \"surplus_num\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\twidth: 180,\n\t\t\t\t\trender: (h, params) => {\n\t\t\t\t\t\treturn h(\"div\", [\n\t\t\t\t\t\t\th(\"InputNumber\", {\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t\t\t\t\tmax: params.row.surplus_num,\n\t\t\t\t\t\t\t\t\tvalue: params.row.surplus_num,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\"on-change\": (e) => {\n\t\t\t\t\t\t\t\t\t\tparams.row.surplus_num = e || 1;\n\t\t\t\t\t\t\t\t\t\tthis.manyFormValidate[params.index] = params.row;\n\t\t\t\t\t\t\t\t\t\tthis.selectData.forEach((v, index) => {\n\t\t\t\t\t\t\t\t\t\t\tif (v.cart_id === params.row.cart_id) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.selectData.splice(index, 1, params\n\t\t\t\t\t\t\t\t\t\t\t\t\t.row);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tselectData: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapState(\"admin/order\", [\n\t\t\t\"splitOrder\",\n\t\t])\n\t},\n\tmethods: {\n\t\tselectOne(data) {\n\t\t\tthis.selectData = data;\n\t\t},\n\t\tchangeModal(status) {\n\t\t\tif (!status) {\n\t\t\t\tthis.cancel();\n\t\t\t}\n\t\t},\n\t\tchangeSplitStatus(status) {\n\t\t\tif (status) {\n\t\t\t\tsplitCartInfo(this.orderId).then((res) => {\n\t\t\t\t\tthis.manyFormValidate = res.data;\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tchangeRadio(o) {\n\t\t\tthis.$refs.formItem.resetFields();\n\t\t\tswitch (o) {\n\t\t\t\tcase \"1\":\n\t\t\t\t\tthis.formItem.delivery_name = \"\";\n\t\t\t\t\tthis.formItem.delivery_id = \"\";\n\t\t\t\t\tthis.formItem.express_temp_id = \"\";\n\t\t\t\t\tthis.formItem.express_record_type = \"1\";\n\t\t\t\t\tthis.expressTemp = [];\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"2\":\n\t\t\t\t\tthis.formItem.sh_delivery = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"3\":\n\t\t\t\t\tthis.formItem.fictitious_content = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tchangeExpress(j) {\n\t\t\tswitch (j) {\n\t\t\t\tcase \"2\":\n\t\t\t\t\tthis.formItem.delivery_name = \"\";\n\t\t\t\t\tthis.formItem.express_temp_id = \"\";\n\t\t\t\t\tthis.expressTemp = [];\n\t\t\t\t\tthis.getList(2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"1\":\n\t\t\t\t\tthis.formItem.delivery_name = \"\";\n\t\t\t\t\tthis.formItem.delivery_id = \"\";\n\t\t\t\t\tthis.getList(1);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\treset() {\n\t\t\tthis.formItem = {\n\t\t\t\ttype: \"1\",\n\t\t\t\texpress_record_type: \"1\",\n\t\t\t\tdelivery_name: \"\",\n\t\t\t\tdelivery_id: \"\",\n\t\t\t\texpress_temp_id: \"\",\n\t\t\t\texpressTemp: [],\n\t\t\t\tto_name: \"\",\n\t\t\t\tto_tel: \"\",\n\t\t\t\tto_addr: \"\",\n\t\t\t\tsh_delivery: \"\",\n\t\t\t\tfictitious_content: \"\",\n\t\t\t};\n\t\t},\n\t\t// 物流公司列表\n\t\tgetList(type) {\n\t\t\tlet status = type === 2 ? 1 : \"\";\n\t\t\tgetExpressData(status)\n\t\t\t\t.then(async (res) => {\n\t\t\t\t\tthis.express = res.data;\n\t\t\t\t\tthis.getSheetInfo();\n\t\t\t\t})\n\t\t\t\t.catch((res) => {\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t\tthis.$Message.error(res.msg);\n\t\t\t\t});\n\t\t},\n\t\t// 提交\n\t\tputSend(name) {\n\t\t\tlet data = {\n\t\t\t\tid: this.orderId,\n\t\t\t\tdatas: this.formItem,\n\t\t\t};\n\t\t\tif (\n\t\t\t\tthis.formItem.type === \"1\" &&\n\t\t\t\tthis.formItem.express_record_type === \"2\"\n\t\t\t) {\n\t\t\t\tif (this.formItem.delivery_name === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"快递公司不能为空\");\n\t\t\t\t} else if (this.formItem.express_temp_id === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"电子面单不能为空\");\n\t\t\t\t} else if (this.formItem.to_name === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"寄件人姓名不能为空\");\n\t\t\t\t} else if (this.formItem.to_tel === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"寄件人电话不能为空\");\n\t\t\t\t} else if (!/^1(3|4|5|7|8|9|6)\\d{9}$/i.test(this.formItem.to_tel)) {\n\t\t\t\t\treturn this.$Message.error(\"请输入正确的手机号码\");\n\t\t\t\t} else if (this.formItem.to_addr === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"寄件人地址不能为空\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (\n\t\t\t\tthis.formItem.type === \"1\" &&\n\t\t\t\tthis.formItem.express_record_type === \"1\"\n\t\t\t) {\n\t\t\t\tif (this.formItem.delivery_name === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"快递公司不能为空\");\n\t\t\t\t} else if (this.formItem.delivery_id === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"快递单号不能为空\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.formItem.type === \"2\") {\n\t\t\t\tif (this.formItem.sh_delivery === \"\") {\n\t\t\t\t\treturn this.$Message.error(\"送货人不能为空\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.splitSwitch) {\n\t\t\t\tdata.datas.cart_ids = [];\n\t\t\t\tthis.selectData.forEach((v) => {\n\t\t\t\t\tdata.datas.cart_ids.push({\n\t\t\t\t\t\tcart_id: v.cart_id,\n\t\t\t\t\t\tcart_num: v.surplus_num,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tsplitDelivery(data)\n\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\tthis.modals = false;\n\t\t\t\t\t\tthis.$Message.success(res.msg);\n\t\t\t\t\t\tthis.$emit(\"submitFail\");\n\t\t\t\t\t\tthis.reset();\n\t\t\t\t\t\tthis.splitSwitch = false;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((res) => {\n\t\t\t\t\t\tthis.$Message.error(res.msg);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tputDelivery(data)\n\t\t\t\t\t.then(async (res) => {\n\t\t\t\t\t\tthis.modals = false;\n\t\t\t\t\t\tthis.$Message.success(res.msg);\n\t\t\t\t\t\tthis.splitSwitch = false;\n\t\t\t\t\t\tthis.$emit(\"submitFail\");\n\t\t\t\t\t\tthis.reset();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((res) => {\n\t\t\t\t\t\tthis.$Message.error(res.msg);\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcancel(name) {\n\t\t\tthis.modals = false;\n\t\t\tthis.orderStatus = 0;\n\t\t\tthis.splitSwitch = false;\n\t\t\tthis.selectData = [];\n\t\t\tthis.reset();\n\t\t},\n\t\t// 电子面单列表\n\t\texpressChange(value) {\n\t\t\tlet expressItem = this.express.find((item) => {\n\t\t\t\treturn item.value === value;\n\t\t\t});\n\t\t\tif (expressItem === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.formItem.delivery_code = expressItem.code;\n\t\t\tif (this.formItem.express_record_type === \"2\") {\n\t\t\t\tthis.expressTemp = [];\n\t\t\t\tthis.formItem.express_temp_id = \"\";\n\t\t\t\torderExpressTemp({\n\t\t\t\t\t\tcom: this.formItem.delivery_code,\n\t\t\t\t\t})\n\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\tthis.expressTemp = res.data;\n\t\t\t\t\t\tif (!res.data.length) {\n\t\t\t\t\t\t\tthis.$Message.error(\"请配置你所选快递公司的电子面单\");\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tgetCartInfo(data, orderid) {\n\t\t\tthis.$set(this, \"orderStatus\", data);\n\t\t\tthis.$set(this, \"splitSwitch\", data === 8 ? true : false);\n\t\t\tsplitCartInfo(this.orderId).then((res) => {\n\t\t\t\tthis.manyFormValidate = res.data;\n\t\t\t});\n\t\t},\n\t\tgetDeliveryList() {\n\t\t\torderDeliveryList()\n\t\t\t\t.then((res) => {\n\t\t\t\t\tthis.deliveryList = res.data.list;\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t\t});\n\t\t},\n\t\tgetSheetInfo() {\n\t\t\torderSheetInfo()\n\t\t\t\t.then((res) => {\n\t\t\t\t\tconst data = res.data;\n\t\t\t\t\tfor (const key in data) {\n\t\t\t\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tthis.formItem[key] = data[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.export_open =\n\t\t\t\t\t\tdata.export_open === undefined ? true : data.export_open;\n\t\t\t\t\tif (!this.export_open) {\n\t\t\t\t\t\tthis.formItem.express_record_type = \"1\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.formItem.to_addr = data.to_add;\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tthis.$Message.error(err.msg);\n\t\t\t\t});\n\t\t},\n\t\tshDeliveryChange(value) {\n\t\t\tif (!value) return;\n\t\t\tlet deliveryItem = this.deliveryList.find((item) => {\n\t\t\t\treturn item.id === value;\n\t\t\t});\n\t\t\tthis.formItem.sh_delivery_name = deliveryItem.wx_name;\n\t\t\tthis.formItem.sh_delivery_id = deliveryItem.phone;\n\t\t\tthis.formItem.sh_delivery_uid = deliveryItem.uid;\n\t\t},\n\t\texpressTempChange(tempId) {\n\t\t\tthis.temp = this.expressTemp.find((item) => {\n\t\t\t\treturn tempId === item.temp_id;\n\t\t\t});\n\t\t\tif (this.temp === undefined) {\n\t\t\t\tthis.temp = {};\n\t\t\t}\n\t\t},\n\t\tpreview() {\n\t\t\tthis.$refs.viewer.$viewer.show();\n\t\t},\n\t},\n};\n",null]}