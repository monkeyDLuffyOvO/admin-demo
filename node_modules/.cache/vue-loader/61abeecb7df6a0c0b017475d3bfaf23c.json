{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/app/wechat/newsCategory/save.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/app/wechat/newsCategory/save.vue","mtime":1655777970000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n    import { mapState, mapActions } from 'vuex';\n    import WangEditor from \"@/components/wangEditor/index.vue\";\n    import uploadPictures from '@/components/uploadPictures';\n    import { wechatNewsAddApi, wechatNewsInfotApi } from '@/api/app';\n    export default {\n        name: 'newsCategorySave',\n        components: { uploadPictures, WangEditor },\n        watch: {\n            $route (to, from) {\n                if (this.$route.params.id !== '0') {\n                    this.info();\n                } else {\n                    this.list = [\n                        {\n                            title: '',\n                            author: '',\n                            synopsis: '',\n                            image_input: '',\n                            content: '',\n                            id: 0\n                        }\n                    ];\n                    this.saveForm = this.list[this.current];\n                }\n            }\n        },\n        data () {\n            const validateUpload = (rule, value, callback) => {\n                if (this.saveForm.image_input) {\n                    callback()\n                } else {\n                    callback(new Error('请上传图文封面'))\n                }\n            }\n            return {\n                val:'',\n                myConfig: {\n                    autoHeightEnabled: false, // 编辑器不自动被内容撑高\n                    initialFrameHeight: 500, // 初始容器高度\n                    initialFrameWidth: '100%', // 初始容器宽度\n                    UEDITOR_HOME_URL: '/admin/UEditor/',\n                    serverUrl: ''\n                },\n                ruleValidate: {\n                    title: [\n                        { required: true, message: '请输入标题', trigger: 'blur' }\n                    ],\n                    author: [\n                        { required: true, message: '请输入作者', trigger: 'blur' }\n                    ],\n                    image_input: [\n                        { required: true, validator: validateUpload, trigger: 'change' }\n                    ],\n                    content: [\n                        { required: true, message: '请输入正文', trigger: 'change' }\n                    ],\n                    synopsis: [\n                        { required: true, message: '请输入文章摘要', trigger: 'blur' }\n                    ]\n                },\n                isChoice: '单选',\n                dragging: null,\n                isDel: false,\n                msg: '',\n                count: [],\n                baseImg: require('../../../../assets/images/bjt.png'),\n                saveForm: {\n                    title: '',\n                    author: '',\n                    synopsis: '',\n                    image_input: '',\n                    content: '',\n                    id: 0\n                },\n                current: 0,\n                list: [\n                    {\n                        title: '',\n                        author: '',\n                        synopsis: '',\n                        image_input: '',\n                        content: '',\n                        id: 0\n                    }\n                ],\n                uploadList: [],\n                modalPic: false,\n                gridPic: {\n                    xl: 6,\n                    lg: 8,\n                    md: 12,\n                    sm: 12,\n                    xs: 12\n                },\n                gridBtn: {\n                    xl: 4,\n                    lg: 8,\n                    md: 8,\n                    sm: 8,\n                    xs: 8\n                }\n            }\n        },\n        computed: {\n            ...mapState('admin/layout', [\n                'isMobile'\n            ]),\n            labelWidth () {\n                return this.isMobile ? undefined : 120;\n            },\n            labelPosition () {\n                return this.isMobile ? 'top' : 'right';\n            }\n        },\n        mounted () {\n            if (this.$route.params.id !== '0') {\n                this.info();\n            } else {\n                this.saveForm = this.list[this.current];\n            }\n        },\n        methods: {\n            ...mapActions('admin/page', [\n                'close'\n            ]),\n\t\t\tgetEditorContent(data) {\n\t\t\t  this.saveForm.content = data;\n\t\t\t},\n            // 添加自定义弹窗\n            addCustomDialog (editorId) {\n                window.UE.registerUI('test-dialog', function (editor, uiName) {\n                    let dialog = new window.UE.ui.Dialog({\n                        iframeUrl: '/admin/widget.images/index.html?fodder=dialog',\n                        editor: editor,\n                        name: uiName,\n                        title: '上传图片',\n                        cssRules: 'width:1200px;height:500px;padding:20px;'\n                    });\n                    this.dialog = dialog;\n                    // 参考上面的自定义按钮\n                    var btn = new window.UE.ui.Button({\n                        name: 'dialog-button',\n                        title: '上传图片',\n                        cssRules: `background-image: url(../../../assets/images/icons.png);background-position: -726px -77px;`,\n                        onclick: function () {\n                            // 渲染dialog\n                            dialog.render();\n                            dialog.open();\n                        }\n                    });\n\n                    return btn;\n                }, 37);\n            },\n            // 点击图文封面\n            modalPicTap () {\n                this.modalPic = true;\n            },\n            // 获取图片信息\n            getPic (pc) {\n                this.saveForm.image_input = pc.att_dir;\n                this.modalPic = false;\n            },\n            // 添加图文按钮\n            handleAdd () {\n                if (!this.check()) return false;\n                let obj = {\n                    'title': '',\n                    'author': '',\n                    'synopsis': '',\n                    'image_input': '',\n                    'content': '',\n                    'id': 0\n                }\n                this.list.push(obj);\n            },\n            // 点击模块\n            onSubSave (i) {\n                this.current = i;\n                this.list.map((item, index) => {\n                    /* eslint-disable */\n                    if (index === this.current) return this.saveForm = this.list[this.current];\n                })\n            },\n            // 删除\n            del (i) {\n                if (i === 0) {\n                    this.$Message.warning('不能再删除了');\n                } else {\n                    this.list.splice(i, 1);\n                    this.saveForm = {};\n                }\n            },\n            // 详情\n            info () {\n                wechatNewsInfotApi(this.$route.params.id).then(async res => {\n                    let info = res.data.info;\n                    this.list = info.new;\n                    this.val = this.list[this.current].content;\n                    this.saveForm = this.list[this.current];\n                }).catch(res => {\n                    this.$Message.error(res.msg);\n                })\n            },\n            // 提交数据\n            subFrom (name) {\n                this.$refs[name].validate((valid) => {\n                    if (valid) {\n                        let data = {\n                            id:this.$route.params.id || 0,\n                            list:this.list\n                        }\n                        wechatNewsAddApi(data).then(async res => {\n                            this.$Message.success(res.msg);\n                            setTimeout(() => {\n                                this.$router.push({ path: '/admin/app/wechat/news_category/index' });\n                            }, 500);\n\n                        }).catch(res => {\n                            this.$Message.error(res.msg);\n                        })\n                    } else {\n                        return false;\n                    }\n                })\n            },\n            check () {\n                for (let index in this.list){\n                    if(!this.list[index].title){\n                        this.$Message.warning('请输入文章的标题');\n                        return false;\n                    }\n                    else if(!this.list[index].author){\n                        this.$Message.warning('请输入文章的作者');\n                        return false;\n                    }\n                    else if(!this.list[index].synopsis){\n                        this.$Message.warning('请输入文章的摘要');\n                        return false;\n                    }\n                    else if(!this.list[index].image_input){\n                        this.$Message.warning('请输入文章的图文封面');\n                        return false;\n                    }\n                    else if(!this.list[index].content){\n                        this.$Message.warning('请输入文章的内容');\n                        return false;\n                    }else{\n                        return true\n                    }\n                }\n                // if(!this.saveForm.title){\n                //     this.$Message.warning('请输入文章的标题');\n                //     return false;\n                // }\n                // else if(!this.saveForm.author){\n                //     this.$Message.warning('请输入文章的作者');\n                //     return false;\n                // }\n                // else if(!this.saveForm.synopsis){\n                //     this.$Message.warning('请输入文章的摘要');\n                //     return false;\n                // }\n                // else if(!this.saveForm.image_input){\n                //     this.$Message.warning('请输入文章的图文封面');\n                //     return false;\n                // }\n                // else if(!this.saveForm.content){\n                //     this.$Message.warning('请输入文章的内容');\n                //     return false;\n                // }else{\n                //     return true\n                // }\n\n            }\n        }\n    }\n",null]}