{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/kefu/pc/components/rightMenu.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/kefu/pc/components/rightMenu.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport delivery from \"./delivery\";\nimport remarks from \"./remarks\";\nimport userLabel from \"./userLabel\";\nimport {\n  userInfo,\n  getorderList,\n  orderEdit,\n  orderRecord,\n  productCart,\n  productHot,\n  productVisit,\n  userGroupApi,\n  putGroupApi,\n  getRefundOrderFrom,\n} from \"@/api/kefu\";\nimport { erpConfig } from \"@/api/erp\";\nimport empty from \"../../components/empty\";\nimport dayjs from \"dayjs\";\nexport default {\n  name: \"rightMenu\",\n  components: {\n    delivery,\n    remarks,\n    userLabel,\n    empty,\n  },\n  props: {\n    isTourist: {\n      type: String | Number,\n      default: 0,\n    },\n    status: {\n      type: String | Number,\n      default: \"\",\n    },\n    //用户uid\n    uid: {\n      type: String | Number,\n      default: \"\",\n    },\n    webType: {\n      type: String | Number,\n      default: \"\",\n    },\n    exportOpen: {\n      type: String,\n      default: \"0\",\n    },\n  },\n  filters: {\n    statusFilters: function (value) {\n      const statusMap = {\n        \"-1\": \"申请退款\",\n        \"-2\": \"退货成功\",\n        0: \"待发货\",\n        1: \"待收货\",\n        2: \"已收货\",\n        3: \"待评价\",\n        \"-1\": \"已退款\",\n      };\n      return statusMap[value];\n    },\n    getDay(val) {\n      if (val) {\n        return dayjs.unix(val).format(\"YYYY年M月D日\");\n      }\n    },\n    typeFilters(value) {\n      const statusMap = {\n        h5: \"H5\",\n        wechat: \"公众号\",\n        routine: \"小程序\",\n        pc: \"PC\",\n      };\n      return statusMap[value];\n    },\n  },\n  data() {\n    return {\n\t  openErp:false,\n      userGroup: [],\n      model1: \"\",\n      curMenuIndex: 0,\n      menuList: [\n        {\n          key: \"\",\n          title: \"全部\",\n        },\n        {\n          key: 0,\n          title: \"未支付\",\n        },\n        {\n          key: 1,\n          title: \"未发货\",\n        },\n        {\n          key: -1,\n          title: \"退款中\",\n        },\n      ],\n      activeUserInfo: \"\", //用户详情\n      curStatus: this.status,\n      limit: 10,\n      orderConfig: {\n        page: 1,\n        type: \"\",\n        searchTxt: \"\",\n      },\n      orderList: [],\n      isOrderScroll: true,\n      isOrderHidden: true,\n      isDelivery: false, // 发货弹窗\n      isRemarks: false, // 备注弹窗\n      goodsTab: [\n        {\n          key: 0,\n          title: \"购买\",\n        },\n        {\n          key: 1,\n          title: \"足迹\",\n        },\n        {\n          key: 2,\n          title: \"热销\",\n        },\n      ],\n      goodsConfig: {\n        type: 0,\n        buyList: [],\n      },\n      isUserLabel: false,\n      remarkId: \"\",\n      itemId: 0,\n      remarkTitle: \"\",\n      orderId: \"\",\n      orderType: \"\",\n      storeName: \"\",\n    };\n  },\n  watch: {\n    uid(nVal, oVal) {\n      if (nVal != oVal && this.isTourist == 0 && nVal) {\n        this.orderConfig.page = 1;\n        this.isOrderScroll = true;\n        this.orderList = [];\n        Promise.all[\n          (this.getUserInfo(),\n          this.getOrderList(),\n          this.productCart(),\n          this.getUserGroup())\n        ];\n        if (this.goodsConfig.type == 0) {\n          this.productCart();\n        } else if (this.goodsConfig.type == 1) {\n          this.productVisit();\n        } else {\n          this.productHot();\n        }\n      } else {\n        this.orderConfig.page = 1;\n        this.isOrderScroll = true;\n        this.orderList = [];\n        this.activeUserInfo = \"\";\n      }\n    },\n    isTourist(nVal, oVal) {\n      if (nVal == 1) {\n        this.activeUserInfo = \"\";\n        this.orderList = [];\n        this.goodsConfig.buyList = [];\n      }\n    },\n  },\n  mounted() {\n    let self = this;\n\tthis.getErpConfig();\n    this.bus.$on(\"selectRightMenu\", (arg) => {\n      this.curStatus = arg;\n    });\n    if (this.uid && this.isTourist == 0)\n      Promise.all[\n        (this.getUserInfo(),\n        this.getOrderList(),\n        this.productCart(),\n        this.getUserGroup())\n      ];\n  },\n  methods: {\n\tgetErpConfig(){\n\t\terpConfig().then(res=>{\n\t\t\tthis.openErp = res.data.open_erp;\n\t\t}).catch(err=>{\n\t\t\tthis.$Message.error(err.msg);\n\t\t})\n\t},  \n    // 设置分组\n    onChange(e) {\n      if (e) {\n        putGroupApi(this.uid, e).then((res) => {\n          this.$Message.success(res.msg);\n        });\n      }\n    },\n    //获取分组\n    getUserGroup() {\n      userGroupApi().then((res) => {\n        this.userGroup = res.data;\n      });\n    },\n    // 订单发货\n    openDelivery(item) {\n      if (item.refund.length) return this.$Message.warning(\"存在售后待处理订单\");\n      this.$store.commit(\"admin/order/setSplitOrder\", item.total_num);\n      this.orderId = item.id;\n      this.orderType = item._status._type;\n      this.isDelivery = true;\n    },\n    // 订单发货成功\n    deliveryOk() {\n      this.orderConfig.page = 1;\n      this.isOrderScroll = true;\n      this.orderList = [];\n      this.getOrderList();\n      this.isDelivery = false;\n    },\n    // 订单备注\n    bindRemark(item) {\n      this.remarkTitle = item.remark;\n      this.remarkId = item.order_id;\n      this.itemId = item.id;\n      this.isRemarks = true;\n    },\n    remarkSuccess() {\n      this.remarkId = \"\";\n      this.isRemarks = false;\n      this.orderConfig.page = 1;\n      this.orderList = [];\n      this.isOrderScroll = true;\n      this.getOrderList();\n    },\n    //获取左侧用户列表用户详情\n    getUserInfo() {\n      userInfo(this.uid)\n        .then((res) => {\n          this.activeUserInfo = res.data;\n        })\n        .catch((error) => {\n          this.activeUserInfo = \"\";\n        });\n    },\n    // 获取订单列表\n    getOrderList() {\n      if (!this.isOrderScroll) return;\n      getorderList(this.uid, {\n        page: this.orderConfig.page,\n        limit: this.limit,\n        type: this.orderConfig.type,\n        search: this.orderConfig.searchTxt,\n      }).then((res) => {\n        this.orderConfig.page += 1;\n        this.isOrderScroll = res.data.length >= this.limit;\n        this.orderList = this.orderList.concat(res.data);\n      });\n    },\n    // 订单tab\n    bindTab(item) {\n      if (this.orderConfig.type === item.key) return;\n      this.orderConfig.type = item.key;\n      if (this.uid) {\n        this.orderConfig.page = 1;\n        this.isOrderScroll = true;\n        this.orderList = [];\n        this.getOrderList();\n      }\n    },\n    // 订单回车\n    orderSearch() {\n      this.isOrderScroll = true;\n      this.orderList = [];\n      this.orderConfig.page = 1;\n      this.getOrderList();\n    },\n    // 关闭发货模态框\n    deliveryClose() {\n      this.isUserLabel = false;\n      this.isDelivery = false;\n      this.isRemarks = false;\n    },\n    // 订单改价\n    orderEdit(id) {\n      this.$modalForm(orderEdit(id)).then(() => this.getOrderList());\n    },\n    // 订单退款\n    orderRecord(id) {\n      this.$modalForm(\n        (this.orderConfig.type == -1 ? getRefundOrderFrom : orderRecord)(id)\n      ).then(()=>{\n\t\t  this.orderList = [];\n\t\t  this.orderConfig.page = 1;\n\t\t  this.getOrderList()\n\t  });\n    },\n    // 订单加载更多\n    orderReachBottom() {\n      this.getOrderList();\n    },\n    // 商品信息tab\n    bindGoodsTab(item) {\n      if (this.goodsConfig.type == item.key) return;\n      this.goodsConfig.type = item.key;\n      if (this.uid == \"\") return;\n      if (item.key == 0) {\n        this.productCart();\n      } else if (item.key == 1) {\n        this.productVisit();\n      } else {\n        this.productHot();\n      }\n    },\n    // 商品购买记录\n    productCart() {\n      productCart(this.uid, {\n        store_name: this.storeName,\n      }).then((res) => {\n        this.goodsConfig.buyList = res.data;\n      });\n    },\n    // 商品足迹\n    productVisit() {\n      productVisit(this.uid, {\n        store_name: this.storeName,\n      }).then((res) => {\n        this.goodsConfig.buyList = res.data;\n      });\n    },\n    // 热销商品\n    productHot() {\n      productHot(this.uid, {\n        store_name: this.storeName,\n      }).then((res) => {\n        this.goodsConfig.buyList = res.data;\n      });\n    },\n    // 修改用户标签\n    editLabel() {\n      this.isUserLabel = false;\n      this.getUserInfo();\n    },\n    // 商品推送\n    pushGoods(item) {\n      this.$emit(\"bindPush\", item.id);\n    },\n    // 商品搜索\n    productSearch() {\n      if (this.goodsConfig.type == 0) {\n        this.productCart();\n      } else if (this.goodsConfig.type == 1) {\n        this.productVisit();\n      } else {\n        this.productHot();\n      }\n    },\n  },\n};\n",null]}