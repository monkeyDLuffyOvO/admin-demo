{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/user/list/handle/userForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/user/list/handle/userForm.vue","mtime":1662690806000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { userLabelAddApi, groupAddApi, levelListApi, userGroupApi, userLabelApi, putUserApi } from '@/api/user';\nimport { cityApi } from '@/api/store';\nimport customerInfo from \"@/components/customerInfo\";\nimport userLabel from \"@/components/labelList\";\n\nexport default {\n    name: 'userForm',\n\t\tcomponents: {\n\t\t  customerInfo,\n\t\t\tuserLabel\n\t\t},\n    props: {\n        psInfo: Object\n    },\n    data() {\n        return {\n\t\t\t\t\t  labelShow:false,\n\t\t\t\t\t  customerShow: false,\n            formData: {\n                uid: this.psInfo.uid,\n                real_name: this.psInfo.real_name,\n                phone: this.psInfo.phone,\n                birthday: this.psInfo.birthday,\n                sex: this.psInfo.sex,\n                card_id: this.psInfo.card_id,\n                addres: this.psInfo.addres,\n                pwd: '',\n                true_pwd: '',\n                spread_open: this.psInfo.spread_open,\n                status: this.psInfo.status,\n                group_id: 0,\n                label_id: [],\n                level: this.psInfo.level,\n                provincials: '',\n                province: 0,\n                city: 0,\n                area: 0,\n                street: 0,\n\t\t\t\t\t\t\t\tspread_uid: 0,\n\t\t\t\t\t\t\t\tspread_uid_nickname:''\n            },\n\t\t\t\t\t\tdataLabel: [],\n            addressSelect: [],\n            levelOptions: [],\n            labelOptions: [],\n            addresData: [],\n\t\t\t\t\t\tgroupList: []\n        };\n    },\n    watch: {\n        psInfo (value) {\n            this.formData.uid = value.uid;\n            this.formData.real_name = value.real_name;\n            this.formData.phone = value.phone;\n            this.formData.birthday = value.birthday;\n            this.formData.sex = value.sex;\n            this.formData.card_id = value.card_id;\n            this.formData.addres = value.addres;\n            this.formData.spread_open = value.spread_open;\n            this.formData.status = value.status;\n            this.dataLabel = value.label_id;\n            this.formData.level = value.level;\n            this.formData.provincials = value.provincials;\n            this.formData.province = value.province;\n            this.formData.city = value.city;\n            this.formData.area = value.area;\n            this.formData.street = value.street;\n\t\t\t\t\t\tthis.formData.spread_uid_nickname = value.spread_uid_nickname;\n\t\t\t\t\t\tthis.formData.spread_uid = value.spread_uid;\n            this.formData.group_id = value.group_id;\n        }\n    },\n    created () {\n        this.levelList();\n        this.groupLists();\n        this.labelList();\n        this.cityInfo({ pid: 0 });\n        if (this.psInfo.province) {\n            this.addressSelect.push(this.psInfo.province);\n        }\n        if (this.psInfo.city) {\n            this.addressSelect.push(this.psInfo.city);\n        }\n        if (this.psInfo.area) {\n            this.addressSelect.push(this.psInfo.area);\n        }\n        if (this.psInfo.street) {\n            this.addressSelect.push(this.psInfo.street);\n        }\n    },\n    methods: {\n\t\t\t  clearSpread(){\n\t\t\t\t\tthis.formData.spread_uid = 0;\n\t\t\t\t\tthis.formData.spread_uid_nickname = '';\n\t\t\t\t},\n\t\t\t\tcloseLabel(label){\n\t\t\t\t\tlet index = this.dataLabel.indexOf(this.dataLabel.filter(d=>d.id == label.id)[0]);\n\t\t\t\t\tthis.dataLabel.splice(index,1);\n\t\t\t\t},\n\t\t\t\tactiveData(dataLabel){\n\t\t\t\t\tthis.labelShow = false;\n\t\t\t\t\tthis.dataLabel = dataLabel;\n\t\t\t\t},\n\t\t\t\topenLabel() {\n\t\t\t\t\tthis.labelShow = true;\n\t\t\t\t\tthis.$refs.userLabel.userLabel(JSON.parse(JSON.stringify(this.dataLabel)));\n\t\t\t\t},\n\t\t\t\t// 标签弹窗关闭\n\t\t\t\tlabelClose() {\n\t\t\t\t  this.labelShow = false;\n\t\t\t\t},\n\t\t\t\teditSpread(){\n\t\t\t\t\tthis.customerShow = true;\n\t\t\t\t},\n\t\t\t\timageObject(e) {\n\t\t\t\t  this.customerShow = false;\n\t\t\t\t  this.formData.spread_uid = e.uid;\n\t\t\t\t\tthis.formData.spread_uid_nickname = e.name\n\t\t\t\t},\n        changeMenu (value) {\n            this.$emit('change-menu', value);\n        },\n        // 添加标签、分组\n        add (value) {\n            switch (value) {\n                case 1:\n                    this.$modalForm(userLabelAddApi(0)).then(() => {});\n                    break;\n                case 2:\n                    this.$modalForm(groupAddApi(0)).then(() => {\n\t\t\t\t\t\t\t\t\t\t\tthis.groupLists();\n\t\t\t\t\t\t\t\t\t\t});\n                    break;\n            }\n        },\n        // 会员等级列表\n        levelList() {\n        let data = {\n            page: 1,\n            limit: \"\",\n            title: \"\",\n            is_show: 1,\n        };\n        levelListApi(data).then((res) => {\n            this.levelOptions = res.data.list;\n        });\n        },\n        groupLists() {\n            let data = {\n                page: 1,\n                limit: \"\",\n            };\n            userGroupApi(data).then((res) => {\n                this.groupList = res.data.list;\n            });\n            },\n        labelList() {\n            let data = {\n                page: 1,\n                limit: \"\",\n            };\n            userLabelApi(data)\n                .then(async (res) => {\n                let data = res.data;\n                this.labelOptions = data.list;\n                })\n                .catch((res) => {\n                this.loading = false;\n                this.$Message.error(res.msg);\n                });\n            },\n        // 省市区数据\n        cityInfo(data){\n            cityApi(data).then(res=>{\n                this.addresData = res.data\n            })\n        },\n        loadData(item, callback) {\n            item.loading = true;\n            cityApi({pid:item.value}).then(res=>{\n                item.children = res.data;\n                item.loading = false;\n                callback();\n            });\n        },\n        addchack(e,selectedData){\n            e.forEach((i,index)=>{\n                if(index==0){\n                    this.formData.province = i\n                }else if(index==1){\n                    this.formData.city = i\n                }else if(index==2){\n                    this.formData.area = i\n                }else {\n                    this.formData.street = i\n                }\n            })\n            this.formData.provincials = (selectedData.map(o => o.label)).join(\"/\");\n        },\n        dateChange (value) {\n            this.formData.birthday = value;\n        },\n        // 保存用户信息\n        detailsPut () {\n\t\t\t\t\t  let activeIds = [];\n\t\t\t\t\t  this.dataLabel.forEach((item)=>{\n\t\t\t\t\t  \tactiveIds.push(item.id)\n\t\t\t\t\t  });\n\t\t\t\t\t\tthis.formData.label_id = activeIds\n\t\t\t\t\t\tif (this.formData.phone && !/^1(3|4|5|7|8|9|6)\\d{9}$/.test(this.formData.phone)) {\n\t\t\t\t\t\t\treturn this.$Message.error('请填写正确的手机号');\n\t\t\t\t\t\t}\n            putUserApi(this.formData).then(res => {\n\t\t\t\t\t\t\t  this.$Message.success('修改成功');\n                this.$emit('change-menu', '99');\n            }).catch(res => {\n                this.$Message.error(res.msg);\n            });\n        }\n    }\n}\n",null]}