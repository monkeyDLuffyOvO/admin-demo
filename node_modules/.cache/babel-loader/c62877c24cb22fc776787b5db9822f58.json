{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js!/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/layouts/basic-layout/header-notice/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/layouts/basic-layout/header-notice/index.vue","mtime":1654055305000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from \"vuex\";\nimport { jnoticeRequest } from \"@/api/common\";\nimport { adminSocket } from \"@/libs/socket\";\nimport util from \"@/libs/util\";\nexport default {\n  name: \"iHeaderNotice\",\n  data: function data() {\n    return {\n      badgeProps: {\n        offset: [20, 0],\n        dot: true\n      },\n      needList: [],\n      messageList: [],\n      messageLoading: false,\n      newOrderAudioLink: \"\",\n      pageWs: \"\"\n    };\n  },\n  computed: _objectSpread({}, mapState(\"admin/layout\", [\"isMobile\"]), {}, mapState(\"admin/kefu\", [\"socketStatus\"])),\n  mounted: function mounted() {\n    var _this = this;\n\n    this.getNotict();\n    this.$store.dispatch(\"admin/db/get\", {\n      dbName: \"sys\",\n      path: \"user.info\",\n      user: true\n    }).then(function (res) {\n      _this.newOrderAudioLink = res.newOrderAudioLink;\n    });\n    this.pageWs = adminSocket(false, util.cookies.get(\"token\"));\n    this.wsStart();\n  },\n  methods: {\n    wsStart: function wsStart() {\n      var _this2 = this;\n\n      var h = this.$createElement;\n      this.pageWs.then(function (ws) {\n        var that = _this2;\n\n        if (_this2.socketStatus) {\n          return;\n        }\n\n        ws.$on('close', function () {\n          _this2.$store.commit(\"admin/kefu/setStatus\", false);\n        });\n        ws.$on(\"ADMIN_NEW_PUSH\", function (data) {\n          that.getNotict();\n        });\n        ws.$on(\"success\", function () {\n          _this2.$store.commit(\"admin/kefu/setStatus\", true);\n        });\n        ws.$on(\"NEW_ORDER\", function (data) {\n          that.$Notice.info({\n            title: \"新订单\",\n            duration: 8,\n            // desc: \"您有一个新的订单(\" + data.order_id + \"),请注意查看\",\n            // render:h=>{\n            // \treturn h('div','您有一个新的订单(' + data.order_id + '),请注意查看')\n            // }\n            render: function render(h) {\n              return h(\"div\", {\n                \"class\": \"tle\"\n              }, [\"\\u60A8\\u6709\\u4E00\\u4E2A\\u65B0\\u7684\\u8BA2\\u5355(\", data.order_id, \"),\\u8BF7\\u6CE8\\u610F\\u67E5\\u770B\"]);\n            }\n          });\n          if (this.newOrderAudioLink) new Audio(this.newOrderAudioLink).play();\n          that.messageList.push({\n            title: \"新订单提醒\",\n            icon: \"md-bulb\",\n            iconColor: \"#87d068\",\n            time: 0,\n            read: 0\n          });\n        });\n        ws.$on(\"NEW_REFUND_ORDER\", function (data) {\n          that.$Notice.warning({\n            title: \"退款订单提醒\",\n            duration: 8,\n            desc: \"您有一个订单(\" + data.order_id + \")申请退款,请注意查看\"\n          });\n          if (window.newOrderAudioLink) new Audio(window.newOrderAudioLink).play();\n          that.messageList.push({\n            title: \"退款订单提醒\",\n            icon: \"md-information\",\n            iconColor: \"#fe5c57\",\n            time: 0,\n            read: 0\n          });\n        });\n        ws.$on(\"WITHDRAW\", function (data) {\n          that.$Notice.warning({\n            title: \"提现提醒\",\n            duration: 8,\n            desc: \"有用户申请提现(\" + data.id + \"),请注意查看\"\n          });\n          that.messageList.push({\n            title: \"退款订单提醒\",\n            icon: \"md-people\",\n            iconColor: \"#f06292\",\n            time: 0,\n            read: 0\n          });\n        });\n        ws.$on(\"STORE_STOCK\", function (data) {\n          that.$Notice.warning({\n            title: \"库存预警\",\n            duration: 8,\n            desc: \"(\" + data.id + \")商品库存不足,请注意查看\"\n          });\n          that.messageList.push({\n            title: \"库存预警\",\n            icon: \"md-information\",\n            iconColor: \"#fe5c57\",\n            time: 0,\n            read: 0\n          });\n        });\n        ws.$on(\"PAY_SMS_SUCCESS\", function (data) {\n          that.$Notice.info({\n            title: \"短信充值成功\",\n            duration: 8,\n            desc: \"恭喜您充值\" + data.price + \"元，获得\" + data.number + \"条短信\"\n          });\n          that.messageList.push({\n            title: \"短信充值成功\",\n            icon: \"md-bulb\",\n            iconColor: \"#87d068\",\n            time: 0,\n            read: 0\n          });\n        });\n        ws.$on(\"timeout\", function (data) {//this.wsRestart();\n        });\n      });\n    },\n    wsRestart: function wsRestart() {\n      if (this.pageWs === null) {\n        this.pageWs = adminSocket(true, util.cookies.get(\"token\"));\n        this.wsStart();\n      } else {\n        this.pageWs.reconne();\n      }\n    },\n    jumpUrl: function jumpUrl(url) {\n      this.$router.push({\n        path: url\n      });\n    },\n    getNotict: function getNotict() {\n      var _this3 = this;\n\n      jnoticeRequest().then(function (res) {\n        _this3.needList = res.data || [];\n        _this3.badgeProps.dot = res.data.length > 0;\n      }).catch(function () {});\n    },\n    handleClear: function handleClear(tab) {\n      this.badgeProps.dot = false;\n      this.clearUnread(tab.name);\n    },\n    clearUnread: function clearUnread(type) {\n      this[\"\".concat(type, \"List\")] = this[\"\".concat(type, \"List\")].map(function (item) {\n        item.read = 1;\n        return item;\n      });\n      this[\"\".concat(type, \"List\")] = [];\n    }\n  }\n};",null]}