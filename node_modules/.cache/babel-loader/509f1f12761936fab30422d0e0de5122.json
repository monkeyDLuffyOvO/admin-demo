{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js!/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/setting/special/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/setting/special/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { categoryList as _categoryList, diyGetInfo, diySave, getUrl, setDefault, recovery } from \"@/api/diy\";\nimport vuedraggable from \"vuedraggable\";\nimport mPage from \"@/components/mobilePage/index.js\";\nimport mConfig from \"@/components/mobileConfig/index.js\";\nimport footPage from \"@/components/pagesFoot\";\nimport { mapState } from \"vuex\";\nvar idGlobal = 0;\nexport default {\n  inject: ['reload'],\n  name: \"index.vue\",\n  components: _objectSpread({\n    footPage: footPage,\n    draggable: vuedraggable\n  }, mPage, {}, mConfig),\n  filters: {\n    filterTxt: function filterTxt(val) {\n      if (val) {\n        return val = val.substr(0, val.length - 1);\n      }\n    }\n  },\n  computed: _objectSpread({}, mapState({\n    titleTxt: function titleTxt(state) {\n      return state.admin.mobildConfig.pageTitle || \"专题页\";\n    },\n    titleTxt2: function titleTxt2(state) {\n      return state.admin.mobildConfig;\n    }\n  })),\n  data: function data() {\n    return {\n      clientHeight: '',\n      //页面动态高度\n      rollHeight: '',\n      leftMenu: [],\n      // 左侧菜单\n      lConfig: [],\n      // 左侧组件\n      mConfig: [],\n      // 中间组件渲染\n      rConfig: [],\n      // 右侧组件配置\n      activeConfigName: \"\",\n      propsObj: {},\n      // 组件传递的数据,\n      activeIndex: -99,\n      // 选中的下标\n      number: 0,\n      pageId: \"\",\n      pageName: \"\",\n      pageType: \"\",\n      category: [],\n      tabList: [{\n        title: \"组件库\",\n        key: 0\n      }, {\n        title: \"页面链接\",\n        key: 1\n      }],\n      tabCur: 0,\n      urlList: [],\n      footActive: false,\n      loading: false,\n      isSearch: false,\n      isTab: false,\n      isFllow: false\n    };\n  },\n  created: function created() {\n    this.categoryList();\n    this.getUrlList();\n    this.pageId = this.$route.query.id;\n    this.pageName = this.$route.query.name;\n    this.pageType = this.$route.query.type;\n    this.lConfig = this.objToArr(mPage);\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    var imgList = {\n      imgList: [require('@/assets/images/foot-009.png'), require('@/assets/images/foot-0010.png')],\n      name: '主题页',\n      link: '/pages/annex/special/index?id=' + this.pageId\n    };\n    this.$nextTick(function () {\n      _this.$store.commit(\"admin/mobildConfig/FOOTER\", {\n        'title': '是否显示',\n        'name': imgList\n      });\n\n      _this.arraySort();\n\n      if (_this.pageId != 0) {\n        _this.getDefaultConfig();\n      }\n\n      _this.clientHeight = \"\".concat(document.documentElement.clientHeight) - 65.81; //获取浏览器可视区域高度\n\n      var H = \"\".concat(document.documentElement.clientHeight) - 180;\n      _this.rollHeight = H > 650 ? 650 : H;\n      var that = _this;\n\n      window.onresize = function () {\n        that.clientHeight = \"\".concat(document.documentElement.clientHeight) - 65.81;\n        var H = \"\".concat(document.documentElement.clientHeight) - 180;\n        that.rollHeight = H > 650 ? 650 : H;\n      };\n    });\n  },\n  methods: {\n    leftRemove: function leftRemove(_ref) {\n      var to = _ref.to,\n          from = _ref.from,\n          item = _ref.item,\n          clone = _ref.clone,\n          oldIndex = _ref.oldIndex,\n          newIndex = _ref.newIndex;\n\n      if (this.isSearch && newIndex == 0) {\n        if (item._underlying_vm_.name == \"z_wechat_attention\") {\n          this.isFllow = true;\n        } else {\n          this.$store.commit(\"admin/mobildConfig/ARRAYREAST\", this.mConfig[0].num);\n          this.mConfig.splice(0, 1);\n        }\n      }\n\n      if (this.isFllow = true && newIndex >= 1) {\n        this.$store.commit(\"admin/mobildConfig/ARRAYREAST\", this.mConfig[0].num);\n      }\n    },\n    onMove: function onMove(e) {\n      if (e.relatedContext.element.name == \"search_box\") return false;\n      if (e.relatedContext.element.name == \"nav_bar\") return false;\n      return true;\n    },\n    onCopy: function onCopy() {\n      this.$Message.success(\"复制成功\");\n    },\n    onError: function onError() {\n      this.$Message.error(\"复制失败\");\n    },\n    //设置默认数据\n    setmoren: function setmoren() {\n      var _this2 = this;\n\n      setDefault(this.pageId).then(function (res) {\n        _this2.$Message.success(res.msg);\n      }).catch(function (err) {\n        _this2.$Message.error(err.msg);\n      });\n    },\n    //恢复默认\n    getmoren: function getmoren() {\n      var _this3 = this;\n\n      recovery(this.pageId).then(function (res) {\n        _this3.$Message.success(res.msg);\n\n        _this3.reload();\n      }).catch(function (err) {\n        _this3.$Message.error(err.msg);\n      });\n    },\n    // 获取url\n    getUrlList: function getUrlList() {\n      var _this4 = this;\n\n      getUrl().then(function (res) {\n        _this4.urlList = res.data.url;\n      });\n    },\n    // 左侧tab\n    bindTab: function bindTab(index) {\n      this.tabCur = index;\n    },\n    // 页面标题点击\n    showTitle: function showTitle() {\n      this.activeIndex = -100;\n      var obj = {};\n\n      for (var i in mConfig) {\n        if (i == \"pageTitle\") {\n          // this.rConfig = obj\n          obj = mConfig[i];\n          obj.configName = mConfig[i].name;\n          obj.cname = \"页面设置\";\n        }\n      }\n\n      var abc = obj;\n      this.rConfig = [];\n      this.rConfig[0] = JSON.parse(JSON.stringify(obj));\n    },\n    // 页面底部点击\n    showFoot: function showFoot() {\n      this.activeIndex = -101;\n      var obj = {};\n\n      for (var i in mConfig) {\n        if (i == \"pageFoot\") {\n          // this.rConfig = obj\n          obj = mConfig[i];\n          obj.configName = mConfig[i].name;\n          obj.cname = \"底部菜单\";\n        }\n      }\n\n      var abc = obj;\n      this.rConfig = [];\n      this.rConfig[0] = JSON.parse(JSON.stringify(obj));\n    },\n    // 对象转数组\n    objToArr: function objToArr(data) {\n      var obj = Object.keys(data);\n      var m = obj.map(function (key) {\n        return data[key];\n      });\n      return m;\n    },\n    log: function log(evt) {\n      // 中间拖拽排序\n      if (evt.moved) {\n        if (evt.moved.element.name == \"search_box\") {\n          return this.$Message.warning(\"该组件禁止拖拽\");\n        }\n\n        if (evt.moved.element.name == \"nav_bar\") {\n          return this.$Message.warning(\"该组件禁止拖拽\");\n        }\n\n        evt.moved.oldNum = this.mConfig[evt.moved.oldIndex].num;\n        evt.moved.newNum = this.mConfig[evt.moved.newIndex].num;\n        evt.moved.status = evt.moved.oldIndex > evt.moved.newIndex;\n        this.mConfig.forEach(function (el, index) {\n          el.num = new Date().getTime() * 1000 + index;\n        });\n        evt.moved.list = this.mConfig;\n        this.rConfig = [];\n        var item = evt.moved.element;\n        var tempItem = JSON.parse(JSON.stringify(item));\n        this.rConfig.push(tempItem);\n        this.activeIndex = evt.moved.newIndex;\n        this.$store.commit(\"admin/mobildConfig/SETCONFIGNAME\", item.name);\n        this.$store.commit(\"admin/mobildConfig/defaultArraySort\", evt.moved);\n      } // 从左向右拖拽排序\n\n\n      if (evt.added) {\n        var data = evt.added.element;\n        var obj = {};\n        var timestamp = new Date().getTime() * 1000;\n        data.num = timestamp;\n        this.activeConfigName = data.name;\n\n        var _tempItem = JSON.parse(JSON.stringify(data));\n\n        _tempItem.id = \"id\" + _tempItem.num;\n        this.mConfig[evt.added.newIndex] = _tempItem;\n        this.rConfig = [];\n        this.rConfig.push(_tempItem);\n        this.mConfig.forEach(function (el, index) {\n          el.num = new Date().getTime() * 1000 + index;\n        });\n        evt.added.list = this.mConfig;\n        this.activeIndex = evt.added.newIndex; // 保存组件名称\n\n        this.$store.commit(\"admin/mobildConfig/SETCONFIGNAME\", data.name);\n        this.$store.commit(\"admin/mobildConfig/defaultArraySort\", evt.added);\n      }\n    },\n    cloneDog: function cloneDog(data) {\n      // this.mConfig.push(tempItem)\n      return _objectSpread({}, data);\n    },\n    //数组元素互换位置\n    swapArray: function swapArray(arr, index1, index2) {\n      arr[index1] = arr.splice(index2, 1, arr[index1])[0];\n      return arr;\n    },\n    //点击上下移动；\n    movePage: function movePage(item, index, type) {\n      if (type) {\n        if (index == 0) {\n          return;\n        }\n      } else {\n        if (index == this.mConfig.length - 1) {\n          return;\n        }\n      }\n\n      if (item.name == \"search_box\") {\n        return this.$Message.warning(\"该组件禁止移动\");\n      }\n\n      if (item.name == \"nav_bar\") {\n        return this.$Message.warning(\"该组件禁止移动\");\n      }\n\n      if (type) {\n        if (this.mConfig[index - 1].name == \"search_box\" || this.mConfig[index - 1].name == \"nav_bar\") {\n          return this.$Message.warning(\"搜索框、商品分类必须为顶部\");\n        }\n\n        this.swapArray(this.mConfig, index - 1, index);\n      } else {\n        this.swapArray(this.mConfig, index, index + 1);\n      }\n\n      var obj = {};\n      this.rConfig = [];\n      obj.oldIndex = index;\n\n      if (type) {\n        obj.newIndex = index - 1;\n      } else {\n        obj.newIndex = index + 1;\n      }\n\n      this.mConfig.forEach(function (el, index) {\n        el.num = new Date().getTime() * 1000 + index;\n      });\n      var tempItem = JSON.parse(JSON.stringify(item));\n      this.rConfig.push(tempItem);\n      obj.element = item;\n      obj.list = this.mConfig;\n\n      if (type) {\n        this.activeIndex = index - 1;\n      } else {\n        this.activeIndex = index + 1;\n      }\n\n      this.$store.commit(\"admin/mobildConfig/SETCONFIGNAME\", item.name);\n      this.$store.commit(\"admin/mobildConfig/defaultArraySort\", obj);\n    },\n    // 组件添加\n    addDomCon: function addDomCon(item, type, index) {\n      if (item.name == \"search_box\") {\n        if (this.isSearch) return this.$Message.error(\"该组件只能添加一次\");\n        this.isSearch = true;\n      }\n\n      if (item.name == \"nav_bar\") {\n        if (this.isTab) return this.$Message.error(\"该组件只能添加一次\");\n        this.isTab = true;\n      }\n\n      idGlobal += 1;\n      var obj = {};\n      var timestamp = new Date().getTime() * 1000;\n      item.num = \"\".concat(timestamp);\n      item.id = \"id\".concat(timestamp);\n      this.activeConfigName = item.name;\n      var tempItem = JSON.parse(JSON.stringify(item));\n\n      if (item.name == \"search_box\") {\n        this.rConfig = [];\n        this.mConfig.unshift(tempItem);\n        this.activeIndex = 0;\n        this.rConfig.push(tempItem);\n      } else if (item.name == \"nav_bar\") {\n        this.rConfig = [];\n\n        if (this.mConfig[0] && this.mConfig[0].name === \"search_box\") {\n          this.mConfig.splice(1, 0, tempItem);\n          this.activeIndex = 1;\n        } else {\n          this.mConfig.splice(0, 0, tempItem);\n          this.activeIndex = 0;\n        }\n\n        this.rConfig.push(tempItem);\n      } else {\n        if (type) {\n          this.rConfig = [];\n          this.mConfig.push(tempItem);\n          this.activeIndex = this.mConfig.length - 1;\n          this.rConfig.push(tempItem);\n        } else {\n          this.mConfig.splice(index + 1, 0, tempItem);\n          this.activeIndex = index;\n        }\n      }\n\n      this.mConfig.forEach(function (el, index) {\n        el.num = new Date().getTime() * 1000 + index;\n      }); // 保存组件名称\n\n      obj.element = item;\n      obj.list = this.mConfig;\n      this.$store.commit(\"admin/mobildConfig/SETCONFIGNAME\", item.name);\n      this.$store.commit(\"admin/mobildConfig/defaultArraySort\", obj);\n    },\n    //中间页点击添加模块；\n    bindAddDom: function bindAddDom(item, type, index) {\n      var i = item;\n      this.lConfig.forEach(function (j) {\n        if (item.name == j.name) {\n          i = j;\n        }\n      });\n      this.addDomCon(i, type, index);\n    },\n    //左边配置模块点击添加；\n    addDom: function addDom(item, type) {\n      this.addDomCon(item, type);\n    },\n    // 点击显示相应的配置\n    bindconfig: function bindconfig(item, index) {\n      this.rConfig = [];\n      var tempItem = JSON.parse(JSON.stringify(item));\n      this.rConfig.push(tempItem);\n      this.activeIndex = index;\n      this.$store.commit(\"admin/mobildConfig/SETCONFIGNAME\", item.name);\n    },\n    // 组件删除\n    bindDelete: function bindDelete(item, key) {\n      if (item.name == \"search_box\") {\n        this.isSearch = false;\n      }\n\n      if (item.name == \"nav_bar\") {\n        this.isTab = false;\n      }\n\n      this.mConfig.splice(key, 1);\n      this.rConfig.splice(0, 1);\n\n      if (this.mConfig.length != key) {\n        this.rConfig.push(this.mConfig[key]);\n      } else {\n        if (this.mConfig.length) {\n          this.activeIndex = key - 1;\n          this.rConfig.push(this.mConfig[key - 1]);\n        } else {\n          this.showTitle();\n        }\n      } // 删除第几个配置\n\n\n      this.$store.commit(\"admin/mobildConfig/DELETEARRAY\", item);\n    },\n    // 组件返回\n    config: function config(data) {\n      var propsObj = this.propsObj;\n      propsObj.data = data;\n      propsObj.name = this.activeConfigName;\n    },\n    addSort: function addSort(arr, index1, index2) {\n      arr[index1] = arr.splice(index2, 1, arr[index1])[0];\n      return arr;\n    },\n    // 数组排序\n    arraySort: function arraySort() {\n      var tempArr = [];\n      var basis = {\n        title: \"基础组件\",\n        list: [],\n        isOpen: true\n      };\n      var marketing = {\n        title: \"营销组件\",\n        list: [],\n        isOpen: true\n      };\n      var tool = {\n        title: \"工具组件\",\n        list: [],\n        isOpen: true\n      };\n      this.lConfig.map(function (el, index) {\n        if (el.type == 0) {\n          basis.list.push(el);\n        }\n\n        if (el.type == 1) {\n          marketing.list.push(el);\n        }\n\n        if (el.type == 2) {\n          tool.list.push(el);\n        }\n      });\n      tempArr.push(basis, marketing, tool);\n      this.leftMenu = tempArr;\n    },\n    // 保存配置\n    saveConfig: function saveConfig() {\n      var _this5 = this;\n\n      if (this.mConfig.length == 0) {\n        return this.$Message.error(\"暂未添加任何组件，保存失败！\");\n      }\n\n      this.loading = true;\n      var val = this.$store.state.admin.mobildConfig.defaultArray;\n\n      if (!this.footActive) {\n        var timestamp = new Date().getTime() * 1000;\n        val[timestamp] = this.$store.state.admin.mobildConfig.pageFooter;\n        this.footActive = true;\n      }\n\n      diySave(this.pageId, {\n        name: this.pageName,\n        type: this.pageType,\n        value: val,\n        title: this.titleTxt\n      }).then(function (res) {\n        _this5.loading = false;\n        _this5.pageId = res.data.id;\n\n        _this5.$Message.success(res.msg);\n      }).catch(function (res) {\n        _this5.loading = false;\n\n        _this5.$Message.error(res.msg);\n      });\n    },\n    // 获取默认配置\n    getDefaultConfig: function getDefaultConfig() {\n      var _this6 = this;\n\n      diyGetInfo(this.pageId, {\n        type: 2\n      }).then(function (_ref2) {\n        var data = _ref2.data;\n        var obj = {};\n        var tempARR = [];\n\n        _this6.$store.commit(\"admin/mobildConfig/titleUpdata\", data.info.title);\n\n        var newArr = _this6.objToArr(data.info.value);\n\n        function sortNumber(a, b) {\n          return a.timestamp - b.timestamp;\n        }\n\n        newArr.sort(sortNumber);\n        newArr.map(function (el, index) {\n          if (el.name == \"headerSerch\") {\n            _this6.isSearch = true;\n          }\n\n          if (el.name == \"tabNav\") {\n            _this6.isTab = true;\n          }\n\n          el.id = \"id\" + el.timestamp;\n\n          _this6.lConfig.map(function (item, j) {\n            if (el.name == item.defaultName) {\n              item.num = el.timestamp;\n              item.id = \"id\" + el.timestamp;\n              var tempItem = JSON.parse(JSON.stringify(item));\n              tempARR.push(tempItem);\n              obj[el.timestamp] = el;\n\n              _this6.mConfig.push(tempItem); // 保存默认组件配置\n\n\n              _this6.$store.commit(\"admin/mobildConfig/ADDARRAY\", {\n                num: el.timestamp,\n                val: el\n              });\n            }\n          });\n        });\n        var objs = newArr[newArr.length - 1];\n\n        if (objs.name == \"pageFoot\") {\n          _this6.$store.commit(\"admin/mobildConfig/footPageUpdata\", objs);\n        }\n\n        _this6.rConfig = [];\n        _this6.activeIndex = 0;\n\n        _this6.rConfig.push(_this6.mConfig[0]);\n      });\n    },\n    categoryList: function categoryList() {\n      var _this7 = this;\n\n      _categoryList(function (res) {\n        _this7.category = res.data;\n      });\n    },\n    // 重置\n    reast: function reast() {\n      var _this8 = this;\n\n      if (this.pageId == 0) {\n        this.$Message.error(\"新增页面，无法重置\");\n      } else {\n        this.$Modal.confirm({\n          title: \"提示\",\n          content: \"<p>是否重置当前页面数据</p>\",\n          onOk: function onOk() {\n            _this8.mConfig = [];\n            _this8.rConfig = [];\n            _this8.activeIndex = -99;\n\n            _this8.getDefaultConfig();\n          },\n          onCancel: function onCancel() {}\n        });\n      }\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.$store.commit(\"admin/mobildConfig/titleUpdata\", \"\");\n    this.$store.commit(\"admin/mobildConfig/SETEMPTY\");\n  },\n  destroyed: function destroyed() {\n    this.$store.commit(\"admin/mobildConfig/titleUpdata\", \"\");\n    this.$store.commit(\"admin/mobildConfig/SETEMPTY\");\n  }\n};",null]}