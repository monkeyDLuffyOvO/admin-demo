{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js!/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/setting/storeService/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/setting/storeService/index.vue","mtime":1658973957000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/home/darkcrossunicorn/\\u6587\\u6863/admin/node_modules/@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from \"vuex\";\nimport util from \"@/libs/util\";\nimport { kefuListApi, kefucreateApi, kefuaddApi, kefuAddApi, kefusetStatusApi, kefuEditApi, kefuRecordApi, kefuChatlistApi, kefuLogin } from \"@/api/setting\";\nexport default {\n  name: \"index\",\n  filters: {\n    typeFilter: function typeFilter(status) {\n      var statusMap = {\n        wechat: \"微信用户\",\n        routine: \"小程序用户\"\n      };\n      return statusMap[status];\n    }\n  },\n  computed: _objectSpread({}, mapState(\"admin/layout\", [\"isMobile\"]), {}, mapState(\"admin/userLevel\", [\"categoryId\"]), {\n    labelWidth: function labelWidth() {\n      return this.isMobile ? undefined : 80;\n    },\n    labelPosition: function labelPosition() {\n      return this.isMobile ? \"top\" : \"left\";\n    }\n  }),\n  data: function data() {\n    return {\n      isChat: true,\n      formValidate3: {\n        page: 1,\n        limit: 15\n      },\n      total3: 0,\n      loading3: false,\n      modals3: false,\n      tableList3: [],\n      columns3: [{\n        title: \"用户名称\",\n        key: \"nickname\",\n        width: 200\n      }, {\n        title: \"客服头像\",\n        slot: \"headimgurl\"\n      }, {\n        title: \"操作\",\n        slot: \"action\"\n      }],\n      formValidate5: {\n        page: 1,\n        limit: 15,\n        uid: 0,\n        to_uid: 0,\n        id: 0\n      },\n      total5: 0,\n      loading5: false,\n      tableList5: [],\n      columns5: [{\n        title: \"用户名称\",\n        key: \"nickname\",\n        width: 200\n      }, {\n        title: \"用户头像\",\n        slot: \"avatar\"\n      }, {\n        title: \"发送消息\",\n        key: \"msn\",\n        width: 250\n      }, {\n        title: \"发送时间\",\n        key: \"add_time\"\n      }],\n      FromData: null,\n      formValidate: {\n        page: 1,\n        limit: 15,\n        data: \"\",\n        type: \"\",\n        nickname: \"\"\n      },\n      tableList2: [],\n      modals: false,\n      total: 0,\n      tableFrom: {\n        page: 1,\n        limit: 15\n      },\n      timeVal: [],\n      fromList: {\n        title: \"选择时间\",\n        custom: true,\n        fromTxt: [{\n          text: \"全部\",\n          val: \"\"\n        }, {\n          text: \"今天\",\n          val: \"today\"\n        }, {\n          text: \"昨天\",\n          val: \"yesterday\"\n        }, {\n          text: \"最近7天\",\n          val: \"lately7\"\n        }, {\n          text: \"最近30天\",\n          val: \"lately30\"\n        }, {\n          text: \"本月\",\n          val: \"month\"\n        }, {\n          text: \"本年\",\n          val: \"year\"\n        }]\n      },\n      loading: false,\n      tableList: [],\n      columns1: [{\n        title: \"ID\",\n        key: \"id\",\n        width: 80\n      }, {\n        title: \"微信用户名称\",\n        key: \"nickname\",\n        minWidth: 120\n      }, {\n        title: \"客服头像\",\n        slot: \"avatar\",\n        minWidth: 60\n      }, {\n        title: \"客服名称\",\n        key: \"wx_name\",\n        minWidth: 120\n      }, {\n        title: \"企微员工\",\n        slot: \"workMember\",\n        minWidth: 120\n      }, {\n        title: \"账号状态\",\n        slot: \"account_status\",\n        minWidth: 120\n      }, {\n        title: \"添加时间\",\n        key: \"add_time\",\n        minWidth: 130\n      }, {\n        title: \"操作\",\n        slot: \"action\",\n        fixed: \"right\",\n        width: 200\n      }],\n      columns4: [{\n        type: \"selection\",\n        width: 60,\n        align: \"center\"\n      }, {\n        title: \"ID\",\n        key: \"uid\",\n        width: 80\n      }, {\n        title: \"微信用户名称\",\n        key: \"nickname\",\n        minWidth: 160\n      }, {\n        title: \"客服头像\",\n        slot: \"headimgurl\",\n        minWidth: 60\n      }, {\n        title: \"用户类型\",\n        slot: \"user_type\",\n        width: 100\n      }, {\n        title: \"性别\",\n        slot: \"sex\",\n        minWidth: 60\n      }, {\n        title: \"地区\",\n        slot: \"country\",\n        minWidth: 120\n      }, {\n        title: \"是否关注公众号\",\n        slot: \"subscribe\",\n        minWidth: 120\n      }],\n      loading2: false,\n      total2: 0,\n      addFrom: {\n        uids: []\n      },\n      selections: [],\n      rows: {},\n      rowRecord: {}\n    };\n  },\n  created: function created() {\n    this.getList();\n  },\n  methods: {\n    // 进入工作台\n    goChat: function goChat(item) {\n      var _this = this;\n\n      kefuLogin(item.id).then(function (res) {\n        var url = \"\";\n\n        if (res.data.token) {\n          var expires = _this.getExpiresTime(res.data.exp_time);\n\n          util.cookies.setKefu(\"token\", res.data.token, expires);\n          util.cookies.setKefu(\"uuid\", res.data.kefuInfo.uid, expires);\n          util.cookies.setKefu(\"expires_time\", res.data.exp_time, expires);\n          util.cookies.setKefu(\"kefuInfo\", res.data.kefuInfo, expires);\n\n          if (_this.$store.state.admin.layout.isMobile) {\n            url = window.location.protocol + \"//\" + window.location.host + \"/kefu/mobile_list\";\n          } else {\n            url = window.location.protocol + \"//\" + window.location.host + \"/kefu/pc_list\";\n          }\n\n          window.open(url, \"_blank\");\n        }\n      }).catch(function (error) {\n        _this.$Message.error(error.msg);\n      });\n    },\n    getExpiresTime: function getExpiresTime(expiresTime) {\n      var nowTimeNum = Math.round(new Date() / 1000);\n      var expiresTimeNum = expiresTime - nowTimeNum;\n      return parseFloat(parseFloat(parseFloat(expiresTimeNum / 60) / 60) / 24);\n    },\n    cancel: function cancel() {\n      this.formValidate = {\n        page: 1,\n        limit: 10,\n        data: \"\",\n        type: \"\",\n        nickname: \"\"\n      };\n    },\n    handleReachBottom: function handleReachBottom() {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        _this2.formValidate.page = _this2.formValidate.page + 1;\n        setTimeout(function () {\n          // this.loading2 = true;\n          kefucreateApi(_this2.formValidate).then(\n          /*#__PURE__*/\n          function () {\n            var _ref = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee(res) {\n              var data, i;\n              return _regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      data = res.data; // this.tableList2 = data.list;\n\n                      if (data.list.length > 0) {\n                        for (i = 0; i < data.list.length; i++) {\n                          _this2.tableList2.push(data.list[i]);\n                        }\n                      }\n\n                      _this2.total2 = data.count;\n                      _this2.loading2 = false;\n\n                    case 4:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }()).catch(function (res) {\n            _this2.loading2 = false;\n\n            _this2.$Message.error(res.msg);\n          });\n          resolve();\n        }, 2000);\n      });\n    },\n    // 查看对话\n    look: function look(row) {\n      this.isChat = false;\n      this.rowRecord = row;\n      this.getChatlist();\n    },\n    // 查看对话列表\n    getChatlist: function getChatlist() {\n      var _this3 = this;\n\n      this.loading5 = true;\n      this.formValidate5.uid = this.rows.uid;\n      this.formValidate5.to_uid = this.rowRecord.uid;\n      this.formValidate5.id = this.rows.id;\n      kefuChatlistApi(this.formValidate5).then(\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2(res) {\n          var data;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  data = res.data;\n                  _this3.tableList5 = data.list;\n                  _this3.total5 = data.count;\n                  _this3.loading5 = false;\n\n                case 4:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this3.loading5 = false;\n\n        _this3.$Message.error(res.msg);\n      });\n    },\n    pageChange5: function pageChange5(index) {\n      this.formValidate5.page = index;\n      this.getChatlist();\n    },\n    // 修改成功\n    submitFail: function submitFail() {\n      this.getList();\n    },\n    // 聊天记录\n    record: function record(row) {\n      this.rows = row;\n      this.modals3 = true;\n      this.isChat = true;\n      this.getListRecord();\n    },\n    // 聊天记录列表\n    getListRecord: function getListRecord() {\n      var _this4 = this;\n\n      this.loading3 = true;\n      kefuRecordApi(this.formValidate3, this.rows.id).then(\n      /*#__PURE__*/\n      function () {\n        var _ref3 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee3(res) {\n          var data;\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  data = res.data;\n                  _this4.tableList3 = data.list ? data.list : [];\n                  _this4.total3 = data.count;\n                  _this4.loading3 = false;\n\n                case 4:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3);\n        }));\n\n        return function (_x3) {\n          return _ref3.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this4.loading3 = false;\n\n        _this4.$Message.error(res.msg);\n      });\n    },\n    pageChange3: function pageChange3(index) {\n      this.formValidate3.page = index;\n      this.getListRecord();\n    },\n    // 编辑\n    edit: function edit(row) {\n      var _this5 = this;\n\n      this.$modalForm(kefuEditApi(row.id)).then(function () {\n        return _this5.getList();\n      });\n    },\n    // 添加\n    add: function add() {\n      var _this6 = this;\n\n      // this.modals = true;\n      // this.formValidate.data = '';\n      // this.getListService();\n      this.$modalForm(kefuaddApi()).then(function () {\n        return _this6.getList();\n      });\n    },\n    // 全选\n    onSelectTab: function onSelectTab(selection) {\n      this.selections = selection;\n      var data = [];\n      this.selections.map(function (item) {\n        data.push(item.uid);\n      });\n      this.addFrom.uids = data;\n    },\n    // 具体日期\n    onchangeTime: function onchangeTime(e) {\n      this.timeVal = e;\n      this.formValidate.data = this.timeVal[0] ? this.timeVal.join(\"-\") : \"\";\n      this.formValidate.page = 1;\n      this.getListService();\n    },\n    // 选择时间\n    selectChange: function selectChange(tab) {\n      this.formValidate.data = tab;\n      this.timeVal = [];\n      this.formValidate.page = 1;\n      this.getListService();\n    },\n    // 客服列表\n    getListService: function getListService() {\n      var _this7 = this;\n\n      this.loading2 = true;\n      kefucreateApi(this.formValidate).then(\n      /*#__PURE__*/\n      function () {\n        var _ref4 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee4(res) {\n          var data;\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  data = res.data;\n                  _this7.tableList2 = data.list;\n                  _this7.total2 = data.count;\n\n                  _this7.tableList2.map(function (item) {\n                    item._isChecked = false;\n                  });\n\n                  _this7.loading2 = false;\n\n                case 5:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        return function (_x4) {\n          return _ref4.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this7.loading2 = false;\n\n        _this7.$Message.error(res.msg);\n      });\n    },\n    pageChange2: function pageChange2(pageIndex) {\n      this.formValidate.page = pageIndex;\n      this.getListService();\n      this.addFrom.uids = [];\n    },\n    // 搜索\n    userSearchs: function userSearchs() {\n      this.formValidate.page = 1;\n      this.getListService();\n    },\n    // 删除\n    del: function del(row, tit, num) {\n      var _this8 = this;\n\n      var delfromData = {\n        title: tit,\n        num: num,\n        url: \"app/wechat/kefu/\".concat(row.id),\n        method: \"DELETE\",\n        ids: \"\"\n      };\n      this.$modalSure(delfromData).then(function (res) {\n        _this8.$Message.success(res.msg);\n\n        _this8.tableList.splice(num, 1);\n      }).catch(function (res) {\n        _this8.$Message.error(res.msg);\n      });\n    },\n    // 列表\n    getList: function getList() {\n      var _this9 = this;\n\n      this.loading = true;\n      kefuListApi(this.tableFrom).then(\n      /*#__PURE__*/\n      function () {\n        var _ref5 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee5(res) {\n          var data;\n          return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  data = res.data;\n                  _this9.tableList = data.list;\n                  _this9.total = res.data.count;\n                  _this9.loading = false;\n\n                case 4:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, _callee5);\n        }));\n\n        return function (_x5) {\n          return _ref5.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this9.loading = false;\n\n        _this9.$Message.error(res.msg);\n      });\n    },\n    pageChange: function pageChange(index) {\n      this.tableFrom.page = index;\n      this.getList();\n    },\n    // 修改是否显示\n    onchangeIsShow: function onchangeIsShow(row) {\n      var _this10 = this;\n\n      var data = {\n        id: row.id,\n        account_status: row.account_status\n      };\n      kefusetStatusApi(data).then(\n      /*#__PURE__*/\n      function () {\n        var _ref6 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee6(res) {\n          return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  _this10.$Message.success(res.msg);\n\n                  _this10.getList();\n\n                case 2:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }, _callee6);\n        }));\n\n        return function (_x6) {\n          return _ref6.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this10.$Message.error(res.msg);\n      });\n    },\n    // 添加客服\n    putRemark: function putRemark() {\n      var _this11 = this;\n\n      if (this.addFrom.uids.length === 0) {\n        return this.$Message.warning(\"请选择要添加的客服\");\n      }\n\n      kefuAddApi(this.addFrom).then(\n      /*#__PURE__*/\n      function () {\n        var _ref7 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee7(res) {\n          return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  _this11.$Message.success(res.msg);\n\n                  _this11.modals = false;\n\n                  _this11.getList();\n\n                case 3:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }, _callee7);\n        }));\n\n        return function (_x7) {\n          return _ref7.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this11.loading = false;\n\n        _this11.$Message.error(res.msg);\n      });\n    } // 进入工作台\n    // goChat(item){\n    //     kefuLogin(item.id).then(res=>{\n    //         if(res.data.token){\n    //             let expires = this.getExpiresTime(res.data.exp_time);\n    //             util.cookies.setKefu('token', res.data.token, {\n    //                 expires:expires\n    //             });\n    //             util.cookies.setKefu('uuid', res.data.kefuInfo.uid, {\n    //                 expires: expires\n    //             });\n    //             util.cookies.setKefu('expires_time', res.data.exp_time, {\n    //                 expires: expires\n    //             });\n    //             let url = window.location.protocol+\"//\"+window.location.host + '/kefu';\n    //             window.open(url, '_blank');\n    //         }\n    //     })\n    // },\n    // getExpiresTime (expiresTime) {\n    //     let nowTimeNum = Math.round(new Date() / 1000);\n    //     let expiresTimeNum = expiresTime - nowTimeNum;\n    //     return parseFloat(parseFloat(parseFloat(expiresTimeNum / 60) / 60) / 24);\n    // },\n\n  }\n};",null]}