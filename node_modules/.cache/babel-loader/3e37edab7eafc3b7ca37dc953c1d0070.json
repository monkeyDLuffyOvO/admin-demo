{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js!/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/components/uploadVideos/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/components/uploadVideos/index.vue","mtime":1663723634000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { productGetTempKeysApi, uploadType as _uploadType, videoAttachment } from \"@/api/product\";\nimport { uploadByPieces } from \"@/utils/upload\"; //引入uploadByPieces方法\n\nimport Setting from \"@/setting\";\nimport util from \"@/libs/util\"; // import \"../../../public/UEditor/dialogs/internal\";\n\nexport default {\n  name: \"vide11o\",\n  props: {\n    pid: {\n      type: Number,\n      default: 0\n    }\n  },\n  data: function data() {\n    return {\n      fileUrl: Setting.apiBaseURL + \"/file/upload\",\n      fileUrl2: Setting.apiBaseURL + \"/file/video_upload\",\n      upload: {\n        videoIng: false // 是否显示进度条；\n\n      },\n      progress: 0,\n      // 进度条默认0\n      videoLink: \"\",\n      formValidate: {\n        video_link: \"\"\n      },\n      upload_type: \"\",\n      uploadData: {},\n      header: {},\n      seletVideo: 0\n    };\n  },\n  watch: {\n    seletVideo: {\n      handler: function handler(nVal, oVal) {\n        this.videoLink = '';\n        this.formValidate.video_link = '';\n      }\n    }\n  },\n  created: function created() {\n    this.uploadType();\n    this.getToken();\n  },\n  methods: {\n    // 删除视频；\n    delVideo: function delVideo() {\n      var that = this;\n      that.$set(that.formValidate, \"video_link\", \"\");\n      that.$refs.refid.value = '';\n    },\n    // 上传成功\n    handleSuccess: function handleSuccess(res, file, fileList) {\n      if (res.status === 200) {\n        this.formValidate.video_link = res.data.src;\n        this.$Message.success(res.msg);\n      } else {\n        this.$Message.error(res.msg);\n      }\n    },\n    getToken: function getToken() {\n      this.header[\"Authori-zation\"] = \"Bearer \" + util.cookies.get(\"token\");\n    },\n    //获取视频上传类型\n    uploadType: function uploadType() {\n      var _this = this;\n\n      _uploadType().then(function (res) {\n        //1:本地上传；2：七牛云上传；3：阿里云上传；4：腾讯云上传\n        _this.upload_type = res.data.upload_type;\n      });\n    },\n    beforeUpload: function beforeUpload(file) {\n      var _this2 = this;\n\n      var imgTypeArr = [\"video/mp4\"];\n      var imgType = imgTypeArr.indexOf(file.type) !== -1;\n\n      if (!imgType) {\n        return this.$Message.warning({\n          content: '文件  ' + file.name + '  格式不正确, 请选择格式正确的视频',\n          duration: 5\n        });\n      }\n\n      uploadByPieces({\n        randoms: \"\",\n        // 随机数，这里作为给后端处理分片的标识 根据项目看情况 是否要加\n        file: file,\n        // 视频实体\n        pieceSize: 3,\n        // 分片大小\n        pid: this.pid,\n        success: function success(data) {\n          _this2.formValidate.video_link = data.file_path;\n          _this2.progress = 100;\n        },\n        error: function error(e) {\n          _this2.$Message.error(e.msg);\n        },\n        uploading: function uploading(chunk, allChunk) {\n          _this2.videoIng = true;\n          var st = Math.floor(chunk / allChunk * 100);\n          _this2.progress = st;\n        }\n      });\n      return false;\n    },\n    zh_uploadFile: function zh_uploadFile() {\n      if (this.videoLink && this.$getFileType(this.videoLink) == 'video') {\n        this.formValidate.video_link = this.videoLink;\n      } else if (this.videoLink && this.$getFileType(this.videoLink) !== 'video' && this.seletVideo == 1) {\n        return this.$Message.error(\"请输入正确的视频链接\");\n      } else {\n        this.$refs.refid.click();\n      }\n    },\n    zh_uploadFile_change: function zh_uploadFile_change(evfile) {\n      var that = this;\n\n      if (evfile.target.files[0].type !== \"video/mp4\") {\n        return that.$Message.error(\"只能上传mp4文件\");\n      }\n\n      productGetTempKeysApi().then(function (res) {\n        that.$videoCloud.videoUpload({\n          type: res.data.type,\n          evfile: evfile,\n          res: res,\n          uploading: function uploading(status, progress) {\n            that.upload.videoIng = status;\n\n            if (res.status == 200) {\n              that.progress = 100;\n            }\n          }\n        }).then(function (res) {\n          that.formValidate.video_link = res.url;\n          that.$Message.success(\"视频上传成功\");\n          that.upload.videoIng = false;\n        }).catch(function (res) {\n          that.$Message.error(res);\n        });\n      }).catch(function (res) {\n        that.$Message.error(res.msg);\n      });\n    },\n    uploads: function uploads() {\n      if (this.seletVideo == 0 && this.formValidate.video_link) {} else if (this.seletVideo == 0 && this.formValidate.video_link == '') {\n        this.$Message.error(\"请上传视频\");\n        nowEditor.dialog.close(true);\n      }\n\n      if (this.seletVideo == 1 && this.videoLink == '') {\n        this.$Message.error(\"请上传视频\");\n        nowEditor.dialog.close(true);\n      }\n\n      if (this.videoLink && this.$getFileType(this.videoLink) !== 'video' && this.seletVideo == 1) {\n        this.$Message.error(\"请输入正确的视频链接\");\n      } else {\n        if (this.seletVideo == 1 || this.seletVideo == 0 && this.upload_type != 1) {\n          videoAttachment({\n            path: this.formValidate.video_link,\n            pid: this.pid,\n            upload_type: this.seletVideo == 1 ? 1 : this.upload_type\n          }).then(function (res) {});\n        }\n\n        this.$emit('getVideo', this.formValidate.video_link);\n        this.formValidate.video_link = \"\";\n        this.$refs.refid.value = \"\";\n      }\n    },\n    changeVideo: function changeVideo(e) {\n      this.videoLink = \"\";\n    }\n  }\n};",null]}