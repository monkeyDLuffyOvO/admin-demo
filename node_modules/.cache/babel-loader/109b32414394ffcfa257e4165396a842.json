{"remainingRequest":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js!/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js??ref--0-2!/home/darkcrossunicorn/文档/admin/src/pages/marketing/addPiecesDiscount/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/darkcrossunicorn/文档/admin/src/pages/marketing/addPiecesDiscount/index.vue","mtime":1652425470000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/darkcrossunicorn/文档/admin/node_modules/iview-loader/index.js","mtime":1570440814000}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState, mapMutations } from \"vuex\";\nimport { saveDiscount, discountInfo } from \"@/api/marketing\";\nimport { userLabelAddApi } from \"@/api/user\";\nimport userLabel from \"@/components/labelList\";\nimport goodsList from '@/components/goodsList';\nexport default {\n  name: \"addPiecesDiscount\",\n  components: {\n    userLabel: userLabel,\n    goodsList: goodsList\n  },\n  data: function data() {\n    return {\n      grid: {\n        xl: 7,\n        lg: 7,\n        md: 12,\n        sm: 24,\n        xs: 24\n      },\n      modals: false,\n      tableData: [],\n      headTab: [{\n        name: \"基础设置\",\n        type: '1'\n      }, {\n        name: \"添加商品\",\n        type: '2'\n      }],\n      discountType: [{\n        name: \"第2件半价\",\n        title: \"例：甜筒第2件半价\",\n        id: 1\n      }, {\n        name: \"买1送1\",\n        title: \"例：T恤买1送1\",\n        id: 2\n      }, {\n        name: \"自定义优惠\",\n        title: \"例：第3件打5折\",\n        id: 3\n      }],\n      activityType: [{\n        name: '优惠券',\n        type: '5'\n      }, {\n        name: '满减满折',\n        type: '3'\n      }, {\n        name: '限时折扣',\n        type: '1'\n      } // {\n      // \tname:'满送活动',\n      // \ttype:'4'\n      // }\n      ],\n      currentTab: '1',\n      dataLabel: [],\n      labelShow: false,\n      formValidate: {\n        name: '',\n        section_time: [],\n        discount: 50,\n        threshold: 2,\n        is_label: 0,\n        label_id: [],\n        is_overlay: '0',\n        overlay: [],\n        product_partake_type: 1,\n        product_id: [],\n        n_piece_n_discount: 1\n      },\n      ruleValidate: {\n        name: [{\n          required: true,\n          message: '请输入活动名称',\n          trigger: 'blur'\n        }],\n        section_time: [{\n          required: true,\n          type: 'array',\n          message: '请选择活动时间',\n          trigger: 'change'\n        }],\n        is_overlay: [{\n          required: true,\n          message: '请设置优惠叠加',\n          trigger: 'change'\n        }],\n        threshold: [{\n          type: 'number',\n          required: true,\n          message: '请填写优惠设置',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: _objectSpread({}, mapState(\"admin/layout\", [\"isMobile\"]), {\n    labelWidth: function labelWidth() {\n      return this.isMobile ? undefined : 90;\n    },\n    labelPosition: function labelPosition() {\n      return this.isMobile ? \"top\" : \"right\";\n    },\n    labelBottom: function labelBottom() {\n      return this.isMobile ? undefined : 15;\n    }\n  }),\n  mounted: function mounted() {\n    this.setCopyrightShow({\n      value: false\n    });\n\n    if (this.$route.params.id != 0) {\n      this.getDiscountInfo();\n    }\n  },\n  destroyed: function destroyed() {\n    this.setCopyrightShow({\n      value: true\n    });\n  },\n  methods: _objectSpread({}, mapMutations('admin/layout', ['setCopyrightShow']), {\n    discountTypeTap: function discountTypeTap(item) {\n      this.formValidate.n_piece_n_discount = item.id;\n\n      if (item.id == 1) {\n        this.formValidate.threshold = 2;\n        this.formValidate.discount = 50;\n      } else if (item.id == 2) {\n        this.formValidate.threshold = 2;\n        this.formValidate.discount = 0;\n      } else {\n        this.formValidate.threshold = 1;\n        this.formValidate.discount = 100;\n      }\n    },\n    getDiscountInfo: function getDiscountInfo() {\n      var _this = this;\n\n      this.formValidate.n_piece_n_discount = 0;\n      discountInfo(this.$route.params.id).then(function (res) {\n        _this.formValidate = res.data.info;\n        _this.formValidate.discount = parseFloat(res.data.info.discount);\n        _this.formValidate.threshold = parseFloat(res.data.info.threshold);\n        _this.formValidate.is_overlay = _this.formValidate.is_overlay.toString();\n        _this.tableData = res.data.info.products;\n        _this.dataLabel = res.data.info.label_id;\n      }).catch(function (err) {\n        _this.$Message.error(err.msg);\n      });\n    },\n    del: function del(row) {\n      var _this2 = this;\n\n      this.tableData.forEach(function (i, index) {\n        if (row.id == i.id) {\n          return _this2.tableData.splice(index, 1);\n        } else {\n          i.attrValue.forEach(function (j, indexn) {\n            if (row.id == j.id) {\n              if (i.attrValue.length == 1) {\n                return _this2.tableData.splice(index, 1);\n              } else {\n                return i.attrValue.splice(indexn, 1);\n              }\n            }\n          });\n        }\n      });\n    },\n    addLabel: function addLabel() {\n      this.$modalForm(userLabelAddApi(0)).then(function () {});\n    },\n    addGoods: function addGoods() {\n      this.modals = true;\n    },\n    cancel: function cancel() {\n      this.modals = false;\n    },\n    //对象数组去重；\n    unique: function unique(arr) {\n      var res = new Map();\n      return arr.filter(function (arr) {\n        return !res.has(arr.id) && res.set(arr.id, 1);\n      });\n    },\n    getProductId: function getProductId(data) {\n      this.modals = false;\n      var list = this.tableData.concat(data);\n      var uni = this.unique(list);\n      uni.forEach(function (i) {\n        i.attrValue.forEach(function (j) {\n          j.cate_name = i.cate_name;\n          j.store_label = i.store_label;\n        });\n      });\n      this.tableData = uni;\n    },\n    // 具体日期\n    onchangeTime: function onchangeTime(e) {\n      this.formValidate.section_time = e;\n    },\n    closeLabel: function closeLabel(label) {\n      var index = this.dataLabel.indexOf(this.dataLabel.filter(function (d) {\n        return d.id == label.id;\n      })[0]);\n      this.dataLabel.splice(index, 1);\n    },\n    activeData: function activeData(dataLabel) {\n      this.labelShow = false;\n      this.dataLabel = dataLabel;\n    },\n    openLabel: function openLabel(row) {\n      this.labelShow = true;\n      this.$refs.userLabel.userLabel(JSON.parse(JSON.stringify(this.dataLabel)));\n    },\n    // 标签弹窗关闭\n    labelClose: function labelClose() {\n      this.labelShow = false;\n    },\n    // 上一页：\n    upTab: function upTab() {\n      if (this.currentTab == 1 && this.formValidate.product_type != 0) {\n        this.currentTab = (Number(this.currentTab) - 2).toString();\n      } else {\n        this.currentTab = (Number(this.currentTab) - 1).toString();\n      }\n    },\n    // 下一页；\n    downTab: function downTab(name) {\n      var _this3 = this;\n\n      this.$refs[name].validate(function (valid) {\n        if (valid) {\n          if (!_this3.formValidate.threshold) {\n            return _this3.$Message.warning(\"请填写优惠设置的件数\");\n          }\n\n          if (_this3.formValidate.discount == null) {\n            return _this3.$Message.warning(\"请填写优惠设置的折扣\");\n          }\n\n          if (_this3.formValidate.is_label && !_this3.dataLabel.length) {\n            return _this3.$Message.warning(\"请选择用户关联标签\");\n          }\n\n          if (parseInt(_this3.formValidate.is_overlay) && !_this3.formValidate.overlay.length) {\n            return _this3.$Message.warning(\"请选择叠加的营销活动\");\n          }\n\n          if (_this3.formValidate.section_time[0] == '') {\n            return _this3.$Message.warning(\"请选择活动时间\");\n          }\n\n          _this3.currentTab = '2';\n        } else {\n          _this3.$Message.warning(\"请完善数据\");\n        }\n      });\n    },\n    handleSubmit: function handleSubmit(name) {\n      var _this4 = this;\n\n      this.$refs[name].validate(function (valid) {\n        if (valid) {\n          if (!_this4.formValidate.threshold) {\n            return _this4.$Message.warning(\"请填写优惠设置\");\n          }\n\n          if (_this4.formValidate.is_label && !_this4.dataLabel.length) {\n            return _this4.$Message.warning(\"请选择用户关联标签\");\n          }\n\n          if (parseInt(_this4.formValidate.is_overlay) && !_this4.formValidate.overlay.length) {\n            return _this4.$Message.warning(\"请选择叠加的营销活动\");\n          }\n\n          if (_this4.formValidate.section_time[0] == '') {\n            return _this4.$Message.warning(\"请选择活动时间\");\n          } // 用户标签\n\n\n          var activeIds = [];\n\n          _this4.dataLabel.forEach(function (item) {\n            activeIds.push(item.id);\n          });\n\n          if (_this4.formValidate.is_label == 0) {\n            _this4.formValidate.label_id = [];\n          } else {\n            _this4.formValidate.label_id = activeIds;\n          }\n\n          var product_id = [];\n\n          _this4.tableData.forEach(function (item) {\n            var obj = {\n              product_id: item.id,\n              unique: []\n            };\n\n            if (item.attrValue.length) {\n              item.attrValue.forEach(function (j) {\n                obj.unique.push(j.unique);\n              });\n            }\n\n            product_id.push(obj);\n          });\n\n          if (_this4.formValidate.product_partake_type != 1 && !product_id.length) {\n            return _this4.$Message.error('请添加商品');\n          }\n\n          _this4.formValidate.product_id = product_id;\n          saveDiscount(2, _this4.$route.params.id, _this4.formValidate).then(function (res) {\n            _this4.$router.push({\n              path: \"/admin/marketing/discount/pieces_discount\"\n            });\n\n            _this4.$Message.success(res.msg);\n          }).catch(function (err) {\n            _this4.$Message.error(err.msg);\n          });\n        } else {\n          _this4.$Message.warning(\"请完善数据\");\n        }\n      });\n    }\n  })\n};",null]}