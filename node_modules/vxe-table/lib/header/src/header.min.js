"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools"),_util=require("./util"),_util2=require("../../table/src/util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var cellType="header",_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,o=this.fixedType,e=e.elemStore,o="".concat(o||"main","-header-");e["".concat(o,"wrapper")]=t,e["".concat(o,"table")]=l.table,e["".concat(o,"colgroup")]=l.colgroup,e["".concat(o,"list")]=l.thead,e["".concat(o,"xSpace")]=l.xSpace,e["".concat(o,"repair")]=l.repair},destroyed:function(){var e=this.$parent,t=this.fixedType,e=e.elemStore,t="".concat(t||"main","-header-");e["".concat(t,"wrapper")]=null,e["".concat(t,"table")]=null,e["".concat(t,"colgroup")]=null,e["".concat(t,"list")]=null,e["".concat(t,"xSpace")]=null,e["".concat(t,"repair")]=null},render:function(g){var b=this,e=this._e,_=this.$parent,v=this.fixedType,t=this.headerColumn,l=this.fixedColumn,C=_.$listeners,o=_.tId,r=_.isGroup,w=_.resizable,T=_.border,$=_.columnKey,n=_.headerRowClassName,z=_.headerCellClassName,i=_.headerRowStyle,P=_.headerCellStyle,S=_.showHeaderOverflow,M=_.headerAlign,D=_.align,W=_.highlightCurrentColumn,k=_.currentColumn,U=_.scrollXLoad,I=_.overflowX,a=_.scrollbarWidth,R=_.sortOpts,H=_.mouseConfig,A=_.columnOpts,s=this.tableColumn,t=t;return r||(t=[s=v&&(U||S)?l:s]),g("div",{class:["vxe-table--header-wrapper",v?"fixed-".concat(v,"--wrapper"):"body--wrapper"],attrs:{xid:o}},[v?e():g("div",{class:"vxe-body--x-space",ref:"xSpace"}),g("table",{class:"vxe-table--header",attrs:{xid:o,cellspacing:0,cellpadding:0,border:0},ref:"table"},[g("colgroup",{ref:"colgroup"},s.map(function(e,t){return g("col",{attrs:{name:e.id},key:t})}).concat(a?[g("col",{attrs:{name:"col_gutter"}})]:[])),g("thead",{ref:"thead"},t.map(function(x,y){return g("tr",{class:["vxe-header--row",n?_xeUtils.default.isFunction(n)?n({$table:_,$rowIndex:y,fixed:v,type:cellType}):n:""],style:i?_xeUtils.default.isFunction(i)?i({$table:_,$rowIndex:y,fixed:v,type:cellType}):i:null},x.map(function(e,t){var l=e.type,o=e.showHeaderOverflow,r=e.headerAlign,n=e.align,i=e.headerClassName,a=e.children&&e.children.length,s=v?e.fixed!==v&&!a:e.fixed&&I,c=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?S:o,d=r||n||M||D,u="ellipsis"===c,f="title"===c,p=!0===c||"tooltip"===c,h=f||p||u,o={},r=e.filters&&e.filters.some(function(e){return e.checked}),n=_.getColumnIndex(e),c=_.getVTColumnIndex(e),m={$table:_,$rowIndex:y,column:e,columnIndex:n,$columnIndex:t,_columnIndex:c,fixed:v,type:cellType,isHidden:s,hasFilter:r};return U&&!h&&(u=h=!0),(A.isCurrent||W||C["header-cell-click"]||"cell"===R.trigger)&&(o.click=function(e){return _.triggerHeaderCellClickEvent(e,m)}),C["header-cell-dblclick"]&&(o.dblclick=function(e){return _.triggerHeaderCellDblclickEvent(e,m)}),H&&(o.mousedown=function(e){return _.triggerHeaderCellMousedownEvent(e,m)}),g("th",{class:["vxe-header--column",e.id,(_defineProperty(c={},"col--".concat(d),d),_defineProperty(c,"col--".concat(l),l),_defineProperty(c,"col--last",t===x.length-1),_defineProperty(c,"col--fixed",e.fixed),_defineProperty(c,"col--group",a),_defineProperty(c,"col--ellipsis",h),_defineProperty(c,"fixed--hidden",s),_defineProperty(c,"is--sortable",e.sortable),_defineProperty(c,"col--filter",!!e.filters),_defineProperty(c,"is--filter-active",r),_defineProperty(c,"col--current",k===e),c),_tools.UtilTools.getClass(i,m),_tools.UtilTools.getClass(z,m)],attrs:{colid:e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null},style:P?_xeUtils.default.isFunction(P)?P(m):P:null,on:o,key:$||a?e.id:t},[g("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":p,"c--ellipsis":u}]},e.renderHeader(g,m)),s||a||!(_xeUtils.default.isBoolean(e.resizable)?e.resizable:A.resizable||w)?null:g("div",{class:["vxe-resizable",{"is--line":!T||"none"===T}],on:{mousedown:function(e){return b.resizeMousedown(e,m)}}})])}).concat(a?[g("th",{class:"vxe-header--gutter col--gutter"})]:[]))}))]),g("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){var e=this.$parent;this.headerColumn=e.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[]},resizeMousedown:function(e,t){var l=t.column,o=this.$parent,r=this.$el,n=this.fixedType,i=o.$refs,a=i.tableBody,s=i.leftContainer,c=i.rightContainer,d=i.resizeBar,i=e.target,u=e.clientX,f=t.cell=i.parentNode,p=0,h=a.$el,a=_tools.DomTools.getOffsetPos(i,r),r=i.clientWidth,i=Math.floor(r/2),m=(0,_util2.getColMinWidth)(t)-i,x=a.left-f.clientWidth+r+m,y=a.left+i,g=document.onmousemove,b=document.onmouseup,_="left"===n,v="right"===n,C=0;if(_||v){for(var w=_?"nextElementSibling":"previousElementSibling",T=f[w];T&&!_tools.DomTools.hasClass(T,"fixed--hidden");)_tools.DomTools.hasClass(T,"col--group")||(C+=T.offsetWidth),T=T[w];v&&c&&(y=c.offsetLeft+C)}i=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-u,e=y+t,t=n?0:h.scrollLeft;_?e=Math.min(e,(c?c.offsetLeft:h.clientWidth)-C-m):v?(x=(s?s.clientWidth:0)+C+m,e=Math.min(e,y+f.clientWidth-m)):x=Math.max(h.scrollLeft,x),p=Math.max(e,x),d.style.left="".concat(p-t,"px")};o._isResize=!0,_tools.DomTools.addClass(o.$el,"drag--resize"),d.style.display="block",document.onmousemove=i,document.onmouseup=function(e){document.onmousemove=g,document.onmouseup=b,l.resizeWidth=l.renderWidth+(v?y-p:p-y),d.style.display="none",o._isResize=!1,o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.recalculate(!0).then(function(){o.saveCustomResizable(),o.updateCellAreas(),o.emitEvent("resizable-change",t,e)}),_tools.DomTools.removeClass(o.$el,"drag--resize")},i(e),o.closeMenu()}}};exports.default=_default;