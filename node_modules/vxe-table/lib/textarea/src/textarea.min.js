"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var autoTxtElem,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=_interopRequireDefault(require("../../mixins/size")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _default2={name:"VxeTextarea",mixins:[_size.default],model:{prop:"value",event:"modelValue"},props:{value:[String,Number],immediate:{type:Boolean,default:!0},name:String,readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],rows:{type:[String,Number],default:2},cols:{type:[String,Number],default:null},showWordCount:Boolean,countMethod:Function,autosize:[Boolean,Object],form:String,resize:{type:String,default:function(){return _conf.default.textarea.resize}},className:String,size:{type:String,default:function(){return _conf.default.textarea.size||_conf.default.size}}},data:function(){return{inputValue:this.value}},computed:{inputCount:function(){return _xeUtils.default.getSize(this.inputValue)},isCountError:function(){return this.maxlength&&this.inputCount>_xeUtils.default.toNumber(this.maxlength)},defaultEvents:function(){var i=this,n={};return _xeUtils.default.each(this.$listeners,function(e,t){-1===["input","change","blur"].indexOf(t)&&(n[t]=i.triggerEvent)}),n.input=this.inputEvent,n.change=this.changeEvent,n.blur=this.blurEvent,n},sizeOpts:function(){return Object.assign({minRows:1,maxRows:10},_conf.default.textarea.autosize,this.autosize)}},watch:{value:function(e){this.inputValue=e,this.updateAutoTxt()}},mounted:function(){this.autosize&&(this.updateAutoTxt(),this.handleResize())},render:function(e){var t=this.className,i=this.defaultEvents,n=this.inputValue,a=this.vSize,u=this.name,s=this.form,r=this.resize,o=this.placeholder,l=this.readonly,d=this.disabled,h=this.maxlength,c=this.autosize,f=this.showWordCount,p=this.countMethod,m=this.rows,x=this.cols,l={name:u,form:s,placeholder:o,maxlength:h,readonly:l,disabled:d,rows:m,cols:x};return o&&(l.placeholder=_tools.UtilTools.getFuncText(o)),e("div",{class:["vxe-textarea",t,(_defineProperty(t={},"size--".concat(a),a),_defineProperty(t,"is--autosize",c),_defineProperty(t,"is--disabled",d),_defineProperty(t,"def--rows",!_xeUtils.default.eqNull(m)),_defineProperty(t,"def--cols",!_xeUtils.default.eqNull(x)),t)]},[e("textarea",{ref:"textarea",class:"vxe-textarea--inner",domProps:{value:n},attrs:l,style:r?{resize:r}:null,on:i}),f?e("span",{class:["vxe-textarea--count",{"is--error":this.isCountError}]},p?"".concat(p({value:n})):"".concat(this.inputCount).concat(h?"/".concat(h):"")):null])},methods:{focus:function(){return this.$refs.textarea.focus(),this.$nextTick()},blur:function(){return this.$refs.textarea.blur(),this.$nextTick()},triggerEvent:function(e){var t=this.inputValue;this.$emit(e.type,{value:t,$event:e})},emitUpdate:function(e,t){this.inputValue=e,this.$emit("modelValue",e),this.value!==e&&this.$emit("change",{value:e,$event:t})},inputEvent:function(e){var t=this.immediate,i=e.target.value;this.inputValue=i,t&&this.emitUpdate(i,e),this.handleResize(),this.triggerEvent(e)},changeEvent:function(e){this.immediate?this.triggerEvent(e):this.emitUpdate(this.inputValue,e)},blurEvent:function(e){var t=this.inputValue;this.immediate||this.emitUpdate(t,e),this.$emit("blur",{value:t,$event:e})},updateAutoTxt:function(){var e,t=this.$refs,i=this.inputValue,n=this.size;this.autosize&&((autoTxtElem=autoTxtElem||document.createElement("div")).parentNode||document.body.appendChild(autoTxtElem),e=t.textarea,t=getComputedStyle(e),autoTxtElem.className=["vxe-textarea--autosize",n?"size--".concat(n):""].join(" "),autoTxtElem.style.width="".concat(e.clientWidth,"px"),autoTxtElem.style.padding=t.padding,autoTxtElem.innerHTML=(""+(i||"　")).replace(/\n$/,"\n　"))},handleResize:function(){var r=this;this.autosize&&this.$nextTick(function(){var e=r.$refs,t=r.sizeOpts,i=t.minRows,n=t.maxRows,a=e.textarea,u=autoTxtElem.clientHeight,s=getComputedStyle(a),t=_xeUtils.default.toNumber(s.lineHeight),e=_xeUtils.default.toNumber(s.paddingTop)+_xeUtils.default.toNumber(s.paddingBottom)+_xeUtils.default.toNumber(s.borderTopWidth)+_xeUtils.default.toNumber(s.borderBottomWidth),s=(u-e)/t,u=s&&/[0-9]/.test(s)?s:Math.floor(s)+1,s=u;u<i?s=i:n<u&&(s=n),a.style.height="".concat(s*t+e,"px")})}}};exports.default=_default2;